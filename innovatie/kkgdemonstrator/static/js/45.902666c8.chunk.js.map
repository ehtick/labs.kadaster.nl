{"version":3,"sources":["components/widgets/bb/BBMermaid.js"],"names":["BBMermaid","props","mermaiddiv","createRef","handleZoom","event","setState","zoomLevel","scale","resetZoom","empty","updateMeR","onPanEnd","e","panStart","onPanStart","onStateChange","console","log","state","mermaid","initialize","startOnLoad","me","this","setLoading","setTimeout","prevProps","prevstate","previous","parseTextForVariables","current","updateMe","element","removeAttribute","mermaidS","textContent","contentLoaded","redraw","enableBoundingBox","zoom","noStateUpdate","ref","className","Component"],"mappings":"2NAQMA,EAAS,kDAIX,WAAYC,GAAQ,IAAD,EAIf,OAJe,qBACjB,cAAMA,IAJRC,WAAaC,sBAAW,EAWxBC,WAAa,SAACC,GAEZ,EAAKC,SAAS,CAAEC,UAAWF,EAAMG,OACnC,EAAE,EAEFC,UAAY,WAEV,EAAKH,SAAS,CAAEI,OAAM,EAAKH,UAAW,IAEtC,EAAKI,WACP,EAAE,EAyFJC,SAAS,SAACC,GAIT,EAAKC,UAAS,CACf,EAAC,EACDC,WAAW,SAACF,GAEV,EAAKC,UAAS,CAChB,EAAC,EACDE,cAAc,SAACH,GAEL,EAAKC,UAITG,QAAQC,IAAI,gBAAgBL,EAElC,EA3HI,EAAKM,MAAQ,CACXZ,UAAW,GACX,CACJ,CAuID,OAvIE,8CAgBH,WAGEa,IAAQC,WAAW,CACjBC,aAAa,IAIf,IAIMC,EAAGC,KACPD,EAAGtB,MAAMwB,YAAW,GAEpBC,YAAW,WAAYH,EAAGd,WAAW,GAAE,IACvCiB,YAAY,WACVH,EAAGZ,YACHY,EAAGtB,MAAMwB,YAAW,EACxB,GAAE,IAGJ,GAAC,gCAGD,SAAmBE,EAAUC,GAE3B,IAAIC,EAAWF,EAAUP,QACzBS,EAASC,YAAsBD,EAASF,GAGxC,IAAII,EAAUP,KAAKvB,MAAMmB,QAErBS,KADJE,EAAQD,YAAsBC,EAAQP,KAAKvB,SAMzCuB,KAAKQ,UACT,GAAC,sBAED,WAGE,IAAIT,EAAGC,KAEPE,YAAW,WAAYH,EAAGd,WAAW,GAAE,GAGzC,GAAC,uBAGA,WAGA,GAA0B,GAAtBe,KAAKL,MAAMZ,UAEhB,IAGE,IAAM0B,EAAUT,KAAKtB,WAAW6B,QAK9B,GAAIE,EACJ,CAEEA,EAAQC,gBAAgB,kBACxB,IAAIC,EAASX,KAAKvB,MAAMmB,QACxBe,EAASL,YAAsBK,EAASX,KAAKvB,OAC7CgC,EAAQG,YAAaD,EAErBf,IAAQiB,eAEV,CACF,CACA,MAAMxB,GAEFI,QAAQC,IAAIL,EAChB,CAEF,GAAC,oBAyBD,WAEE,OAAIW,KAAKL,MAAMmB,OAEN,KAGD,8BACN,cAAC,UAAO,CAAEC,mBAAmB,EAAOC,KAAMhB,KAAKL,MAAMZ,UAAekC,eAAe,EAAK,SACrF,qBAAOC,IAAKlB,KAAKtB,WAAYyC,UAAU,eAG9C,KAAC,EAhJY,CAASC,aAmJT5C,W","file":"static/js/45.902666c8.chunk.js","sourcesContent":["// src/components/MermaidFlowchartClass.js\r\nimport React, { Component ,createRef} from 'react';\r\nimport mermaid from 'mermaid';\r\nimport { PanZoom } from 'react-easy-panzoom'\r\nimport { parseTextForVariables } from '../../../helpers/sparql';\r\n\r\n \r\n\r\nclass BBMermaid extends Component {\r\n    mermaiddiv = createRef()\r\n  \r\n\r\n    constructor(props) {\r\n      super(props);\r\n      this.state = {\r\n        zoomLevel: 1,\r\n      };\r\n    }\r\n\r\n\r\n    handleZoom = (event) => {\r\n      // Update the zoom level in state\r\n      this.setState({ zoomLevel: event.scale });\r\n    };\r\n\r\n    resetZoom = () => {\r\n      // Set the zoom level back to the initial state or a default value\r\n      this.setState({ empty:true,zoomLevel: 1 });\r\n\r\n      this.updateMeR();\r\n    };\r\n  \r\n\r\n  componentDidMount() {\r\n    // Initialize Mermaid.js\r\n    \r\n    mermaid.initialize({\r\n      startOnLoad: true,\r\n    });\r\n    \r\n\r\n    const zoomOptions = {\r\n        zoom: true,\r\n      };\r\n\r\n      var me=this;\r\n      me.props.setLoading(true)\r\n\r\n      setTimeout(function() {me.resetZoom()},10);\r\n      setTimeout( function() { \r\n        me.updateMeR();\r\n        me.props.setLoading(false)\r\n    },800);\r\n     \r\n   \r\n  }\r\n\r\n  \r\n  componentDidUpdate(prevProps,prevstate)\r\n  {\r\n    var previous = prevProps.mermaid;\r\n    previous=parseTextForVariables(previous,prevProps);\r\n\r\n\r\n    var current = this.props.mermaid;\r\n    current=parseTextForVariables(current,this.props);\r\n    if (previous===current)\r\n    {\r\n      return;\r\n    }\r\n     // this.setState({redraw:true});\r\n      this.updateMe();\r\n  }\r\n\r\n  updateMe()\r\n  {\r\n    \r\n    var me=this;\r\n   // this.setState({redraw:false});\r\n    setTimeout(function() {me.resetZoom()},10);\r\n\r\n    \r\n  }\r\n\r\n\r\n   updateMeR()\r\n{ \r\n\r\n   if (this.state.zoomLevel!=1) return;\r\n  \r\n  try\r\n  {\r\n   // this.setState({ empty:false });\r\n    const element = this.mermaiddiv.current;\r\n\r\n    //console.log(\"setting data into mermaid\",element);\r\n   \r\n    // Modify or remove attributes using standard DOM manipulation\r\n      if (element) \r\n      {\r\n        //this.resetZoom();\r\n        element.removeAttribute('data-processed');\r\n        var mermaidS=this.props.mermaid;\r\n        mermaidS=parseTextForVariables(mermaidS,this.props);\r\n        element.textContent =mermaidS;\r\n    //console.log(\"mermaid component did update\",mermaidS.substring(0,40));\r\n        mermaid.contentLoaded();\r\n      \r\n      } \r\n    }\r\n    catch(e)\r\n    {\r\n        console.log(e);\r\n    }\r\n\r\n  }\r\n\r\n\r\n\r\n  onPanEnd=(e) =>\r\n  {\r\n   //console.log(e);\r\n   //this.updateMe();\r\n   this.panStart=false;\r\n  }\r\n  onPanStart=(e) =>\r\n  {\r\n    this.panStart=true;\r\n  }\r\n  onStateChange=(e) =>\r\n  {\r\n        if (this.panStart)\r\n        {\r\n          return;\r\n        }\r\n        console.log(\"state changed\",e)\r\n   \r\n  }\r\n\r\n  \r\n  render() {\r\n  \r\n    if (this.state.redraw)\r\n    {\r\n      return null;\r\n    }\r\n\r\n    return  <div> \r\n      <PanZoom  enableBoundingBox={true}  zoom={this.state.zoomLevel}     noStateUpdate={true} >\r\n         <div   ref={this.mermaiddiv} className=\"mermaid\"></div> \r\n         </PanZoom>\r\n    </div>;\r\n  }\r\n}\r\n\r\nexport default BBMermaid;\r\n"],"sourceRoot":""}