{"version":3,"sources":["components/widgets/bb/ifc/BBThreeJSViewer.module.css","../node_modules/openbim-components/node_modules/web-ifc sync","components/widgets/bb/ifc/IFCGLBFile.js","components/widgets/bb/ifc/IFCFile.js","components/widgets/bb/ifc/IFCDBSparql.js","components/widgets/bb/ifc/IFCDB.js","components/widgets/bb/ifc/ThreeJSViewer.js","components/widgets/bb/ifc/GLBFromSparqlResults.js","components/widgets/bb/ifc/BBThreeJSViewer.js","../node_modules/web-ifc sync"],"names":["module","exports","webpackEmptyContext","req","e","Error","code","keys","resolve","id","IFCGLBFile","ifcdb","file","rv","simpleMode","doNotLoad","name","gltf","visible","allBFGs","allNodes","allFirstChild","allFirstMaterial","loading","defaultChilds","MANAGER","LoadingManager","THREE_PATH","REVISION","DRACO_LOADER","DRACOLoader","setDecoderPath","KTX2_LOADER","KTX2Loader","setTranscoderPath","Cache","enabled","this","loader","GLTFLoader","setCrossOrigin","setMeshoptDecoder","MeshoptDecoder","setDRACOLoader","setKTX2Loader","detectSupport","viewer","renderer","setWithCredentials","manager","setResourcePath","me","parseTextForVariables","props","loadAsync","then","needsTranslation","processGLTF","getCenter","call","progress","error","console","log","window","alert","catch","err","Box3","setFromObject","scene","Vector3","center","Math","abs","x","y","z","rootGroup","add","guid","n","child","ncenter","resetMatrix","children","processGLTFElement","matrix","Matrix4","matrixWorld","parent","isMesh","isObject3D","geometry","length","isBufferGeometry","cid","color","r","b","g","material","ar","updateMatrix","updateMatrixWorld","sub","clone","matrixT","makeTranslation","multiply","applyMatrix4","push","aantal","subAantal","colorMat","key","mat2","mat","getDefaultColor","processColoring","IFCFile","root","IFCLoader","ifcManager","setWasmPath","wasmLoaded","loadReallyIFC","load","mesh","groups","IFCDBSparql","guid_label","latestData","guid_color","data","results","bindings","binding","value","label","startsWith","stringToColour","str","hash","i","charCodeAt","colour","toString","substr","c","hex","componentToHex","fn","ifcfiles","ifc","visualize","colorString","getColor","MeshPhysicalMaterial","vertexColors","cchild2","Mesh","zoomAt","defaultColor","loadingInProgress","processSparqlResults","amoutOfSparqlResults","setSparqlColors_double","setSparqlColors_ReOrganise","IFCDB","onlyOnce","pickGroup","inputChanged","ifcdbsparql","latestBindings","selectOnlySparqlResults","tx","ty","tz","reusepickgroup","updateRender","emptyScene","useSparqlColors","setSparqlColors","createNewPickGroup","controls","update","setSelectedGuid","setAnimeerAantal","setLoading","top","translateIntoView","onlyOnceTranslationDebug","processedAll","aabb","getSize","defaultMat","hint","fog","transparent","opacity","MeshPhongMaterial","shininess","emissiveIntensity","lightMapIntensity","emissive","MeshToonMaterial","depthWrite","addDefaultToScene","colorHash","rar","mergeGeometries","matrixAutoUpdate","castShadow","receiveShadow","Group","getNewRootGroup","getDefaultScene","ifcguid","updateWorldMatrix","files","nfile","f","getIFCFile","includes","ifcFile","getChild","createNewScene","orbiting","asyncLoadGLBFiles","slice","loadedfiles","reset","setVisible","loadingNewFiles","toLowerCase","endsWith","readyLoading","processBindings","lm","tobeprocessedBindings","aantalBindings","gltfB","JSON","parse","uri","userData","ThreeJSViewer","raycaster","camera","pointer","Vector2","selectedChild","hooverChild","threeCanvas","animeerAantal","target","distance","size","gsap","to","position","duration","onUpdate","lookAt","orbitControls","onComplete","tcid","document","getElementById","components","OBC","init","get","directionalLight","DirectionalLight","set","intensity","ambientLight","AmbientLight","grid","tools","Raycaster","canvasBounds","getBoundingClientRect","width","right","left","height","bottom","Scene","aspect","PerspectiveCamera","near","far","pointLight","PointLight","background","Color","WebGLRenderer","canvas","alpha","powerPreference","antialias","logarithmicDepthBuffer","sortObjects","colorManagement","setPixelRatio","devicePixelRatio","setSize","GridHelper","axes","AxesHelper","depthTest","renderOrder","OrbitControls","enableDamping","animate","render","requestAnimationFrame","addEventListener","event","mousemove","mouseclick","mouseDoubleClick","updateProjectionMatrix","clear","lightColor","light","HemisphereLight","SpotLight","resize","preventDefault","getContext","clientX","clientY","pg","getPickGroup","setFromCamera","intersectObjects","intersects","getIntersection","object","orgMatrix","orgMaterial","specular","remove","msg","getLabel","showTippy","destroyTippy","newGuid","pubsub","guidselector","selectedGuid","par","publish","showSelectChild","tippy","div","trigger","placement","plugins","followCursor","content","setContent","show","hide","boundingBox","fov","PI","fovh","atan","tan","dx","dy","cameraZ","max","minZ","min","cameraToFarEdge","undefined","maxDistance","GLBFromSparqlResults","vars","head","processSparql","rotation","nodes","color_nodes","colors","getRandomHexColor","setupIFCDB","glb","loadedN","processedN","resultsN","arg","onLoad","onError","randomColor","floor","random","repeat","onLoadReady","toInteger","convertToHex","o3d","side","THREE","group","makeScale","getMat","BBThreeJSViewer","canvasDiv","React","createRef","onResize","currentCanvasDiv","current","ResizeObserver","entries","observe","initViewer","ready","prefix","files2","file2","PublishUtils","processStringForParameters","files22","split","nn","file3","replace","state","a1","getGLBFilesFromProps","a2","stringify","sel","sel2","sela","loadIFC","ifcLoader","ifcModel","force","isEmpty","shouldLoadNewFiles","loadGLBFiles","needsUpdate","idN","tippyID","ref","className","styles","fullWidget","src","gearWhite","alt","onClick","setState","dialogVisible","style","Component","connect"],"mappings":"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","file":"static/js/16.4f953762.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"fullWidget\":\"BBThreeJSViewer_fullWidget__16tbM\",\"right\":\"BBThreeJSViewer_right__35Xyd\",\"drawer\":\"BBThreeJSViewer_drawer__2Omkl\"};","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 1141;","import { ConstructionOutlined } from \"@mui/icons-material\";\r\nimport {Box3,Cache,Object3D,Vector3, REVISION,Matrix4,BufferGeometry,LoadingManager } from \"three\";\r\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader'\r\nimport { KTX2Loader } from 'three/examples/jsm/loaders/KTX2Loader.js';\r\nimport { DRACOLoader } from 'three/examples/jsm/loaders/DRACOLoader.js';\r\nimport { parseTextForVariables } from '../../../../helpers/sparql';\r\nimport { MeshoptDecoder } from 'three/examples/jsm/libs/meshopt_decoder.module.js';\r\n\r\nclass IFCGLBFile\r\n{\r\n    ifcdb=null;\r\n    name=null;\r\n    gltf =null;\r\n    visible=true;\r\n    allBFGs={};\r\n    allNodes=[];\r\n    allFirstChild={}\r\n    allFirstMaterial={};\r\n    loading=null;\r\n    defaultChilds=null;\r\n    simpleMode=false;\r\n\r\n\r\n\r\n  \r\n\r\n  //  size={};\r\n   // center={};\r\n\r\n   \r\n\r\nconstructor(ifcdb,file,rv,simpleMode,doNotLoad)\r\n{\r\n  const MANAGER = new LoadingManager();\r\n  const THREE_PATH = `https://unpkg.com/three@0.${REVISION}.x`\r\n  const DRACO_LOADER = new DRACOLoader( MANAGER ).setDecoderPath( `${THREE_PATH}/examples/jsm/libs/draco/gltf/` );\r\n  const KTX2_LOADER = new KTX2Loader( MANAGER ).setTranscoderPath( `${THREE_PATH}/examples/jsm/libs/basis/` );\r\n  Cache.enabled = true;\r\n  this.ifcdb=ifcdb;\r\n  //Object3D.DefaultUp.set(0, 0, 1);\r\n  if (simpleMode==true) {this.simpleMode=true;}\r\n  var loader = new GLTFLoader();\r\n  this.loader=loader;\r\n  loader.setCrossOrigin('anonymous');\r\n  loader.setMeshoptDecoder( MeshoptDecoder );\r\n  loader.setDRACOLoader( DRACO_LOADER )\r\n  loader.setKTX2Loader( KTX2_LOADER.detectSupport( this.ifcdb.viewer.viewer.renderer ) )\r\n   if (doNotLoad==true) return;\r\n\r\n  loader.setWithCredentials(true);\r\n  loader.manager.file=file;\r\n  loader.setResourcePath(file);\r\n\r\n\r\n  this.name=file;\r\n  var me=this;\r\n  this.loading=true;\r\ntry\r\n{\r\n  //console.log(\"loading \"+file);\r\n  \r\n  file=parseTextForVariables(file,ifcdb.viewer.props);\r\n  //console.log(\"loading \"+file);\r\n  loader.setCrossOrigin(\"*\");\r\n  loader.loadAsync(file).then(function(gltf)\r\n  {\r\n    // console.log(\"loaded \"+file,gltf);\r\n      me.gltf=gltf;\r\n      if (!me.simpleMode)\r\n      {\r\n        if (!me.needsTranslation)\r\n        {\r\n           me.processGLTF(gltf);\r\n        }\r\n        else\r\n        {\r\n        //  console.log(\"glb file needs translation so not processed\");\r\n          me.processGLTF(gltf,me.getCenter());\r\n        }\r\n      }\r\n      me.loading=false;\r\n      if (rv!=null){rv.call(me);}\r\n   },function (progress){\r\n    //console.log(progress);\r\n  },function(error)\r\n    {\r\n      console.log(\"error\",error);\r\n      window.alert(\"error loading file\");\r\n      me.loading=false;\r\n      if (rv!=null){rv.call(me);}\r\n\r\n    }\r\n  \r\n   ).catch(err => {console.log(err); alert(\"could not load 3d file\")});\r\n  }\r\n  catch(e)\r\n  {\r\n    window.alert(\"error loading model \");\r\n    me.loading=false;\r\n    if (rv!=null){rv.call(me);}\r\n  }\r\n}\r\n\r\ngetCenter()\r\n{\r\n  //console.log(this,this.gltf);\r\n  const aabb = new Box3().setFromObject(this.gltf.scene);\r\n  const center = aabb.getCenter( new Vector3() );\r\n  return center;\r\n}\r\n\r\nneedsTranslation()\r\n{\r\n \r\n  const center = this.getCenter();\r\n \r\n  if ((Math.abs(center.x)>1000) || (Math.abs(center.y)>1000) || (Math.abs(center.z)>1000) )\r\n  {\r\n  \r\n    return true;\r\n  }\r\n  else\r\n  {\r\n    console.log(\"no need for extra translations\");\r\n  }\r\n  return false;\r\n}\r\n\r\n\r\n\r\naddDefaultToScene()\r\n{\r\n\r\n  this.ifcdb.rootGroup.add(this.gltf.scene);\r\n // console.log(this.gltf.scene);\r\n}\r\ngetDefaultScene()\r\n{\r\n  return this.gltf.scene;\r\n}\r\n\r\n\r\n\r\ngetChild(guid)\r\n {\r\n      for (var n in this.allNodes)\r\n      {\r\n          var child = this.allNodes[n];\r\n          if (child.name==guid)\r\n          return child;\r\n      }\r\n    return null;\r\n  }\r\n\r\nprocessGLTF(gltf,ncenter)\r\n{\r\n \r\n   this.allBFGs={};\r\n   this.allNodes=[];\r\n   this.allFirstChild={}\r\n   this.allFirstMaterial={};\r\n   this.loading=null;\r\n   this.defaultChilds=null;\r\n\r\n   this.resetMatrix(gltf.scene);\r\nif (ncenter!=null)\r\n{\r\n \r\n  console.log(\"translating the scene \",this.name);\r\n  this.ncenter=ncenter;\r\n \r\n\r\n}\r\n \r\n/*\r\n const aabb = new Box3().setFromObject( gltf.scene );\r\n  const center = aabb.getCenter( new Vector3() );\r\n  var size = aabb.getSize( new Vector3() );\r\n*/\r\n \r\n      for (var n in gltf.scene.children )\r\n      {\r\n                let child = gltf.scene.children[n];\r\n                this.processGLTFElement(child,ncenter);\r\n      }\r\n\r\n\r\n      //console.log(\"ready processing gltf\");\r\n\r\n}\r\n\r\nresetMatrix(child)\r\n{\r\n             child.matrix=new Matrix4();\r\n             child.matrixWorld=new Matrix4();\r\n             if (child.parent!=null)\r\n             {\r\n                this.resetMatrix(child.parent);\r\n             }\r\n}\r\n\r\nprocessGLTFElement(child,ncenter)\r\n{\r\n     if ( (child.isMesh) && (child.isObject3D)  && (child.geometry!=null) && (child.children.length==0))\r\n     {\r\n         if (child.geometry.isBufferGeometry)\r\n         {\r\n          \r\n         }\r\n         else\r\n         {\r\n          console.log(\"dit heeft een andere geometry \",child.geometry);\r\n         // child.removeFromParent();\r\n          return;\r\n         }\r\n     }\r\n  \r\n\r\n      let cid=\"default\";\r\n      let color={r:1,b:1,g:1};\r\n      try\r\n      {\r\n           color=child.material.color;\r\n           cid= color.r+\"_\"+color.g+\"_\"+color.b;\r\n      }\r\n      catch(e)\r\n      {\r\n     //  console.log(e,child);\r\n\r\n\r\n      }\r\n      var ar=this.allBFGs[cid];\r\n \r\n      if (ar==null)\r\n      {\r\n        ar=[];\r\n        this.allBFGs[cid]=ar;\r\n        this.allFirstChild[cid]=color;\r\n        this.allFirstMaterial[cid]=child.material;\r\n       \r\n      }\r\n     \r\n\r\n     \r\n\r\n      child.updateMatrix(true);\r\n      child.updateMatrixWorld(true);\r\n      \r\n     \r\n        if (child.children!=null)\r\n        {\r\n        \r\n          \r\n          for (var n in child.children)\r\n          {\r\n                  var sub=child.children[n];\r\n                  this.processGLTFElement(sub,ncenter);\r\n              \r\n          }\r\n          if (child.geometry==null)\r\n          {\r\n            return;\r\n          }\r\n         // return;\r\n        }\r\n\r\n             var g = child.geometry;\r\n             g=g.clone(); // geometry can be re-used by other childs\r\n             var matrix = child.matrixWorld.clone();\r\n             child.geometry=g;\r\n         \r\n             if (ncenter!=null)\r\n             {\r\n                  var matrixT=new Matrix4();\r\n                  matrixT.makeTranslation(-ncenter.x,-ncenter.y,-ncenter.z);\r\n                  matrix=matrixT.multiply(matrix);\r\n             }\r\n             g=g.applyMatrix4(matrix);\r\n         \r\n     \r\n        ar.push(g);\r\n       g.guid=child.name;\r\n\r\n        this.allNodes.push(child); //for picking and for reference\r\n        this.aantal++;\r\n        this.subAantal++;\r\n        if (this.subAantal>1000)\r\n        {\r\n         // console.log(child);\r\n         //  console.log(this.aantal+\" objecten verwerkt. nog niet klaar\");\r\n         //   console.log(this.tobeprocessedBindings,this.aantalBindings);\r\n            this.subAantal=0;\r\n        }\r\n     \r\n\r\n    }\r\n\r\n\r\n    visualize(b)\r\n    {\r\n      this.visible=b;\r\n       if (this.defaultChilds==null)\r\n       {\r\n\r\n        let colorMat={};\r\n        for (var key in this.allBFGs)\r\n          {\r\n            let color=this.allFirstChild[key];\r\n            let mat2 =this.allFirstMaterial[key];\r\n            var mat=this.ifcdb.getDefaultColor(color,mat2);\r\n            colorMat[key]=mat;\r\n          }\r\n          this.defaultChilds=this.ifcdb.processColoring(this.allBFGs,colorMat);\r\n       }\r\n\r\n     //   console.log(this.defaultChilds);\r\n     console.log(this.name+\" visualise \"+b);\r\n      for (var n in this.defaultChilds)\r\n      {\r\n        this.ifcdb.rootGroup.add( this.defaultChilds[n]);\r\n      }\r\n    }\r\n\r\n    \r\n  }\r\n\r\n  export default IFCGLBFile\r\n","import { IFCLoader  } from \"web-ifc-three/IFCLoader\";\r\n\r\nclass IFCFile\r\n{\r\n\r\n    ifcdb=null;\r\n    name=null;\r\n    visible=true;\r\n    root=null;\r\n    allBFGs={};\r\n    allFirstChild={}\r\n    allFirstMaterial={};\r\n\r\n   \r\n\r\n\r\n\r\n\r\n    static wasmLoaded=false;\r\n\r\n\r\n  constructor(ifcdb,file,rv)\r\n{\r\n  this.ifcdb=ifcdb;\r\n  var loader = new IFCLoader();\r\n  this.name=file;\r\n  var me=this;\r\n  this.loading=true;\r\n  var me=this;\r\n   \r\n      loader.ifcManager.setWasmPath(\"../../../bb/wasm/\").then(function(){\r\n        IFCFile.wasmLoaded=true;\r\n        me.loadReallyIFC(loader,file,rv)\r\n  });\r\n\r\n}\r\n\r\n\r\n\r\nloadReallyIFC(loader,file,rv)\r\n{\r\n    loader.setWithCredentials(true);\r\n    var me=this;\r\n   \r\n    loader.load(file,function(gltf)\r\n    {\r\n     //  console.log(gltf);\r\n       var materials =gltf.mesh.material;\r\n       var groups=gltf.mesh.groups; //{ start: 0, count: 3450, materialIndex: 0 }\r\n\r\n\r\n       me.allBFGs[\"default\"]=gltf;\r\n       me.allFirstChild[\"default\"]=gltf.material.color;\r\n       me.allFirstMaterial[\"default\"]=gltf.material;\r\n      \r\n      me.loading=false;\r\n      if (rv!=null){rv.call(me);}\r\n    });\r\n}\r\n\r\n}\r\n\r\nexport default IFCFile","\r\nimport { ConstructionOutlined } from \"@mui/icons-material\";\r\nimport { tr } from \"date-fns/locale\";\r\nimport {Color,MeshPhysicalMaterial,Mesh,BufferGeometry,MeshToonMaterial, MeshPhongMaterial,MeshLambertMaterial } from \"three\";\r\n\r\n\r\nclass IFCDBSparql\r\n{\r\n    ifcdb=null;\r\n    guid_label={};\r\n    colorMat={};\r\n    latestData=null;\r\n    guid_color=null;\r\n\r\nconstructor(ifcdb)\r\n{\r\n  this.ifcdb=ifcdb;\r\n}\r\n\r\nuseSparqlColors()\r\n{\r\n  try\r\n  {\r\n    if (this.ifcdb.viewer.props.data!=null)\r\n    {\r\n      var results=this.ifcdb.viewer.props.data.results;\r\n      if (results.bindings.length>0) return true;\r\n      this.latestData=null;\r\n\r\n    }\r\n  }\r\n  catch(e)\r\n  {}\r\n  return false;\r\n}\r\n\r\namoutOfSparqlResults()\r\n{\r\n  try\r\n  {\r\n  if (this.ifcdb.viewer.props.data!=null)\r\n  {\r\n    var results=this.ifcdb.viewer.props.data.results;\r\n    return results.bindings.length;\r\n  }\r\n}\r\ncatch(e)\r\n{}\r\n  return 0;\r\n}\r\n\r\ngetLabel(guid)\r\n{\r\n  return this.guid_label[guid];\r\n}\r\n\r\n\r\n\r\nprocessSparqlResults()\r\n{\r\n  var guid_color = {};\r\n  this.guid_color=guid_color;\r\n  this.guid_label={};\r\n  try\r\n  {\r\n    var results=this.ifcdb.viewer.props.data.results;\r\n    for (var n in results.bindings)\r\n    {\r\n         var binding = results.bindings[n];\r\n         var guid=binding.guid.value;\r\n         var color=binding.color.value;\r\n         guid_color[guid]=color;\r\n         try{var label = binding.label.value; this.guid_label[guid]=label;}catch(e){}\r\n    }\r\n  }\r\n  catch(e)\r\n  {}\r\n  return guid_color;\r\n}\r\n\r\ngetColor(value)\r\n{\r\n  try\r\n  {\r\n      if ( (value.startsWith(\"#\")) && (value.length==7) )\r\n    {\r\n       return value;\r\n    }\r\n  }\r\n  catch(e){}\r\n   try\r\n   {\r\n    return this.stringToColour(value);\r\n   }\r\n   catch(e){}\r\n\r\n  return \"#ff0000\";\r\n}\r\n\r\nstringToColour(str) {\r\n  var hash = 0\r\n  for (let i = 0; i < str.length; i++) {\r\n    hash = str.charCodeAt(i) + ((hash << 5) - hash)\r\n  }\r\n  var colour = '#'\r\n  for (let i = 0; i < 3; i++) {\r\n    var value = (hash >> (i * 8)) & 0xff\r\n    colour += ('00' + value.toString(16)).substr(-2)\r\n  }\r\n  return colour\r\n}\r\n componentToHex(c) {\r\n  var hex = c.toString(16);\r\n  return hex.length == 1 ? \"0\" + hex : hex;\r\n}\r\n\r\n rgbToHex(r, g, b) {\r\n  return \"#\" + this.componentToHex(r) + this.componentToHex(g) + this.componentToHex(b);\r\n}\r\n\r\n\r\n\r\n\r\n\r\nneedsUpdate()\r\n{\r\n  //console.log(this.latestData,this.ifcdb.viewer.props.data);\r\n  try {if (this.latestData==this.ifcdb.viewer.props.data) return false;}\r\n  catch(e ){}\r\n  return true;\r\n}\r\n\r\nsetSparqlColors_double(guid_color)\r\n{\r\n console.log(\"double coloring strategy\");\r\n  try\r\n  {\r\n       for (var fn in this.ifcdb.ifcfiles)\r\n        {\r\n          var ifc = this.ifcdb.ifcfiles[fn];\r\n          if (!ifc.visible) continue;\r\n          ifc.visualize(true);\r\n          for (var n in ifc.allNodes)\r\n          {\r\n    \r\n                let child = ifc.allNodes[n];\r\n                if (child.geometry!=null)\r\n                {\r\n                  var ifcguid=child.name;\r\n                  var colorString=guid_color[ifcguid];\r\n                  if (colorString!=null) \r\n                  {\r\n                      let color=this.getColor(colorString);\r\n                      var mat = new  MeshPhysicalMaterial({color:color});\r\n                      mat.vertexColors=false;\r\n                      var g=child.geometry.clone();\r\n                      var cchild2=new Mesh();\r\n                      cchild2.geometry=g;\r\n                      cchild2.material=mat;\r\n                      this.ifcdb.rootGroup.add(cchild2);\r\n                   }\r\n                }\r\n        \r\n          }     \r\n        }\r\n\r\n       this.ifcdb.viewer.viewer.zoomAt(this.ifcdb.rootGroup);\r\n\r\n\r\n       \r\n\r\n\r\n  }\r\n  catch(e)\r\n  {\r\n     console.log(e);\r\n     this.ifcdb.defaultColor();\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\nsetSparqlColors_ReOrganise(guid_color)\r\n{\r\n  console.log(\"reorganise coloring strategy\");\r\n  try\r\n  {\r\n  \r\n\r\n    var colorMat={};\r\n    this.colorMat=colorMat;\r\n     this.hash={};\r\n    var hash=this.hash;\r\n\r\n        hash[\"default\"]=[];\r\n        colorMat[\"default\"]=this.ifcdb.getDefaultColor(\"#aaaaaa\");\r\n   \r\n        for (var fn in this.ifcdb.ifcfiles)\r\n        {\r\n          var ifc = this.ifcdb.ifcfiles[fn];\r\n          if (!ifc.visible) continue;\r\n    \r\n          for (var n in ifc.allNodes)\r\n          {\r\n    \r\n                let child = ifc.allNodes[n];\r\n                if (child.geometry!=null)\r\n                {\r\n                  var ifcguid=child.name;\r\n                  var colorString=guid_color[ifcguid];\r\n                  if (colorString==null) colorString=\"default\";\r\n                  var ar=hash[colorString];\r\n                   if (ar==null)\r\n                   {\r\n                    ar=[];\r\n                    hash[colorString]=ar;\r\n                    let color=this.getColor(colorString);\r\n                    var mat = new  MeshPhysicalMaterial({color:color});\r\n                    mat.vertexColors=false;\r\n                    colorMat[colorString]=mat;\r\n                   }\r\n                 // ar.push(child.geometry.clone()); //not sure about this\r\n                 ar.push(child.geometry);\r\n                }\r\n        \r\n          }     \r\n        }\r\n    // console.log(hash,colorMat);\r\n        this.ifcdb.processColoring(hash,colorMat);\r\n\r\n  }\r\n  catch(e)\r\n  {\r\n     console.log(e);\r\n     this.ifcdb.defaultColor();\r\n  }\r\n}\r\n\r\n\r\n\r\nsetSparqlColors()\r\n{\r\n  if (this.ifcdb.loadingInProgress) {\r\n    //console.log(\"no sparql colors because of loading =true\");\r\n    return;\r\n  }\r\n // console.log(\"set sparql colors\");\r\n  try {this.latestData=this.ifcdb.viewer.props.data}catch(e){}\r\n  \r\n    var guid_color =this.processSparqlResults();\r\n    var amount=this.amoutOfSparqlResults();\r\n   if (amount<100)\r\n   {\r\n    \r\n        this.setSparqlColors_double(guid_color);\r\n   }\r\n   else\r\n   {\r\n        this.setSparqlColors_ReOrganise(guid_color); //good\r\n   }\r\n  \r\n}\r\n\r\n\r\n}\r\nexport default IFCDBSparql;\r\n\r\n","import _ from \"lodash\";\r\nimport {Mesh,LoadingManager,Box3,MeshDepthMaterial,DoubleSide,Group,Color,Vector3,Matrix4, BufferGeometry,MeshPhysicalMaterial,MeshStandardMaterial, MeshDistanceMaterial, MeshToonMaterial, MeshPhongMaterial,MeshLambertMaterial,AmbientLight, AxesHelper, DirectionalLight, GridHelper, PerspectiveCamera, Scene, WebGLRenderer,Object3D } from \"three\";\r\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader'\r\nimport {mergeGeometries}  from \"three/examples/jsm/utils/BufferGeometryUtils.js\";\r\nimport IFCGLBFile from \"./IFCGLBFile\";\r\nimport IFCFile from \"./IFCFile\";\r\nimport IFCDBSparql from \"./IFCDBSparql\";\r\n\r\n\r\nclass IFCDB\r\n{\r\n    onlyOnce=true;\r\n    pickGroup=null;\r\n    rootGroup=null;\r\n\r\n    ifcfiles=[];\r\n\r\n    inputChanged=false;\r\n    loadingInProgress=false;\r\n    ifcdbsparql=null;\r\n  //sparql variant\r\n   latestBindings=null;\r\n   selectOnlySparqlResults=false;\r\n\r\n\r\n   tx=0;\r\n   ty=0;\r\n   tz=0;\r\n\r\n     \r\n constructor()\r\n {\r\n    //  console.log(\"creating IFCDB.....\");\r\n    this.ifcdbsparql=new IFCDBSparql(this);\r\n }\r\n\r\n\r\nprocessedAll(reusepickgroup)\r\n{\r\n var center=null;\r\n\r\n \r\n  if(this.inputChanged)\r\n  {\r\n      //console.log(\"we should update so not processing\");\r\n     // console.log(\"loading fasle\",this.loadingInProgress);\r\n      this.loadingInProgress=false;\r\n      this.inputChanged=false;\r\n      this.viewer.updateRender(true);\r\n\r\n      return;\r\n\r\n  }\r\n\r\n\r\n\r\n  this.emptyScene();\r\n \r\n\r\n      if (this.ifcdbsparql.useSparqlColors())\r\n      {\r\n       // console.log(\"setting sparql based colors\");\r\n        this.loadingInProgress=false;\r\n        this.ifcdbsparql.setSparqlColors();\r\n      }\r\n      else\r\n      {\r\n       // console.log(\"setting default colors\");\r\n        this.defaultColor();\r\n      \r\n      }\r\n      \r\n      \r\n\r\n\r\n   if ((this.pickGroup!=null) && (reusepickgroup) )\r\n   {\r\n      console.log(\"reusing pickgroup\")\r\n   }\r\n   else\r\n   {\r\n        this.pickGroup=null;\r\n        this.createNewPickGroup();\r\n   }\r\n  //console.log(\"ready inserting\");\r\n\r\n  if (this.onlyOnce)\r\n  \r\n  {\r\n    \r\n\r\n    //console.log(\"fit camera\",this.viewer.viewer.scene);\r\n    let l =this.viewer.viewer.scene.children.length;\r\n    //this.viewer.viewer.fitCameraToCenteredObject(this.viewer.viewer.scene.children[l-1]);\r\n\r\n    //this.onlyOnce=false;\r\n  }\r\n\r\n  //this.viewer.viewer.camera.near=100;\r\n  //this.viewer.viewer.camera.updateProjectionMatrix();\r\n\r\n  this.viewer.viewer.controls.update();\r\n  this.viewer.viewer.setSelectedGuid();\r\n  this.viewer.viewer.setAnimeerAantal(20);\r\n\r\n\r\n\r\nthis.viewer.props.setLoading(false);\r\n//console.log(\"loading fasle\",this.loadingInProgress);\r\nthis.loadingInProgress=false;\r\n\r\nwindow.top.scene=this.viewer.viewer.scene;// for debug\r\nif (this.needsTranslation()) \r\n{\r\n   // this.performTranslation(reusepickgroup);\r\n}\r\n;\r\nthis.translateIntoView();\r\n\r\n \r\n}\r\n\r\nperformTranslation(reusepickgroup)\r\n{\r\n  if (this.onlyOnceTranslationDebug==true) return;\r\n  this.onlyOnceTranslationDebug=true;\r\n\r\n  const aabb = new Box3().setFromObject(this.viewer.viewer.scene);\r\n  const center = aabb.getCenter( new Vector3() );\r\n   // console.log(\"needs translation so we should do this \",center);\r\n    for (var fn in this.ifcfiles)\r\n    {\r\n      var ifc = this.ifcfiles[fn];\r\n      if (!ifc.visible) continue;\r\n      ifc.processGLTF(ifc.gltf,center);\r\n    }\r\n\r\n\r\n    this.processedAll(reusepickgroup);\r\n\r\n\r\n}\r\n\r\nneedsTranslation()\r\n{\r\n // const aabb = new Box3().setFromObject(this.viewer.viewer.scene);\r\n  const aabb = new Box3().setFromObject(this.rootGroup);\r\n  const center = aabb.getCenter( new Vector3() );\r\n  var size = aabb.getSize( new Vector3() );\r\n \r\n  if ((Math.abs(center.x)>1000) || (Math.abs(center.y)>1000) || (Math.abs(center.z)>1000) )\r\n  {\r\n  \r\n    return true;\r\n  }\r\n  else\r\n  {\r\n    console.log(\"no need for extra translations\");\r\n  }\r\n  return false;\r\n}\r\n\r\n\r\ntranslateIntoView()\r\n{\r\n  this.viewer.viewer.zoomAt(this.rootGroup);\r\n  console.log(\"translate into view\");\r\n \r\n   \r\n  \r\n}\r\n\r\n\r\n\r\ngetDefaultColor(color,defaultMat)\r\n{\r\n\r\n  var hint=this.viewer.props[\"visualisation hint\"];\r\n  if (hint==null)hint=\"normal\";\r\n\r\n  //var mat= new MeshStandardMaterial({color:color}); //good!\r\n\r\n  var mat = new MeshPhysicalMaterial({color:color});\r\n  \r\n\r\n  if (hint==\"grey\")\r\n  {\r\n    mat = new MeshPhysicalMaterial({color:\"#c0c0c0\"});\r\n    mat.vertexColors=false;//bijna zeker\r\n    mat.fog=true;\r\n   \r\n  }\r\n  if (hint==\"greytransparent\")\r\n  {\r\n    mat = new MeshPhysicalMaterial({color:\"#c0c0c0\"});\r\n    mat.vertexColors=false;//bijna zeker\r\n    mat.fog=true;\r\n    mat.transparent=true;\r\n    mat.opacity=0.4;\r\n   \r\n  }\r\n\r\n  if (hint==\"greyverytransparent\")\r\n  {\r\n    mat = new MeshPhysicalMaterial({color:\"#c0c0c0\"});\r\n    mat.vertexColors=false;//bijna zeker\r\n    mat.fog=true;\r\n    mat.transparent=true;\r\n    mat.opacity=0.1;\r\n   \r\n  }\r\n\r\n  if (hint==\"nice\")\r\n  {\r\n    mat= new MeshPhongMaterial({shininess: 50,emissiveIntensity:0.2,lightMapIntensity:0.4,emissive:color});\r\n    mat.vertexColors=false;//bijna zeker\r\n    mat.fog=true;\r\n   \r\n  }\r\n\r\n  if (hint==\"normal\")\r\n  {\r\n   // mat.vertexColors=false;//bijna zeker\r\n    //mat.fog=true;\r\n    if (defaultMat!=null)\r\n    {\r\n      //mat=defaultMat;\r\n    }\r\n    mat.transparent=true;\r\n    mat.opacity=0.99;\r\n   \r\n \r\n  }\r\n  if (hint==\"transparent\")\r\n  {\r\n    mat.transparent=true;\r\n    mat.opacity=0.4;\r\n  }\r\n  if (hint==\"vtransparent\")\r\n  {\r\n    mat.transparent=true;\r\n    mat.opacity=0.1;\r\n  }\r\n\r\n  if (hint==\"toon\")\r\n  {\r\n    mat=new MeshToonMaterial({shininess: 50,emissiveIntensity:0.2,lightMapIntensity:0.4,emissive:color,color:color})\r\n  \r\n  }\r\n  if (hint==\"toontransparent\")\r\n  {\r\n    mat=new MeshToonMaterial({shininess: 50,emissiveIntensity:0.2,lightMapIntensity:0.4,emissive:color,color:color})\r\n    mat.transparent=true;\r\n    mat.opacity=0.4;\r\n  \r\n  }\r\n\r\n  mat.depthWrite =true;\r\nreturn mat;\r\n}\r\n\r\ndefaultColor()\r\n{\r\n \r\n  for (var fn in this.ifcfiles)\r\n  {\r\n    var ifc = this.ifcfiles[fn];\r\n    if (!ifc.visible) continue;\r\n\r\n    let colorMat={};\r\n    \r\n    \r\n\r\n   if (!ifc.simpleMode)\r\n   {\r\n\r\n      for (var key in ifc.allBFGs)\r\n        {\r\n          let color=ifc.allFirstChild[key];\r\n          let mat2 =ifc.allFirstMaterial[key];\r\n          var mat=this.getDefaultColor(color,mat2);\r\n          colorMat[key]=mat;\r\n        }\r\n        this.processColoring(ifc.allBFGs,colorMat);\r\n    }\r\n    else\r\n    {\r\n      ifc.addDefaultToScene();\r\n    //  console.log(ifc.gltf);\r\n    }\r\n  }\r\n\r\n}\r\n\r\nprocessColoring(colorHash,colorMat)\r\n{\r\n  // console.log(\"inserting array objects into scene \",colorHash,colorMat);\r\n   this.colorMat=colorMat;\r\n  var rar=[];\r\n   \r\n    var latestChild=null;\r\n    for (var key in colorHash)\r\n    {\r\n      var ar = colorHash[key];\r\n      var cchild2=new Mesh();\r\n      latestChild=cchild2;\r\n     \r\n      if ((ar==null) || (ar.length==0) ) continue;\r\n\r\n     // cchild2.geometry=BufferGeometryUtils.mergeBufferGeometries(ar);\r\n     \r\n     cchild2.geometry=mergeGeometries(ar);\r\n     \r\n       var mat  = colorMat[key];\r\n       cchild2.material=mat;\r\n       cchild2.matrixAutoUpdate=false;\r\n       cchild2.castShadow=false;\r\n       cchild2.receiveShadow=false;\r\n       this.rootGroup.add(cchild2);\r\n       rar.push(cchild2);\r\n    }\r\n    \r\n\r\n  return rar;\r\n}\r\n\r\n\r\ngetNewRootGroup(b)\r\n{\r\n    var g =new Group();\r\n    g.matrixAutoUpdate=true;\r\n    g.castShadow=true;\r\n    g.receiveShadow=true;\r\n    return g;\r\n}\r\n\r\n\r\n\r\ngetPickGroup()\r\n{\r\n   if (this.pickGroup!=null) return this.pickGroup.children;\r\n   return [];\r\n}\r\n\r\n\r\ncreateNewPickGroup()\r\n{\r\n \r\n   this.pickGroup=this.getNewRootGroup();\r\n \r\n   for (var fn in this.ifcfiles)\r\n   {\r\n        var ifc = this.ifcfiles[fn];\r\n        if (!ifc.visible) continue;\r\n\r\n        if (ifc.simpleMode)\r\n        {\r\n          \r\n          this.pickGroup.add(ifc.getDefaultScene().clone(true));\r\n        }\r\n        else\r\n        {\r\n     \r\n              for (var n in ifc.allNodes)\r\n              {\r\n                try\r\n                {\r\n                  \r\n                var mesh=new Mesh();\r\n                var child =ifc.allNodes[n];\r\n\r\n                mesh.geometry=child.geometry;\r\n                if (mesh.geometry==null) continue;\r\n                mesh.ifcguid=child.name;\r\n\r\n                var c=null;\r\n                if (this.selectOnlySparqlResults)\r\n                {\r\n                  try {c=this.ifcdbsparql.guid_color[mesh.ifcguid];} catch(e){}\r\n                  if (c!=null)\r\n                  {\r\n                      this.pickGroup.add(mesh);\r\n                      mesh.updateMatrix();\r\n                      mesh.updateWorldMatrix(true,true);\r\n                  }\r\n\r\n                }\r\n                else\r\n                {\r\n                  this.pickGroup.add(mesh);\r\n                  mesh.updateMatrix();\r\n                  mesh.updateWorldMatrix(true,true);\r\n                }\r\n            \r\n                }\r\n                catch(e){}\r\n                \r\n\r\n              }\r\n    }\r\n  }\r\n\r\n  //console.log(\"created pickgroup children \",this.pickGroup.children.length);\r\n   return  this.pickGroup.children;\r\n\r\n}\r\n\r\n\r\n\r\n  shouldLoadNewFiles(files)\r\n  {\r\n  \r\n    for (var n in files)\r\n    {\r\n      var nfile =files[n];\r\n      var f =this.getIFCFile(nfile);\r\n      if (f==null) return true;\r\n      if (f.visible==false) return true;\r\n    }\r\n    // zijn er ook ifc files visible die niet visible moeten zijn?\r\n     for (var n in this.ifcfiles)\r\n     {\r\n        var ifc =this.ifcfiles[n];\r\n        if (ifc.visible)\r\n        {\r\n          if (files.includes(ifc.name)==false) return true;\r\n        }\r\n     }\r\n\r\n   \r\n\r\nreturn false;\r\n    \r\n\r\n  }\r\n\r\n  getChild(guid)\r\n  {\r\n    for (var n in this.ifcfiles)\r\n    {\r\n      var ifcFile=this.ifcfiles[n];\r\n      if (ifcFile.visible)\r\n      {\r\n           var child = ifcFile.getChild(guid);\r\n           if (child!=null) return child;\r\n\r\n      }\r\n    }\r\n  }\r\n\r\n  setVisible(b)\r\n  { \r\n    for (var n in this.ifcfiles)\r\n    {\r\n      var ifcFile=this.ifcfiles[n];\r\n      ifcFile.visible=b;\r\n    }\r\n  }\r\n  isEmpty()\r\n  {\r\n    \r\n    for (var n in this.ifcfiles)\r\n    {\r\n      var ifcFile=this.ifcfiles[n];\r\n      if (ifcFile.visible) return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\nemptyScene()\r\n{\r\n\r\n  if (this.viewer.viewer.scene!=null)  \r\n    {\r\n\r\n      this.viewer.viewer.createNewScene(this.viewer.viewer.scene);\r\n      this.viewer.viewer.controls.enabled=true;\r\n      this.viewer.viewer.orbiting=true;\r\n      this.rootGroup=this.getNewRootGroup(false);\r\n      this.viewer.viewer.scene.add(this.rootGroup);\r\n     \r\n    }\r\n}\r\n\r\nloadGLBFiles(viewer,files)\r\n  {\r\n    this.viewer=viewer;\r\n    \r\n    //console.log(\"loadGLBFiles called \",this.loadingInProgress,files);\r\n     if (this.loadingInProgress)\r\n     { \r\n            console.log(\"not loading glb files because already loading \");\r\n       return     false;\r\n     }\r\n \r\n     this.loadingInProgress=true;\r\n\r\n     this.asyncLoadGLBFiles(viewer,files.slice());\r\n\r\n  }\r\n\r\n  getIFCFile(file)\r\n  {\r\n     for (var n in this.ifcfiles)\r\n     {\r\n\r\n        if (this.ifcfiles[n].name==file) return this.ifcfiles[n];\r\n     }\r\n     return null;\r\n  }\r\n\r\n // async asyncLoadGLBFiles(viewer,files)\r\n  asyncLoadGLBFiles(viewer,files)\r\n  {\r\n   \r\n   var me=this;\r\n \r\n    this.loadedfiles=files;\r\n  \r\n    var me = this;\r\n   \r\n      this.reset();\r\n    this.setVisible(false);\r\n\r\n       \r\n   // console.log(\"setting amount of files to be loaded \",this.tobeprocessedFiles);\r\n   var loadingNewFiles = false;\r\n    for (var n in files)\r\n    {\r\n                var file = files[n];\r\n              \r\n                var ifcFile=this.getIFCFile(file);\r\n                if (ifcFile!=null)\r\n                {\r\n                  ifcFile.visible=true;\r\n                \r\n                   continue;\r\n                }\r\n               \r\n                loadingNewFiles=true;\r\n              \r\n                if (file.toLowerCase().endsWith(\".glb\"))\r\n                {\r\n                   var simpleMode=this.viewer.props.simpleMode;\r\n                  // console.log(\"simple mode \",simpleMode);\r\n                   \r\n                  var ifcFile = new IFCGLBFile(this,file,function(){me.readyLoading()},simpleMode);\r\n                  this.ifcfiles.push(ifcFile);\r\n                }\r\n                else\r\n                {\r\n                  if (file.toLowerCase().endsWith(\".ifc\"))\r\n                  {\r\n                \r\n                    var ifcFile = new IFCFile(this,file,function(){me.readyLoading()});\r\n                    this.ifcfiles.push(ifcFile);\r\n                  }\r\n                  else\r\n                  {\r\n                    console.log(\"cannot load file \");\r\n                  // window.alert(\"cannot load file \"+file);\r\n                    me.readyLoading();\r\n                  }\r\n                }\r\n\r\n\r\n               \r\n           \r\n                //)\r\n      }\r\n\r\n      if (loadingNewFiles==false)\r\n      {\r\n         this.processedAll();\r\n      }\r\n\r\n   \r\n  }\r\nreadyLoading()\r\n{\r\n  //console.log(\"ready loading called\");\r\n  for (var n in this.ifcfiles)\r\n  {\r\n    if (this.ifcfiles[n].loading) return;\r\n  }\r\n // console.log(\"all are loading to processing them all\");\r\n  this.processedAll();\r\n}\r\n \r\n\r\n reset()\r\n {\r\n  \r\n  \r\n  //console.log(\"RESET empy\");\r\n  \r\n\r\n }\r\n\r\n\r\n\r\n\r\n\r\n\r\n  processSparqlResults(viewer)\r\n {\r\n    if (viewer.props.data==null) return;\r\n        this.viewer=viewer;\r\n        var bindings = viewer.props.data.results.bindings;\r\n\r\n     \r\n        \r\n       this.processBindings(bindings);\r\n\r\n }\r\n\r\n \r\n processBindings(bindings)\r\n {\r\n  //process sparql bindings icm glb files\r\n  if (bindings==this.latestBindings) return;\r\n      var viewer= this.viewer;\r\n\r\n        var lm =new LoadingManager();\r\n        var loader = new GLTFLoader(lm);\r\n        var me =this;\r\n       \r\n        \r\n          \r\n          // console.log(\"really processing sparql results geometry\");\r\n           if (viewer.scene!=null)  \r\n           {\r\n             viewer.createNewScene(viewer.scene);\r\n           }\r\n\r\n\r\n           this.latestBindings=bindings;\r\n           this.reset();\r\n\r\n           this.tobeprocessedBindings=bindings.length;\r\n           this.aantalBindings=0;\r\n          // console.log(\"aantal bindingen:\"+  this.tobeprocessedBindings);\r\n           loader = new GLTFLoader();\r\n           var aantal=0;\r\n      \r\n        for (var n in bindings)\r\n        {\r\n          aantal++;\r\n        \r\n         \r\n          try{\r\n                    var binding = bindings[n];\r\n                    var gltfB= binding.gltf.value;\r\n                    gltfB =JSON.parse(gltfB);\r\n                   \r\n\r\n                    var uri= binding.uri.value;\r\n                    gltfB.userData={uri:uri};\r\n                    gltfB.name=uri;\r\n\r\n                 \r\n                    loader.parse(gltfB,\"\",function(gltf){\r\n                     \r\n                      //  let child = gltf.scene.children[0];\r\n                         if  ((gltf.scene!=null) && (gltf.scene.children!=null))\r\n                         {\r\n                            me.aantalBindings++;\r\n                            me.processGLTFElement(gltf.scene.children[0],true);\r\n                         }\r\n                         else\r\n                         {\r\n\r\n                          this.aantalBindings++;\r\n                         }\r\n                    },function(err){console.log(err);})\r\n                 \r\n          }\r\n          catch(e)\r\n          {\r\n            console.log(e);\r\n            this.aantalBindings++;\r\n          }\r\n        \r\n          \r\n        }\r\n        console.log(\"klaar met bindingen\");\r\n   }\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n \r\n\r\n}\r\n\r\nexport default IFCDB;\r\n","import {Color,Box3,OrthographicCamera,Vector3,HemisphereLight,HemisphereLightHelper,Mesh,BufferGeometry,PointLight, Vector2,Raycaster,MeshToonMaterial, MeshPhongMaterial,MeshLambertMaterial,SpotLight,AmbientLight, AxesHelper, DirectionalLight, GridHelper, PerspectiveCamera, Scene, WebGLRenderer,Object3D } from \"three\";\r\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader'\r\nimport { OrbitControls } from \"three/examples/jsm/controls/OrbitControls\";\r\nimport { MeshoptDecoder } from 'three/examples/jsm/libs/meshopt_decoder.module.js';\r\n//import { KTX2Loader } from 'three/examples/jsm/loaders/KTX2Loader.js';\r\n//import { DRACOLoader } from 'three/examples/jsm/loaders/DRACOLoader.js';\r\n\r\n\r\nimport  \"popper.js\"\r\nimport tippy,{followCursor} from \"tippy.js\"\r\n\r\nimport 'tippy.js/dist/tippy.css'; \r\nimport 'tippy.js/dist/backdrop.css';\r\nimport 'tippy.js/animations/shift-away.css';\r\n\r\nimport * as OBC from \"openbim-components\";\r\nimport gsap from \"gsap\";\r\n//import \"./tippy.js/dist/tippy-bundle.cjs.js\"\r\n\r\n\r\n\r\nclass ThreeJSViewer\r\n\r\n{\r\n  viewer=null;\r\n  scene=null;\r\n   // ifcLoader=null;\r\n    renderer=null;\r\n    raycaster=null;\r\n    //acceleratedRaycast=null;\r\n    camera=null;\r\n    pointer=new Vector2();\r\n    selectedChild=null;\r\n    hooverChild=null;\r\n    orbiting=false;\r\n    threeCanvas=null;\r\n    animeerAantal=10;\r\n\r\n\r\n\r\n    initViewerNT(viewer)\r\n    {\r\n       this.viewer=viewer;\r\n\r\n       const tcid=\"three-canvas\"+this.viewer.id;\r\n       const threeCanvas = document.getElementById(tcid);\r\n      \r\n       this.threeCanvas=threeCanvas;\r\n\r\n       const components = new OBC.Components();\r\n       components.scene = new OBC.SimpleScene(components);\r\n       components.renderer = new OBC.SimpleRenderer(components, threeCanvas);\r\n       \r\n        this.renderer = components.renderer;\r\n       // renderer.postproduction.outlineColor = 0x999999;\r\n\r\n        const camera =  new OBC.SimpleCamera(components);\r\n        components.camera = camera;\r\n        \r\n        this.camera=camera;\r\n       components.raycaster = new OBC.SimpleRaycaster(components);\r\n       \r\n       components.init();\r\n\r\n\r\n\r\n       \r\n       // Add some elements to the scene\r\n       \r\n       const scene = components.scene.get();\r\n     this.scene=scene;\r\n\r\n\r\n     const shadows = new OBC.ShadowDropper(components);\r\n\r\n\r\n\r\n     const directionalLight = new DirectionalLight();\r\ndirectionalLight.position.set(5, 10, 3);\r\ndirectionalLight.intensity = 0.5;\r\nscene.add(directionalLight);\r\n\r\nconst ambientLight = new AmbientLight();\r\nambientLight.intensity = 0.5;\r\nscene.add(ambientLight);\r\n\r\n\r\n\r\nconst grid = new OBC.SimpleGrid(components);\r\n    components.tools.add(grid);\r\n    this.grid=grid.get();\r\n  //  renderer.postproduction.excludedItems.add(grid.get());\r\n    this.raycaster = new Raycaster();\r\n\r\n\r\n\r\n    }\r\n\r\n\r\n\r\n     initViewer(viewer)\r\n    {\r\n          this.viewer=viewer;\r\n    /*      if (false)\r\n          {\r\n          BufferGeometry.prototype.computeBoundsTree = computeBoundsTree;\r\n          BufferGeometry.prototype.disposeBoundsTree = disposeBoundsTree;\r\n          Mesh.prototype.raycast = acceleratedRaycast;\r\n          }\r\n          */\r\n          //this.setState({loading:false});\r\n\r\n            \r\n            const tcid=\"three-canvas\"+this.viewer.id;\r\n          const threeCanvas = document.getElementById(tcid);\r\n         \r\n          this.threeCanvas=threeCanvas;\r\n                    \r\n          // Object3D.DefaultUp.set(0, 1, 0);\r\n          let canvasBounds = threeCanvas.getBoundingClientRect();\r\n          \r\n          var width = canvasBounds.right - canvasBounds.left;\r\n          var height=canvasBounds.bottom - canvasBounds.top;\r\n      \r\n       \r\n   \r\n                       \r\n                           const size = {\r\n                               width: width,\r\n                               height: height,\r\n                             };\r\n                         \r\n                             const scene = new Scene();\r\n                   const aspect = size.width / size.height;\r\n                 \r\n                   const camera = new PerspectiveCamera(75, aspect);\r\n                   camera.position.z = 15;\r\n                   camera.position.y = 13;\r\n                   camera.position.x = 8;\r\n                   camera.near=1;\r\n                   camera.far=1000;\r\n                  \r\n                    this.camera=camera;\r\n   \r\n                   var pointLight = new PointLight( 0xffffff,1250 );\r\n                   pointLight.position.set(0,-10,0);\r\n                   camera.add(pointLight);\r\n   \r\n   \r\n   \r\n                   //Creates the lights of the scene\r\n                  \r\n                   scene.background = new Color( 0xeeeeee );\r\n                 \r\n   \r\n                   //Sets up the renderer, fetching the canvas of the HTML\r\n                   \r\n                   const renderer = new WebGLRenderer({\r\n                     canvas: threeCanvas,\r\n                     alpha: true,\r\n                     powerPreference:\"high-performance\",\r\n                     antialias:true,\r\n                     logarithmicDepthBuffer: true,\r\n                     sortObjects: true,\r\n                     colorManagement: true\r\n                   });\r\n\r\n\r\n                   \r\n                 \r\n\r\n                  // renderer.physicallyCorrectLights = true;\r\n                   renderer.setPixelRatio( window.devicePixelRatio );\r\n\r\n                 \r\n                   this.renderer=renderer;\r\n                   this.raycaster = new Raycaster();\r\n   \r\n                   renderer.setSize(size.width, size.height);\r\n                  // renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));\r\n                   this.renderer=renderer;\r\n                   //Creates grids and axes in the scene\r\n                   const grid = new GridHelper(50, 30);\r\n                 \r\n                   this.grid=grid;\r\n   \r\n                   const axes = new AxesHelper();\r\n                   axes.material.depthTest = false;\r\n                   axes.renderOrder = 1;\r\n\r\n                   if (true)\r\n                   {\r\n                      scene.add(axes);\r\n                       scene.add(grid);\r\n                   }\r\n   \r\n                   //Creates the orbit controls (to navigate the scene)\r\n                   const controls = new OrbitControls(camera, threeCanvas);\r\n                   controls.enableDamping = true;\r\n                   controls.target.set(-2, 0, 0);\r\n                   this.controls=controls;\r\n   \r\n                   //Animation loop\r\n                   this.animeerAantal=50;\r\n                   var me = this;\r\n   \r\n                   const animate = () => {\r\n                     if (me.animeerAantal>0)\r\n                     {\r\n                       controls.update();\r\n                       renderer.render(scene, camera);\r\n                       me.animeerAantal--;\r\n                     }\r\n                     if (me.animeerAantal>100)\r\n                     {\r\n                      me.animeerAantal=100;\r\n                     }\r\n                     requestAnimationFrame(animate);\r\n                     \r\n                   };\r\n   \r\n                   animate();\r\n                   \r\n                  \r\n                  \r\n                     renderer.render(scene, camera);\r\n                     controls.addEventListener(\"change\", () => \r\n                     {\r\n                       this.animeerAantal=50;\r\n                       });\r\n                       controls.addEventListener(\"start\", () => \r\n                       {\r\n                         this.orbiting=true;\r\n                       });\r\n                       controls.addEventListener(\"end\", () => \r\n                       {\r\n                         this.orbiting=false;\r\n                       });\r\n                  \r\n   \r\n                   //Adjust the viewport to the size of the browser\r\n                 \r\n   \r\n                   threeCanvas.addEventListener(\"hide\",(event)=>{\r\n                    console.log(event);\r\n                   });\r\n\r\n                   threeCanvas.addEventListener(\"mousemove\",(event)=>{\r\n                   \r\n                     if (this.orbiting) return;\r\n                     this.mousemove(event);\r\n                   },false)\r\n\r\n\r\n                   threeCanvas.addEventListener(\"click\",(event)=>{\r\n                  \r\n                    this.mouseclick(event);\r\n                  },false)\r\n\r\n                  threeCanvas.addEventListener(\"dblclick\",(event)=>{\r\n                  \r\n                    this.mouseDoubleClick(event);\r\n                  },false)\r\n                \r\n                   this.scene=scene;\r\n                   this.camera=camera;\r\n                   camera.updateProjectionMatrix();\r\n                 \r\n    }\r\n    resize()\r\n    {\r\n       try\r\n       {\r\n        const tcid=\"three-canvas\"+this.viewer.id;\r\n      const threeCanvas = document.getElementById(tcid);\r\n             let canvasBounds = threeCanvas.getBoundingClientRect();\r\n\r\n               var width = canvasBounds.right - canvasBounds.left+200;\r\n               var height=canvasBounds.bottom - canvasBounds.top+200;\r\n\r\n                         \r\n                           \r\n                               const size = {\r\n                                   width: width,\r\n                                   height: height,\r\n                                 };\r\n           var camera=this.camera;\r\n           camera.aspect = size.width / size.height;\r\n           camera.updateProjectionMatrix();\r\n           this.renderer.setSize(size.width, size.height);\r\n           this.animeerAantal=50;\r\n                                }\r\n                                catch(e)\r\n                                {}\r\n\r\n    }\r\n\r\n    \r\n     createNewScene(scene)\r\n    {\r\n      if (scene==null) scene=this.scene;\r\n\r\n    //  console.log(\"new scene\");\r\n       scene.clear();\r\n       const lightColor = 0x888888;\r\n       const lightColor2 = 0x445544;\r\n\r\n\r\n       const light = new HemisphereLight( 0xffffbb, 0x080820, 1 );\r\n   // const helper = new HemisphereLightHelper( light, 5 );\r\n       scene.add( light );\r\n\r\n     \r\n    \r\n       const ambientLight = new AmbientLight(lightColor, 0.01);\r\n       //scene.add(ambientLight);\r\n    \r\n       var directionalLight = new SpotLight(lightColor2, 0.7);\r\n       directionalLight.castShadow = true;\r\n       directionalLight.position.set(250, 250, 250);\r\n       directionalLight.target.position.set(0, 0, 0);\r\n     //  directionalLight.target.position.set(0, 1000, 0);\r\n       scene.add(directionalLight);\r\n       //scene.add(directionalLight.target);\r\n    \r\n    \r\n       var directionalLight = new SpotLight(lightColor, .5);\r\n       directionalLight.castShadow = true;\r\n       directionalLight.position.set(0, -250, -250);\r\n       directionalLight.target.position.set(0, 0, 0);\r\n     //  directionalLight.target.position.set(0, 1000, 0);\r\n       scene.add(directionalLight);\r\n       scene.add(directionalLight.target);\r\n       \r\n    \r\n    \r\n         //Creates grids and axes in the scene\r\n         const grid = new GridHelper(80, 80);\r\n       \r\n        \r\n       const axes = new AxesHelper();\r\n       axes.material.depthTest = false;\r\n       axes.renderOrder = 1;\r\n       if (false)\r\n       {\r\n        scene.add(axes);\r\n        scene.add(grid);\r\n       }\r\n       this.setAnimeerAantal(1);\r\n       this.resize();\r\n    \r\n    }\r\n\r\n\r\n    \r\ngetIntersection(event)\r\n{\r\n\r\n //if(true) return;\r\n if (this.orbiting)return null;\r\n if (this.raycaster==null)return null;\r\n\r\n  event.preventDefault();\r\n  \r\n  let canvasBounds = this.renderer.getContext().canvas.getBoundingClientRect();\r\n  this.pointer.x = ( ( event.clientX - canvasBounds.left ) / ( canvasBounds.right - canvasBounds.left ) ) * 2 - 1;\r\n  this.pointer.y = - ( ( event.clientY - canvasBounds.top ) / ( canvasBounds.bottom - canvasBounds.top) ) * 2 + 1;\r\n  var pg = this.viewer.ifcdb.getPickGroup();\r\n  this.raycaster.setFromCamera(this.pointer,this.camera);\r\n\r\n  if (pg==null) return;\r\n  try\r\n  {\r\n  var intersects = this.raycaster.intersectObjects(pg, true);\r\n  return intersects;\r\n  }\r\n  catch(e)\r\n  {console.log(e);}\r\n  return null;\r\n\r\n}\r\n\r\nmousemove(event)\r\n{\r\n try\r\n {\r\n     var intersects = this.getIntersection(event);\r\n     if (intersects==null) return ;\r\n  if (intersects.length>0)\r\n  {\r\n   \r\n    var child = intersects[0].object;\r\n\r\n    child=child.clone();\r\n\r\n    //console.log(child,this.selectedChild);\r\n\r\n      if ((this.hooverChild!=null) && (child==this.hooverChild.children[0])) { return;}\r\n      if ((this.selectedChild!=null) && (child==this.selectedChild.children[0])) { return;}// no hoovering on selected objects\r\n      \r\n    if (child.orgMatrix==null)\r\n    { child.orgMatrix=child.matrix;\r\n\r\n      //child.matrix.multiply(root.matrix );\r\n    }\r\n     // console.log(\"Found a child\",child,intersects);\r\n    if (child.orgMaterial==null) child.orgMaterial=child.material;\r\n    child.material=new MeshPhongMaterial({color:0x0000ff,specular: 0xaaaaaa,shininess: 1000,emissive:0x0000ff});\r\n    child.material.opacity=0.5;\r\n    child.renderOrder=10;\r\n    if (this.hooverChild!=null)\r\n    {\r\n      this.scene.remove(this.hooverChild);\r\n    }\r\n    var root =this.viewer.ifcdb.getNewRootGroup();\r\n    this.hooverChild=root;\r\n    root.add(child)\r\n    this.scene.add(root);\r\n     // console.log(child);\r\n      var msg=null;\r\n      try {\r\n        msg=this.viewer.ifcdb.ifcdbsparql.getLabel(child.geometry.guid);\r\n      } catch(e){}\r\n      if (msg!=null)\r\n      {\r\n      //\r\n        this.showTippy(msg);\r\n      }\r\n      else{\r\n        this.showTippy(\"IFC GUID:\"+child.geometry.guid);\r\n      }\r\n  }\r\n  else\r\n  {\r\n    if (this.hooverChild!=null)\r\n    {\r\n      this.scene.remove(this.hooverChild);\r\n      this.destroyTippy();\r\n    }\r\n  \r\n  }\r\n\r\n  this.setAnimeerAantal(1);\r\n  \r\n\r\n\r\n\r\n }\r\n catch(e)\r\n {\r\n    console.log(e);\r\n }\r\n\r\n}\r\nsetAnimeerAantal(aantal)\r\n{\r\n  this.animeerAantal+=aantal;\r\n}\r\n\r\nsetSelectedGuid()\r\n{\r\n\r\n\r\nvar newGuid = this.viewer.props.pubsub[this.viewer.props.guidselector];\r\n            if ((newGuid!=null) && (newGuid!=this.selectedGuid) )\r\n            {\r\n              var child=this.viewer.ifcdb.getChild(newGuid);\r\n              if (child!=null)\r\n              {\r\n              \r\n                var mesh =new Mesh();\r\n                mesh.geometry=child.geometry;\r\n                mesh.name=child.name;\r\n                var par=this.viewer.props[\"guidpublishparameter\"];\r\n                if (par!=null)\r\n              {\r\n                this.viewer.props.publish(par,child.name);\r\n                this.showSelectChild(mesh);\r\n              }\r\n              else\r\n              {\r\n                   console.log(\"could not find child\");\r\n              }\r\n\r\n\r\n            }\r\n          }\r\n\r\n\r\n\r\n}\r\nmouseDoubleClick(event)\r\n{\r\n  if (this.selectedChild!=null)\r\n  {\r\n    this.zoomAt(this.selectedChild,4);\r\n  }\r\n  \r\n}\r\n\r\nmouseclick(event)\r\n{\r\n\r\n if (this.orbiting)return;\r\n event.preventDefault();\r\nvar intersects = this.getIntersection(event);\r\nif (intersects==null) \r\n{\r\n  if (this.selectedChild!=null)\r\n  {\r\n    this.scene.remove(this.selectedChild);\r\n    this.selectedGuid=null;\r\n  }\r\nreturn ;\r\n}\r\n\r\n\r\nif (intersects.length>0)\r\n{\r\n \r\n  var child = intersects[0].object;\r\n\r\n  this.showSelectChild(child);\r\n\r\n  var par=this.viewer.props[\"guidpublishparameter\"];\r\n  if (par!=null)\r\n  {\r\n      this.viewer.props.publish(par,intersects[0].object.ifcguid);\r\n  }\r\n//guidpublishparameter\r\n\r\n\r\n\r\n\r\n}\r\nelse\r\n{\r\n  if (this.selectedChild!=null)\r\n  {\r\n   // this.scene.remove(this.selectedChild);\r\n  }\r\n}\r\n\r\n\r\n\r\n}\r\n\r\n\r\nshowSelectChild(child)\r\n{\r\n\r\n// console.log(\"geen par gevonden \",intersects[0].object)\r\nchild=child.clone();\r\n\r\n//console.log(child,this.selectedChild);\r\n\r\n  if ((this.selectedChild!=null) && (child==this.selectedChild.children[0])) { \r\n  //  console.log(\"show selected child is already selected\")\r\n    return;\r\n  }\r\n  \r\n      if (child.orgMatrix==null)\r\n      { child.orgMatrix=child.matrix;\r\n\r\n        //child.matrix.multiply(root.matrix );\r\n      }\r\n  \r\n // console.log(\"Found a child\",child,intersects);\r\nif (child.orgMaterial==null) child.orgMaterial=child.material;\r\nchild.material=new MeshPhongMaterial({color:0xff0000,specular: 0xaaaaaa,shininess: 1000,emissive:0xff0000});\r\nchild.material.opacity=0;\r\nchild.renderOrder=11;\r\nif (this.selectedChild!=null)\r\n{\r\n  this.scene.remove(this.selectedChild);\r\n  this.selectedGuid=null;\r\n}\r\nvar root =this.viewer.ifcdb.getNewRootGroup();\r\nthis.selectedChild=root;\r\nroot.add(child)\r\nthis.selectedGuid=child.name;\r\nthis.scene.add(root);\r\n\r\nthis.setAnimeerAantal(1);\r\n\r\n\r\n}\r\n\r\n\r\n\r\nzoomAt = (target,distance)=>{\r\n  console.log(\"zoom at\");\r\n  if (distance==null) distance=1;\r\n\tvar camera=this.camera;\r\n  //use this code for a object size agnostic solution; build a bounding box around your object you want to zoom and  get its size: \r\nconst aabb = new Box3().setFromObject( target );\r\nconst center = aabb.getCenter( new Vector3() );\r\nvar size = aabb.getSize( new Vector3() );\r\n\r\n\r\n  //now use gsap and not tweenjs.. never use tweenjs again. never. \r\ngsap.to( camera.position, {\r\nduration: 1,\r\nx: center.x,\r\ny: center.y+3, // place camera a bit higher than the object\r\nz: center.z + size.z+distance, // maybe adding even more offset depending on your model\r\nonUpdate: function() {\r\ncamera.lookAt( target.position ); //important \r\n}\r\n} );\r\nvar orbitControls= this.controls;\r\nthis.setAnimeerAantal(1000);\r\ngsap.to(  this.controls.target, {\r\nduration: 1,\r\nx: center.x,\r\ny: center.y, //set the center of the controler to the zoomed object \r\nz: center.z , // no distance needed\r\nonComplete: ()=>{\r\norbitControls.enabled = true; // activate the controler again after animation\r\nthis.setAnimeerAantal(10);\r\n}\r\n} );\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n showTippy(msg)\r\n{\r\n   try\r\n   {\r\n    if (msg==null)\r\n    {\r\n        msg=\"no info\";\r\n    }\r\n    if (document.tippy==null)\r\n    {\r\n    //  document.tippy=tippy( document.body, {placement:\"followCursor\", plugins: [followCursor],content: msg,followCursor: true  });\r\n    var div=document.getElementById(\"tippydiv\"+this.viewer.id);\r\n    if (div!=null)\r\n    {\r\n      document.tippy=tippy( div, {trigger: 'manual',placement:\"followCursor\", plugins: [followCursor],content: msg,followCursor: true  });\r\n    }\r\n      //document.tippy=tippy( this.threeCanvas, {placement:\"followCursor\", plugins: [followCursor],content: msg,followCursor: true  });\r\n    }\r\n    document.tippy.setContent(msg);\r\n   \r\n\r\n    try {document.tippy.show();} catch(e){}\r\n\r\n      try\r\n      {\r\n     // document.tippy.popperInstance.scheduleUpdate();\r\n      //document.tippy.popperInstance.update();\r\n      }\r\n      catch(e)\r\n      {}\r\n\r\n    \r\n     \r\n    }\r\n    catch(e){} \r\n   \r\n   \r\n    \r\n}\r\n\r\n\r\n destroyTippy()\r\n{\r\n \r\n  try {document.tippy.hide();} catch(e){}\r\n \r\n}\r\n\r\n\r\n\r\n\r\nfitCameraToCenteredObject (object ) {\r\n \r\n  var camera=this.camera;\r\n  var offset=1;\r\n  var orbitControls=this.orbitControls;\r\n\r\n  const boundingBox = new Box3();\r\n  boundingBox.setFromObject( object );\r\n\r\n  var middle = new Vector3();\r\n  var size = new Vector3();\r\n  boundingBox.getSize(size);\r\n\r\n  // figure out how to fit the box in the view:\r\n  // 1. figure out horizontal FOV (on non-1.0 aspects)\r\n  // 2. figure out distance from the object in X and Y planes\r\n  // 3. select the max distance (to fit both sides in)\r\n  //\r\n  // The reason is as follows:\r\n  //\r\n  // Imagine a bounding box (BB) is centered at (0,0,0).\r\n  // Camera has vertical FOV (camera.fov) and horizontal FOV\r\n  // (camera.fov scaled by aspect, see fovh below)\r\n  //\r\n  // Therefore if you want to put the entire object into the field of view,\r\n  // you have to compute the distance as: z/2 (half of Z size of the BB\r\n  // protruding towards us) plus for both X and Y size of BB you have to\r\n  // figure out the distance created by the appropriate FOV.\r\n  //\r\n  // The FOV is always a triangle:\r\n  //\r\n  //  (size/2)\r\n  // +--------+\r\n  // |       /\r\n  // |      /\r\n  // |     /\r\n  // | F° /\r\n  // |   /\r\n  // |  /\r\n  // | /\r\n  // |/\r\n  //\r\n  // F° is half of respective FOV, so to compute the distance (the length\r\n  // of the straight line) one has to: `size/2 / Math.tan(F)`.\r\n  //\r\n  // FTR, from https://threejs.org/docs/#api/en/cameras/PerspectiveCamera\r\n  // the camera.fov is the vertical FOV.\r\n\r\n  const fov = camera.fov * ( Math.PI / 180 );\r\n  const fovh = 2*Math.atan(Math.tan(fov/2) * camera.aspect);\r\n  let dx = size.z / 2 + Math.abs( size.x / 2 / Math.tan( fovh / 2 ) );\r\n  let dy = size.z / 2 + Math.abs( size.y / 2 / Math.tan( fov / 2 ) );\r\n  let cameraZ = Math.max(dx, dy);\r\n\r\n  // offset the camera, if desired (to avoid filling the whole canvas)\r\n  if( offset !== undefined && offset !== 0 ) cameraZ *= offset;\r\n\r\n  camera.position.set( 0, 0, cameraZ );\r\n\r\n  // set the far plane of the camera so that it easily encompasses the whole object\r\n  const minZ = boundingBox.min.z;\r\n  const cameraToFarEdge = ( minZ < 0 ) ? -minZ + cameraZ : cameraZ - minZ;\r\n\r\n  camera.far = cameraToFarEdge * 3;\r\n  camera.updateProjectionMatrix();\r\n\r\n  if ( orbitControls !== undefined ) {\r\n      // set camera to rotate around the center\r\n      orbitControls.target = new Vector3(0, 0, 0);\r\n\r\n      // prevent camera from zooming out far enough to create far plane cutoff\r\n      orbitControls.maxDistance = cameraToFarEdge * 2;\r\n  }\r\n};\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n}\r\n\r\nexport default ThreeJSViewer\r\n","import { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader'\r\nimport { KTX2Loader } from 'three/examples/jsm/loaders/KTX2Loader.js';\r\nimport { DRACOLoader } from 'three/examples/jsm/loaders/DRACOLoader.js';\r\nimport { parseTextForVariables } from '../../../../helpers/sparql';\r\nimport { MeshoptDecoder } from 'three/examples/jsm/libs/meshopt_decoder.module.js';\r\nimport {Box3,Cache,Object3D,Vector3, REVISION,Matrix4,BufferGeometry,LoadingManager } from \"three\";\r\nimport {Mesh,MeshDepthMaterial,MeshPhysicalMaterial,MeshStandardMaterial, MeshDistanceMaterial, MeshToonMaterial, MeshPhongMaterial,MeshLambertMaterial } from \"three\";\r\nimport * as THREE from 'three';\r\nimport IFCGLBFile from './IFCGLBFile';\r\nimport { toInteger } from 'lodash';\r\nimport  {mergeBufferGeometries,mergeGeometries} from \"three/examples/jsm/utils/BufferGeometryUtils.js\";\r\n\r\n\r\n\r\n\r\nexport class GLBFromSparqlResults\r\n{\r\n    constructor(viewer)\r\n    {\r\n        this.viewer=viewer;\r\n        this.ifcdb=viewer.ifcdb;\r\n        if (this.viewer.props.data==null) return;\r\n        try\r\n        {\r\n            var vars=this.viewer.props.data.head.vars;\r\n            for (var n in vars)\r\n            {\r\n                if (vars[n]==\"gltf\")\r\n                {\r\n                          this.processSparql();\r\n                }\r\n            }\r\n            \r\n\r\n        }\r\n        catch(e){\r\n            console.log(e)\r\n        }\r\n    }\r\n\r\n     setupIFCDB()\r\n     {\r\n              \r\n        this.viewer.ifcdb.viewer=this.viewer;\r\n        this.ifcdb.pickGroup=null;\r\n        this.ifcdb.createNewPickGroup();\r\n        this.ifcdb.rootGroup=this.ifcdb.getNewRootGroup();\r\n        this.ifcdb.rootGroup.rotation.x = -Math.PI / 2;\r\n        this.viewer.viewer.scene.add(this.ifcdb.rootGroup);\r\n\r\n\r\n    // part 2\r\n        this.rootGroup=this.ifcdb.getNewRootGroup();\r\n         this.nodes=[];\r\n         this.color_nodes={};\r\n\r\n         if (this.colors==null)\r\n          {\r\n            this.colors=[];\r\n            \r\n            this.colors.push(this.getRandomHexColor());\r\n            this.colors.push(this.getRandomHexColor());\r\n            this.colors.push(this.getRandomHexColor());\r\n            this.colors.push(this.getRandomHexColor());\r\n            this.colors.push(this.getRandomHexColor());\r\n            \r\n          }\r\n         \r\n        \r\n      \r\n     }\r\n\r\n    processSparql()\r\n    {\r\n\r\n        console.log(\"processing sparql results\");\r\n        if (this.viewer.props.data==null) return;\r\n        this.setupIFCDB();\r\n      \r\n       \r\n       var glb=new IFCGLBFile(this.viewer.ifcdb,null,null,null,true);\r\n       this.glb=glb;\r\n       var me=this;\r\n      \r\n       this.loadedN=0;\r\n       this.processedN=0;\r\n        try{\r\n                var bindings=this.viewer.props.data.results.bindings;\r\n                this.resultsN=bindings.length;\r\n             \r\n                for (var b in bindings)\r\n                {\r\n                    var binding=bindings[b];\r\n                    var gltf = binding.gltf.value;\r\n                    var color = null;\r\n                    try {color= binding.color.value;}catch(e){}\r\n                   \r\n                   //  try {  gltf.color=color;} catch(e){gltf=JSON.parse(gltf); gltf.color=color;}\r\n                        var r=glb.loader.parse(gltf,\"\",function(arg){me.onLoad(arg);},function(arg){me.onError(arg);});\r\n                   \r\n                    \r\n                }\r\n        }\r\n         catch(e)\r\n         {console.log(e);}\r\n\r\n                \r\n\r\n\r\n\r\n\r\n    }\r\n\r\n     getRandomHexColor() {\r\n        // Generate a random number between 0 and 16777215 (0xFFFFFF in hexadecimal)\r\n        const randomColor = Math.floor(Math.random() * 16777215).toString(16);\r\n      \r\n        // Ensure the color has six digits by padding with zeros if necessary\r\n        return \"#\" + \"0\".repeat(6 - randomColor.length) + randomColor;\r\n      }\r\n       convertToHex(str) {\r\n        var hex = '';\r\n        for(var i=0;i<str.length;i++) {\r\n            hex += ''+str.charCodeAt(i).toString(16);\r\n        }\r\n        return hex;\r\n    }\r\n\r\n      onError(arg)\r\n      {\r\n        console.log(\"error parsing gltf\");\r\n        this.loadedN++;\r\n        if (this.loadedN==this.resultsN)\r\n        {\r\n            this.onLoadReady();\r\n        }\r\n\r\n      }\r\n    \r\n    onLoad(gltf)\r\n    {\r\n\r\n       // console.log(gltf.scene.children[0].geometry);\r\n       \r\n          \r\n            var c=this.colors[(toInteger(Math.random()*5)+\"\")];\r\n\r\n            if (gltf.color!=null)\r\n            {\r\n                c=this.convertToHex(gltf.color);\r\n            }\r\n\r\n              var o3d=gltf.scene.children[0];\r\n                    this.nodes.push(o3d);\r\n                    var ar =this.color_nodes[c];\r\n                    if (ar==null)\r\n                    {\r\n                        ar=[];\r\n                        this.color_nodes[c]=ar;\r\n                    }\r\n                    ar.push(o3d.geometry);\r\n\r\n                    this.loadedN++;\r\n                    if (this.loadedN==this.resultsN)\r\n                    {\r\n                        this.onLoadReady();\r\n                    }\r\n                    this.processedN++;\r\n                    if (this.processedN>999)\r\n                    {\r\n                        console.log(\"processed 1000 ifc objects in total \"+this.loadedN);\r\n                        this.processedN=0;\r\n                    }\r\n\r\n      \r\n    }\r\n    getMat1(c)\r\n    {\r\n        var mat= new MeshPhongMaterial({shininess: 50,emissiveIntensity:0.4,lightMapIntensity:0.4,emissive:c});\r\n        mat.vertexColors=false;//bijna zeker\r\n        mat.fog=false;\r\n       // mat.alphaHash = true\r\n        mat.side=THREE.DoubleSide;\r\n    }\r\n    getMat(color,hint)\r\n    {\r\n\r\n\r\n    var mat = new MeshPhysicalMaterial({color:color});\r\n  \r\n\r\n    if (hint==\"grey\")\r\n    {\r\n      mat = new MeshPhysicalMaterial({color:\"#c0c0c0\"});\r\n      mat.vertexColors=false;//bijna zeker\r\n      mat.fog=true;\r\n     \r\n    }\r\n    if (hint==\"greytransparent\")\r\n    {\r\n      mat = new MeshPhysicalMaterial({color:\"#c0c0c0\"});\r\n      mat.vertexColors=false;//bijna zeker\r\n      mat.fog=true;\r\n      mat.transparent=true;\r\n      mat.opacity=0.4;\r\n     \r\n    }\r\n    \r\n    if (hint==\"greyverytransparent\")\r\n    {\r\n      mat = new MeshPhysicalMaterial({color:\"#c0c0c0\"});\r\n      mat.vertexColors=false;//bijna zeker\r\n      mat.fog=true;\r\n      mat.transparent=true;\r\n      mat.opacity=0.1;\r\n    \r\n     \r\n    }\r\n  \r\n    if (hint==\"nice\")\r\n    {\r\n      mat= new MeshPhongMaterial({shininess: 50,emissiveIntensity:0.2,lightMapIntensity:0.4,emissive:color});\r\n      mat.vertexColors=false;//bijna zeker\r\n      mat.fog=true;\r\n     \r\n    }\r\n  \r\n    if (hint==\"normal\")\r\n    {\r\n     // mat.vertexColors=false;//bijna zeker\r\n      //mat.fog=true;\r\n     \r\n      mat.transparent=true;\r\n      mat.opacity=0.99;\r\n     \r\n   \r\n    }\r\n    if (hint==\"transparent\")\r\n    {\r\n      mat.transparent=true;\r\n      mat.opacity=0.4;\r\n    }\r\n    if (hint==\"vtransparent\")\r\n    {\r\n      mat.transparent=true;\r\n      mat.opacity=0.1;\r\n    }\r\n  \r\n    if (hint==\"toon\")\r\n    {\r\n      mat=new MeshToonMaterial({shininess: 50,emissiveIntensity:0.2,lightMapIntensity:0.4,emissive:color,color:color})\r\n    \r\n    }\r\n    if (hint==\"toontransparent\")\r\n    {\r\n      mat=new MeshToonMaterial({shininess: 50,emissiveIntensity:0.2,lightMapIntensity:0.4,emissive:color,color:color})\r\n      mat.transparent=true;\r\n      mat.opacity=0.4;\r\n    \r\n    }\r\n  \r\n    mat.depthWrite =true;\r\n    mat.vertexColors=true;//bijna zeker\r\n    mat.side=THREE.DoubleSide;\r\n  return mat;\r\n}\r\n\r\n\r\n    onLoadReady()\r\n    {\r\n      var group=this.ifcdb.rootGroup;\r\n      for (var i=group.children.length-1; i >= 0; --i)            \r\n    group.remove(group.children[i]);\r\n\r\n       \r\n       \r\n        for (var c in this.color_nodes)\r\n        {\r\n            var ar =this.color_nodes[c];\r\n            var cchild2=new Mesh();\r\n\r\n                                    cchild2.geometry=mergeGeometries(ar);\r\n                                    cchild2.geometry.applyMatrix4(new Matrix4().makeScale(-1, 1, 1));//flip the normals\r\n           // cchild2.geometry=BufferGeometryUtils.mergeBufferGeometries(ar);\r\n\r\n        \r\n            cchild2.material=this.getMat(c,\"greytransparent\");\r\n\r\n            this.ifcdb.rootGroup.add(cchild2);\r\n\r\n        }\r\n        \r\n       // this.rootGroup.add(o3d);\r\n\r\n\r\n        console.log(\"onLoadReady\");\r\n     \r\n\r\n\r\n    }\r\n}","import React, {useRef, Component } from 'react'\r\n //trheejs version\r\nimport {Color,Mesh,BufferGeometry,PointLight, Vector2,Raycaster,MeshToonMaterial, MeshPhongMaterial,MeshLambertMaterial,SpotLight,AmbientLight, AxesHelper, DirectionalLight, GridHelper, PerspectiveCamera, Scene, WebGLRenderer,Object3D } from \"three\";\r\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader'\r\nimport { OrbitControls } from \"three/examples/jsm/controls/OrbitControls\";\r\n\r\n//import { IFCLoader  } from \"web-ifc-three/IFCLoader\";\r\n\r\nimport IFCDB from './IFCDB';\r\n\r\nimport styles from './BBThreeJSViewer.module.css'\r\nimport ThreeJSViewer from './ThreeJSViewer';\r\n\r\nimport PublishUtils from '../../../../helpers/PublishUtils';\r\n\r\nimport gearWhite from '../../../../images/gear-white.svg'\r\nimport gearBlue from '../../../../images/gear-blue.svg'\r\nimport { connect } from \"react-redux\"\r\nimport { GLBFromSparqlResults } from './GLBFromSparqlResults';\r\n\r\n\r\n\r\n\r\n//import { acceleratedRaycast, computeBoundsTree, disposeBoundsTree } from \"three-mesh-bvh\";\r\n\r\n\r\n\r\n\r\nclass BBThreeJSViewer extends Component \r\n{\r\nstatic idN=0;\r\n    \r\n    ifcdb=new IFCDB();\r\n    viewer=null;\r\n  \r\n   canvasDiv = React.createRef();\r\n    onResize=() => {\r\n      // on resize logic\r\n      console.log(\"resized\");\r\n    }\r\n\r\n\r\n    /*constructor(props)\r\n    {\r\n      super(props);\r\n    \r\n    }\r\n    */\r\n    \r\n    resize=()=>\r\n    {\r\n      console.log(\"resize event\");\r\n\r\n\r\n     \r\n\r\n\r\n    }\r\n\r\n    \r\n   \r\n      componentDidMount() \r\n    {\r\n     \r\n      const currentCanvasDiv = this.canvasDiv.current;\r\n     var me=this;\r\n      var resizeObserver = new ResizeObserver((entries) => {\r\n      try\r\n      {\r\n         me.viewer.resize();\r\n      }\r\n      catch(e){}\r\n\r\n      });\r\n      resizeObserver.observe(currentCanvasDiv);\r\n\r\n\r\n     // const element = this.ref.current;\r\n     // element.addEventListener('resize', (event) => console.log(event.detail));\r\n              this.viewer=new ThreeJSViewer();\r\n               this.viewer.initViewer(this);\r\n                this.ready();\r\n               // this.ifcLoader = new IFCLoader();\r\n\r\n              //  var o=this.ifcLoader.ifcManager.setWasmPath(\"../../bb/wasm/\").then(function(){me.ready();});\r\n    }\r\n\r\n\r\n\r\n\r\n    ready()\r\n    {\r\n      this.processSparqlResults=false;\r\n      this.updateRender();\r\n\r\n      \r\n    }\r\n\r\n\r\n    getGLBFilesFromProps(props)\r\n    {\r\n      var prefix =props[\"glb files prefix\"];\r\n      if (prefix==null)prefix=\"\";\r\n      var files = props[\"glb files\"];\r\n      var files2=[];\r\n      if (files!=null)\r\n      {\r\n        for (var n in files)\r\n        {\r\n          var file=files[n];\r\n        \r\n          var file2=PublishUtils.processStringForParameters({props:props},file);\r\n\r\n          if (file2!=null)\r\n          {\r\n            var files22= file2.split(\",\");\r\n            for (var nn in files22)\r\n            {\r\n              var file3 = files22[nn];\r\n              file3=file3.replace(\"\\\"\",\"\").replace(\"\\\"\",\"\").replace(\"<\",\"\").replace(\">\",\"\").replace(\"\\\\\\\"\",\"\").replace(\"\\\\\\\"\",\"\");\r\n              if (file3.length>4)\r\n              {\r\n                files2.push(prefix+file3);\r\n              }\r\n            }\r\n          }\r\n          \r\n        }\r\n      }\r\n      return files2;\r\n    }\r\n\r\n\r\n    shouldComponentUpdate(props,state)\r\n    {\r\n        //no unless\r\n       \r\n        try\r\n        {\r\n          var a1=this.getGLBFilesFromProps(this.props);\r\n          var a2=this.getGLBFilesFromProps(props);\r\n          if (JSON.stringify(a1)!=JSON.stringify(a2)) return true;\r\n        }\r\n        catch(e) {}\r\n\r\n        try\r\n        {\r\n           if (this.props.data!=props.data) \r\n           {\r\n          //  console.log(\"data change so update is necessary \");\r\n            return true;\r\n           }\r\n        }\r\n        catch(e) {}\r\n\r\n        try{\r\n        var sel = this.props.guidselector;\r\n        var sel2 = this.props.pubsub[sel];\r\n\r\n        var sela = props.guidselector;\r\n        var sela2 = props.pubsub[sela];\r\n        if (sela2!=sel2) return true;\r\n      }\r\n      catch(e) {}\r\n   \r\n\r\n    \r\n       return false;\r\n\r\n    }\r\n\r\n   \r\n\r\n\r\n    loadTestIFC() {\r\n\r\n      var me=this;\r\nvar files=[];\r\nfiles.push(\"SITE_HOW.ifc\");\r\nif (false)\r\n{\r\nfiles.push(\"SITE_HOW_CTRAY.ifc\");\r\nfiles.push(\"SITE_HOW_EQUIPMENT.ifc\");\r\nfiles.push(\"SITE_HOW_EQUIPMENT2.ifc\");\r\nfiles.push(\"SITE_HOW_EXTRAS_HOA.ifc\");\r\nfiles.push(\"SITE_HOW_HVAC.ifc\");\r\nfiles.push(\"SITE_HOW_PENETRATIONS.ifc\");\r\nfiles.push(\"SITE_HOW_PIPING.ifc\");\r\n}\r\n\r\nif (false)\r\n{\r\n\r\nfiles.push(\"SITE_HOW_STRUCTURE.ifc\");\r\nfiles.push(\"SITE_HOW_STRUCTURE1.ifc\");\r\nfiles.push(\"SITE_HOW_STRUCTURE2.ifc\");\r\nfiles.push(\"SITE_HOW_STRUCTURE3.ifc\");\r\nfiles.push(\"SITE_HOW_STRUCTURE4.ifc\");\r\n}\r\n\r\n\r\n\r\n\r\n\r\nfor (var n in files)\r\n{\r\n    var file= files[n];\r\n     me.loadIFC(\"http://localhost:3000/temp/\"+file);\r\n}\r\n   \r\n\r\n//});\r\n}\r\n\r\nloadIFC(file)\r\n{\r\n    var me=this;\r\n    \r\n  //  console.log(file);\r\n\r\n  \r\n    this.ifcLoader.load(file, (ifcModel) => me.scene.add(ifcModel));\r\n}\r\n\r\n\r\n\r\nupdateRender(force)\r\n{\r\n \r\n  if (this.viewer!=null)\r\n  {\r\n   \r\n      if ( (this.viewer.renderer!=null) && (this.processSparqlResults) )\r\n      {\r\n       \r\n        this.ifcdb.processSparqlResults(this);\r\n      }\r\n      else\r\n      {\r\n        if (this.viewer.renderer!=null) \r\n        {\r\n          var files2=this.getGLBFilesFromProps(this.props);\r\n          if (this.isEmpty(files2))\r\n            {\r\n                new GLBFromSparqlResults(this);\r\n                \r\n              if (!this.ifcdb.isEmpty())\r\n              {\r\n               \r\n                this.viewer.controls.enabled=false;\r\n                this.ifcdb.setVisible(false);\r\n                this.ifcdb.emptyScene();\r\n                this.ifcdb.processedAll();\r\n\r\n              }\r\n             // console.log(\"returning \");\r\n              return;\r\n            }\r\n          \r\n          if ((force) || (this.ifcdb.shouldLoadNewFiles(files2)))\r\n          {\r\n            this.viewer.controls.enabled=false;\r\n            this.props.setLoading(true);\r\n             \r\n            this.ifcdb.loadGLBFiles(this,files2);\r\n           // console.log(\"returning 2\");\r\n            return;\r\n          }\r\n\r\n          if (this.ifcdb.ifcdbsparql.needsUpdate())\r\n          {\r\n            this.viewer.controls.enabled=false;\r\n            this.props.setLoading(true);\r\n          //  console.log(\"triggered setSparql update\");\r\n            this.ifcdb.processedAll(true); // reuse pickgroup if possible\r\n             return;\r\n          }\r\n          if (this.props.guidselector!=null)\r\n          {\r\n            this.viewer.setSelectedGuid();\r\n            \r\n          }\r\n          \r\n\r\n         \r\n        }\r\n        //console.log(\"no sparql results \");\r\n      }\r\n}\r\n}\r\n\r\nisEmpty(files)\r\n{\r\n  if (files==null) return true;\r\n  if (files.length==0) return true;\r\n  if (files.length==1)\r\n  {\r\n    var file =files[0];\r\n    if (file.includes(\"http://www.buildingbits.nl/reset\"))\r\n    {\r\n      return true;\r\n    }\r\n    if (file.length<3)\r\n    {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n\r\n \r\n               \r\n\r\n}\r\n\r\n\r\n    render() {\r\n\r\n        \r\n    \r\n      if (this.ifcdb.loadingInProgress)\r\n      {\r\n            console.log(\"input changed. we might have to check because loading is true\");\r\n            this.ifcdb.inputChanged=true;\r\n      }\r\n      else\r\n      {\r\n        this.updateRender();\r\n      }\r\n      if (this.id==null)\r\n      {\r\n          BBThreeJSViewer.idN++;\r\n        this.id=\"id\"+BBThreeJSViewer.idN;\r\n      }\r\n\r\n    \r\n      const tippyID=\"tippydiv\"+this.id;\r\n      const tcid=\"three-canvas\"+this.id;\r\n      const legendID=\"legenddiv\"+this.id;\r\n      \r\n        return (\r\n          \r\n          <div ref={this.canvasDiv} id={tippyID} className={styles.fullWidget} >\r\n           <div   className={ styles.right}>\r\n                <img \r\n                    src={gearWhite}\r\n                    alt=\"gear\"\r\n                  \r\n                    onClick={() => this.setState({ dialogVisible: true })}\r\n                  />\r\n            </div>\r\n\r\n           \r\n           \r\n         \r\n            <canvas   className={styles.fullWidget} style={{position: \"relative\"}} id={tcid}>\r\n\r\n\r\n      \r\n            </canvas>\r\n            </div>\r\n        )\r\n      }\r\n\r\n\r\n      \r\n}\r\n\r\nexport default connect()(BBThreeJSViewer)\r\n","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 913;"],"sourceRoot":""}