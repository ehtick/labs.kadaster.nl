(this["webpackJsonpviewer-builder-client"]=this["webpackJsonpviewer-builder-client"]||[]).push([[16],{1136:function(e,t,i){e.exports={fullWidget:"BBThreeJSViewer_fullWidget__16tbM",right:"BBThreeJSViewer_right__35Xyd",drawer:"BBThreeJSViewer_drawer__2Omkl"}},1140:function(e,t){function i(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}i.keys=function(){return[]},i.resolve=i,e.exports=i,i.id=1140},1287:function(e,t,i){"use strict";i.r(t);var r=i(5),s=i(6),n=i(7),a=i(8),l=i(1),o=i.n(l),c=i(219),h=i(643),u=i(723),d=i(753),f=i(948),v=i(910),p=i(31),g=i(811),y=function(){function e(t,i,s,n,a){Object(r.a)(this,e),this.ifcdb=null,this.name=null,this.gltf=null,this.visible=!0,this.allBFGs={},this.allNodes=[],this.allFirstChild={},this.allFirstMaterial={},this.loading=null,this.defaultChilds=null,this.simpleMode=!1;var l=new h.V,o="https://unpkg.com/three@0.".concat(h.xb,".x"),c=new v.a(l).setDecoderPath("".concat(o,"/examples/jsm/libs/draco/gltf/")),d=new f.a(l).setTranscoderPath("".concat(o,"/examples/jsm/libs/basis/"));h.h.enabled=!0,this.ifcdb=t,1==n&&(this.simpleMode=!0);var y=new u.a;if(this.loader=y,y.setCrossOrigin("anonymous"),y.setMeshoptDecoder(g.a),y.setDRACOLoader(c),y.setKTX2Loader(d.detectSupport(this.ifcdb.viewer.viewer.renderer)),1!=a){y.setWithCredentials(!0),y.manager.file=i,y.setResourcePath(i),this.name=i;var b=this;this.loading=!0;try{i=Object(p.c)(i,t.viewer.props),y.setCrossOrigin("*"),y.loadAsync(i).then((function(e){b.gltf=e,b.simpleMode||(b.needsTranslation?b.processGLTF(e,b.getCenter()):b.processGLTF(e)),b.loading=!1,null!=s&&s.call(b)}),(function(e){}),(function(e){console.log("error",e),window.alert("error loading file"),b.loading=!1,null!=s&&s.call(b)})).catch((function(e){console.log(e),alert("could not load 3d file")}))}catch(w){window.alert("error loading model "),b.loading=!1,null!=s&&s.call(b)}}}return Object(s.a)(e,[{key:"getCenter",value:function(){return(new h.e).setFromObject(this.gltf.scene).getCenter(new h.dc)}},{key:"needsTranslation",value:function(){var e=this.getCenter();return Math.abs(e.x)>1e3||Math.abs(e.y)>1e3||Math.abs(e.z)>1e3||(console.log("no need for extra translations"),!1)}},{key:"addDefaultToScene",value:function(){this.ifcdb.rootGroup.add(this.gltf.scene)}},{key:"getDefaultScene",value:function(){return this.gltf.scene}},{key:"getChild",value:function(e){for(var t in this.allNodes){var i=this.allNodes[t];if(i.name==e)return i}return null}},{key:"processGLTF",value:function(e,t){for(var i in this.allBFGs={},this.allNodes=[],this.allFirstChild={},this.allFirstMaterial={},this.loading=null,this.defaultChilds=null,this.resetMatrix(e.scene),null!=t&&(console.log("translating the scene ",this.name),this.ncenter=t),e.scene.children){var r=e.scene.children[i];this.processGLTFElement(r,t)}}},{key:"resetMatrix",value:function(e){e.matrix=new h.Z,e.matrixWorld=new h.Z,null!=e.parent&&this.resetMatrix(e.parent)}},{key:"processGLTFElement",value:function(e,t){if(e.isMesh&&e.isObject3D&&null!=e.geometry&&0==e.children.length&&!e.geometry.isBufferGeometry)console.log("dit heeft een andere geometry ",e.geometry);else{var i="default",r={r:1,b:1,g:1};try{i=(r=e.material.color).r+"_"+r.g+"_"+r.b}catch(u){}var s=this.allBFGs[i];if(null==s&&(s=[],this.allBFGs[i]=s,this.allFirstChild[i]=r,this.allFirstMaterial[i]=e.material),e.updateMatrix(!0),e.updateMatrixWorld(!0),null!=e.children){for(var n in e.children){var a=e.children[n];this.processGLTFElement(a,t)}if(null==e.geometry)return}var l=e.geometry;l=l.clone();var o=e.matrixWorld.clone();if(e.geometry=l,null!=t){var c=new h.Z;c.makeTranslation(-t.x,-t.y,-t.z),o=c.multiply(o)}l=l.applyMatrix4(o),s.push(l),l.guid=e.name,this.allNodes.push(e),this.aantal++,this.subAantal++,this.subAantal>1e3&&(this.subAantal=0)}}},{key:"visualize",value:function(e){if(this.visible=e,null==this.defaultChilds){var t={};for(var i in this.allBFGs){var r=this.allFirstChild[i],s=this.allFirstMaterial[i],n=this.ifcdb.getDefaultColor(r,s);t[i]=n}this.defaultChilds=this.ifcdb.processColoring(this.allBFGs,t)}for(var a in console.log(this.name+" visualise "+e),this.defaultChilds)this.ifcdb.rootGroup.add(this.defaultChilds[a])}}]),e}(),b=i(1135),w=function(){function e(t,i,s){Object(r.a)(this,e),this.ifcdb=null,this.name=null,this.visible=!0,this.root=null,this.allBFGs={},this.allFirstChild={},this.allFirstMaterial={},this.ifcdb=t;var n=new b.a;this.name=i;this.loading=!0;var a=this;n.ifcManager.setWasmPath("../../../bb/wasm/").then((function(){e.wasmLoaded=!0,a.loadReallyIFC(n,i,s)}))}return Object(s.a)(e,[{key:"loadReallyIFC",value:function(e,t,i){e.setWithCredentials(!0);var r=this;e.load(t,(function(e){e.mesh.material,e.mesh.groups;r.allBFGs.default=e,r.allFirstChild.default=e.material.color,r.allFirstMaterial.default=e.material,r.loading=!1,null!=i&&i.call(r)}))}}]),e}();w.wasmLoaded=!1;var m=w,C=function(){function e(t){Object(r.a)(this,e),this.ifcdb=null,this.guid_label={},this.colorMat={},this.latestData=null,this.guid_color=null,this.ifcdb=t}return Object(s.a)(e,[{key:"useSparqlColors",value:function(){try{if(null!=this.ifcdb.viewer.props.data){if(this.ifcdb.viewer.props.data.results.bindings.length>0)return!0;this.latestData=null}}catch(e){}return!1}},{key:"amoutOfSparqlResults",value:function(){try{if(null!=this.ifcdb.viewer.props.data)return this.ifcdb.viewer.props.data.results.bindings.length}catch(e){}return 0}},{key:"getLabel",value:function(e){return this.guid_label[e]}},{key:"processSparqlResults",value:function(){var e={};this.guid_color=e,this.guid_label={};try{var t=this.ifcdb.viewer.props.data.results;for(var i in t.bindings){var r=t.bindings[i],s=r.guid.value,n=r.color.value;e[s]=n;try{var a=r.label.value;this.guid_label[s]=a}catch(l){}}}catch(l){}return e}},{key:"getColor",value:function(e){try{if(e.startsWith("#")&&7==e.length)return e}catch(t){}try{return this.stringToColour(e)}catch(t){}return"#ff0000"}},{key:"stringToColour",value:function(e){for(var t=0,i=0;i<e.length;i++)t=e.charCodeAt(i)+((t<<5)-t);for(var r="#",s=0;s<3;s++){r+=("00"+(t>>8*s&255).toString(16)).substr(-2)}return r}},{key:"componentToHex",value:function(e){var t=e.toString(16);return 1==t.length?"0"+t:t}},{key:"rgbToHex",value:function(e,t,i){return"#"+this.componentToHex(e)+this.componentToHex(t)+this.componentToHex(i)}},{key:"needsUpdate",value:function(){try{if(this.latestData==this.ifcdb.viewer.props.data)return!1}catch(e){}return!0}},{key:"setSparqlColors_double",value:function(e){console.log("double coloring strategy");try{for(var t in this.ifcdb.ifcfiles){var i=this.ifcdb.ifcfiles[t];if(i.visible)for(var r in i.visualize(!0),i.allNodes){var s=i.allNodes[r];if(null!=s.geometry){var n=e[s.name];if(null!=n){var a=this.getColor(n),l=new h.eb({color:a});l.vertexColors=!1;var o=s.geometry.clone(),c=new h.ab;c.geometry=o,c.material=l,this.ifcdb.rootGroup.add(c)}}}}this.ifcdb.viewer.viewer.zoomAt(this.ifcdb.rootGroup)}catch(u){console.log(u),this.ifcdb.defaultColor()}}},{key:"setSparqlColors_ReOrganise",value:function(e){console.log("reorganise coloring strategy");try{var t={};this.colorMat=t,this.hash={};var i=this.hash;for(var r in i.default=[],t.default=this.ifcdb.getDefaultColor("#aaaaaa"),this.ifcdb.ifcfiles){var s=this.ifcdb.ifcfiles[r];if(s.visible)for(var n in s.allNodes){var a=s.allNodes[n];if(null!=a.geometry){var l=e[a.name];null==l&&(l="default");var o=i[l];if(null==o){o=[],i[l]=o;var c=this.getColor(l),u=new h.eb({color:c});u.vertexColors=!1,t[l]=u}o.push(a.geometry)}}}this.ifcdb.processColoring(i,t)}catch(d){console.log(d),this.ifcdb.defaultColor()}}},{key:"setSparqlColors",value:function(){if(!this.ifcdb.loadingInProgress){try{this.latestData=this.ifcdb.viewer.props.data}catch(t){}var e=this.processSparqlResults();this.amoutOfSparqlResults()<100?this.setSparqlColors_double(e):this.setSparqlColors_ReOrganise(e)}}}]),e}(),k=function(){function e(){Object(r.a)(this,e),this.onlyOnce=!0,this.pickGroup=null,this.rootGroup=null,this.ifcfiles=[],this.inputChanged=!1,this.loadingInProgress=!1,this.ifcdbsparql=null,this.latestBindings=null,this.selectOnlySparqlResults=!1,this.tx=0,this.ty=0,this.tz=0,this.ifcdbsparql=new C(this)}return Object(s.a)(e,[{key:"processedAll",value:function(e){if(this.inputChanged)return this.loadingInProgress=!1,this.inputChanged=!1,void this.viewer.updateRender(!0);if(this.emptyScene(),this.ifcdbsparql.useSparqlColors()?(this.loadingInProgress=!1,this.ifcdbsparql.setSparqlColors()):this.defaultColor(),null!=this.pickGroup&&e?console.log("reusing pickgroup"):(this.pickGroup=null,this.createNewPickGroup()),this.onlyOnce)this.viewer.viewer.scene.children.length;this.viewer.viewer.controls.update(),this.viewer.viewer.setSelectedGuid(),this.viewer.viewer.setAnimeerAantal(20),this.viewer.props.setLoading(!1),this.loadingInProgress=!1,window.top.scene=this.viewer.viewer.scene,this.needsTranslation(),this.translateIntoView()}},{key:"performTranslation",value:function(e){if(1!=this.onlyOnceTranslationDebug){this.onlyOnceTranslationDebug=!0;var t=(new h.e).setFromObject(this.viewer.viewer.scene).getCenter(new h.dc);for(var i in this.ifcfiles){var r=this.ifcfiles[i];r.visible&&r.processGLTF(r.gltf,t)}this.processedAll(e)}}},{key:"needsTranslation",value:function(){var e=(new h.e).setFromObject(this.rootGroup),t=e.getCenter(new h.dc);e.getSize(new h.dc);return Math.abs(t.x)>1e3||Math.abs(t.y)>1e3||Math.abs(t.z)>1e3||(console.log("no need for extra translations"),!1)}},{key:"translateIntoView",value:function(){this.viewer.viewer.zoomAt(this.rootGroup),console.log("translate into view")}},{key:"getDefaultColor",value:function(e,t){var i=this.viewer.props["visualisation hint"];null==i&&(i="normal");var r=new h.eb({color:e});return"grey"==i&&((r=new h.eb({color:"#c0c0c0"})).vertexColors=!1,r.fog=!0),"greytransparent"==i&&((r=new h.eb({color:"#c0c0c0"})).vertexColors=!1,r.fog=!0,r.transparent=!0,r.opacity=.4),"greyverytransparent"==i&&((r=new h.eb({color:"#c0c0c0"})).vertexColors=!1,r.fog=!0,r.transparent=!0,r.opacity=.1),"nice"==i&&((r=new h.db({shininess:50,emissiveIntensity:.2,lightMapIntensity:.4,emissive:e})).vertexColors=!1,r.fog=!0),"normal"==i&&(r.transparent=!0,r.opacity=.99),"transparent"==i&&(r.transparent=!0,r.opacity=.4),"vtransparent"==i&&(r.transparent=!0,r.opacity=.1),"toon"==i&&(r=new h.gb({shininess:50,emissiveIntensity:.2,lightMapIntensity:.4,emissive:e,color:e})),"toontransparent"==i&&((r=new h.gb({shininess:50,emissiveIntensity:.2,lightMapIntensity:.4,emissive:e,color:e})).transparent=!0,r.opacity=.4),r.depthWrite=!0,r}},{key:"defaultColor",value:function(){for(var e in this.ifcfiles){var t=this.ifcfiles[e];if(t.visible){var i={};if(t.simpleMode)t.addDefaultToScene();else{for(var r in t.allBFGs){var s=t.allFirstChild[r],n=t.allFirstMaterial[r],a=this.getDefaultColor(s,n);i[r]=a}this.processColoring(t.allBFGs,i)}}}}},{key:"processColoring",value:function(e,t){this.colorMat=t;var i=[];for(var r in e){var s=e[r],n=new h.ab;if(n,null!=s&&0!=s.length){n.geometry=Object(d.a)(s);var a=t[r];n.material=a,n.matrixAutoUpdate=!1,n.castShadow=!1,n.receiveShadow=!1,this.rootGroup.add(n),i.push(n)}}return i}},{key:"getNewRootGroup",value:function(e){var t=new h.z;return t.matrixAutoUpdate=!0,t.castShadow=!0,t.receiveShadow=!0,t}},{key:"getPickGroup",value:function(){return null!=this.pickGroup?this.pickGroup.children:[]}},{key:"createNewPickGroup",value:function(){for(var e in this.pickGroup=this.getNewRootGroup(),this.ifcfiles){var t=this.ifcfiles[e];if(t.visible)if(t.simpleMode)this.pickGroup.add(t.getDefaultScene().clone(!0));else for(var i in t.allNodes)try{var r=new h.ab,s=t.allNodes[i];if(r.geometry=s.geometry,null==r.geometry)continue;r.ifcguid=s.name;var n=null;if(this.selectOnlySparqlResults){try{n=this.ifcdbsparql.guid_color[r.ifcguid]}catch(a){}null!=n&&(this.pickGroup.add(r),r.updateMatrix(),r.updateWorldMatrix(!0,!0))}else this.pickGroup.add(r),r.updateMatrix(),r.updateWorldMatrix(!0,!0)}catch(a){}}return this.pickGroup.children}},{key:"shouldLoadNewFiles",value:function(e){for(var t in e){var i=e[t],r=this.getIFCFile(i);if(null==r)return!0;if(0==r.visible)return!0}for(var t in this.ifcfiles){var s=this.ifcfiles[t];if(s.visible&&0==e.includes(s.name))return!0}return!1}},{key:"getChild",value:function(e){for(var t in this.ifcfiles){var i=this.ifcfiles[t];if(i.visible){var r=i.getChild(e);if(null!=r)return r}}}},{key:"setVisible",value:function(e){for(var t in this.ifcfiles){this.ifcfiles[t].visible=e}}},{key:"isEmpty",value:function(){for(var e in this.ifcfiles){if(this.ifcfiles[e].visible)return!1}return!0}},{key:"emptyScene",value:function(){null!=this.viewer.viewer.scene&&(this.viewer.viewer.createNewScene(this.viewer.viewer.scene),this.viewer.viewer.controls.enabled=!0,this.viewer.viewer.orbiting=!0,this.rootGroup=this.getNewRootGroup(!1),this.viewer.viewer.scene.add(this.rootGroup))}},{key:"loadGLBFiles",value:function(e,t){if(this.viewer=e,this.loadingInProgress)return console.log("not loading glb files because already loading "),!1;this.loadingInProgress=!0,this.asyncLoadGLBFiles(e,t.slice())}},{key:"getIFCFile",value:function(e){for(var t in this.ifcfiles)if(this.ifcfiles[t].name==e)return this.ifcfiles[t];return null}},{key:"asyncLoadGLBFiles",value:function(e,t){this.loadedfiles=t;var i=this;this.reset(),this.setVisible(!1);var r=!1;for(var s in t){var n=t[s];if(null==(l=this.getIFCFile(n)))if(r=!0,n.toLowerCase().endsWith(".glb")){var a=this.viewer.props.simpleMode,l=new y(this,n,(function(){i.readyLoading()}),a);this.ifcfiles.push(l)}else if(n.toLowerCase().endsWith(".ifc")){l=new m(this,n,(function(){i.readyLoading()}));this.ifcfiles.push(l)}else console.log("cannot load file "),i.readyLoading();else l.visible=!0}0==r&&this.processedAll()}},{key:"readyLoading",value:function(){for(var e in this.ifcfiles)if(this.ifcfiles[e].loading)return;this.processedAll()}},{key:"reset",value:function(){}},{key:"processSparqlResults",value:function(e){if(null!=e.props.data){this.viewer=e;var t=e.props.data.results.bindings;this.processBindings(t)}}},{key:"processBindings",value:function(e){if(e!=this.latestBindings){var t=this.viewer,i=new h.V,r=new u.a(i),s=this;null!=t.scene&&t.createNewScene(t.scene),this.latestBindings=e,this.reset(),this.tobeprocessedBindings=e.length,this.aantalBindings=0,r=new u.a;for(var n in e){0;try{var a=e[n],l=a.gltf.value;l=JSON.parse(l);var o=a.uri.value;l.userData={uri:o},l.name=o,r.parse(l,"",(function(e){null!=e.scene&&null!=e.scene.children?(s.aantalBindings++,s.processGLTFElement(e.scene.children[0],!0)):this.aantalBindings++}),(function(e){console.log(e)}))}catch(c){console.log(c),this.aantalBindings++}}console.log("klaar met bindingen")}}}]),e}(),x=i(1136),G=i.n(x),M=i(913),F=i(704),O=i(1141),S=(i(1137),i(1138),i(1139),i(1200)),L=i(1205),N=function(){function e(){var t=this;Object(r.a)(this,e),this.viewer=null,this.scene=null,this.renderer=null,this.raycaster=null,this.camera=null,this.pointer=new h.cc,this.selectedChild=null,this.hooverChild=null,this.orbiting=!1,this.threeCanvas=null,this.animeerAantal=10,this.zoomAt=function(e,i){console.log("zoom at"),null==i&&(i=1);var r=t.camera,s=(new h.e).setFromObject(e),n=s.getCenter(new h.dc),a=s.getSize(new h.dc);L.a.to(r.position,{duration:1,x:n.x,y:n.y+3,z:n.z+a.z+i,onUpdate:function(){r.lookAt(e.position)}});var l=t.controls;t.setAnimeerAantal(1e3),L.a.to(t.controls.target,{duration:1,x:n.x,y:n.y,z:n.z,onComplete:function(){l.enabled=!0,t.setAnimeerAantal(10)}})}}return Object(s.a)(e,[{key:"initViewerNT",value:function(e){this.viewer=e;var t="three-canvas"+this.viewer.id,i=document.getElementById(t);this.threeCanvas=i;var r=new S.a;r.scene=new S.g(r),r.renderer=new S.f(r,i),this.renderer=r.renderer;var s=new S.c(r);r.camera=s,this.camera=s,r.raycaster=new S.e(r),r.init();var n=r.scene.get();this.scene=n;new S.b(r);var a=new h.q;a.position.set(5,10,3),a.intensity=.5,n.add(a);var l=new h.a;l.intensity=.5,n.add(l);var o=new S.d(r);r.tools.add(o),this.grid=o.get(),this.raycaster=new h.Lb}},{key:"initViewer",value:function(e){var t=this;this.viewer=e;var i="three-canvas"+this.viewer.id,r=document.getElementById(i);this.threeCanvas=r;var s=r.getBoundingClientRect(),n={width:s.right-s.left,height:s.bottom-s.top},a=new h.Pb,l=n.width/n.height,o=new h.pb(75,l);o.position.z=15,o.position.y=13,o.position.x=8,o.near=1,o.far=1e3,this.camera=o;var c=new h.rb(16777215,1250);c.position.set(0,-10,0),o.add(c),a.background=new h.j(15658734);var u=new h.fc({canvas:r,alpha:!0,powerPreference:"high-performance",antialias:!0,logarithmicDepthBuffer:!0,sortObjects:!0,colorManagement:!0});u.setPixelRatio(window.devicePixelRatio),this.renderer=u,this.raycaster=new h.Lb,u.setSize(n.width,n.height),this.renderer=u;var d=new h.y(50,30);this.grid=d;var f=new h.c;f.material.depthTest=!1,f.renderOrder=1,a.add(f),a.add(d);var v=new M.a(o,r);v.enableDamping=!0,v.target.set(-2,0,0),this.controls=v,this.animeerAantal=50;var p=this;!function e(){p.animeerAantal>0&&(v.update(),u.render(a,o),p.animeerAantal--),p.animeerAantal>100&&(p.animeerAantal=100),requestAnimationFrame(e)}(),u.render(a,o),v.addEventListener("change",(function(){t.animeerAantal=50})),v.addEventListener("start",(function(){t.orbiting=!0})),v.addEventListener("end",(function(){t.orbiting=!1})),r.addEventListener("hide",(function(e){console.log(e)})),r.addEventListener("mousemove",(function(e){t.orbiting||t.mousemove(e)}),!1),r.addEventListener("click",(function(e){t.mouseclick(e)}),!1),r.addEventListener("dblclick",(function(e){t.mouseDoubleClick(e)}),!1),this.scene=a,this.camera=o,o.updateProjectionMatrix()}},{key:"resize",value:function(){try{var e="three-canvas"+this.viewer.id,t=document.getElementById(e).getBoundingClientRect(),i={width:t.right-t.left+200,height:t.bottom-t.top+200},r=this.camera;r.aspect=i.width/i.height,r.updateProjectionMatrix(),this.renderer.setSize(i.width,i.height),this.animeerAantal=50}catch(s){}}},{key:"createNewScene",value:function(e){null==e&&(e=this.scene),e.clear();var t=8947848,i=new h.B(16777147,526368,1);e.add(i);var r;new h.a(t,.01);(r=new h.Ub(4478276,.7)).castShadow=!0,r.position.set(250,250,250),r.target.position.set(0,0,0),e.add(r),(r=new h.Ub(t,.5)).castShadow=!0,r.position.set(0,-250,-250),r.target.position.set(0,0,0),e.add(r),e.add(r.target);new h.y(80,80);var s=new h.c;s.material.depthTest=!1,s.renderOrder=1,this.setAnimeerAantal(1),this.resize()}},{key:"getIntersection",value:function(e){if(this.orbiting)return null;if(null==this.raycaster)return null;e.preventDefault();var t=this.renderer.getContext().canvas.getBoundingClientRect();this.pointer.x=(e.clientX-t.left)/(t.right-t.left)*2-1,this.pointer.y=-(e.clientY-t.top)/(t.bottom-t.top)*2+1;var i=this.viewer.ifcdb.getPickGroup();if(this.raycaster.setFromCamera(this.pointer,this.camera),null!=i){try{return this.raycaster.intersectObjects(i,!0)}catch(r){console.log(r)}return null}}},{key:"mousemove",value:function(e){try{var t=this.getIntersection(e);if(null==t)return;if(t.length>0){var i=t[0].object;if(i=i.clone(),null!=this.hooverChild&&i==this.hooverChild.children[0])return;if(null!=this.selectedChild&&i==this.selectedChild.children[0])return;null==i.orgMatrix&&(i.orgMatrix=i.matrix),null==i.orgMaterial&&(i.orgMaterial=i.material),i.material=new h.db({color:255,specular:11184810,shininess:1e3,emissive:255}),i.material.opacity=.5,i.renderOrder=10,null!=this.hooverChild&&this.scene.remove(this.hooverChild);var r=this.viewer.ifcdb.getNewRootGroup();this.hooverChild=r,r.add(i),this.scene.add(r);var s=null;try{s=this.viewer.ifcdb.ifcdbsparql.getLabel(i.geometry.guid)}catch(n){}null!=s?this.showTippy(s):this.showTippy("IFC GUID:"+i.geometry.guid)}else null!=this.hooverChild&&(this.scene.remove(this.hooverChild),this.destroyTippy());this.setAnimeerAantal(1)}catch(n){console.log(n)}}},{key:"setAnimeerAantal",value:function(e){this.animeerAantal+=e}},{key:"setSelectedGuid",value:function(){var e=this.viewer.props.pubsub[this.viewer.props.guidselector];if(null!=e&&e!=this.selectedGuid){var t=this.viewer.ifcdb.getChild(e);if(null!=t){var i=new h.ab;i.geometry=t.geometry,i.name=t.name;var r=this.viewer.props.guidpublishparameter;null!=r?(this.viewer.props.publish(r,t.name),this.showSelectChild(i)):console.log("could not find child")}}}},{key:"mouseDoubleClick",value:function(e){null!=this.selectedChild&&this.zoomAt(this.selectedChild,4)}},{key:"mouseclick",value:function(e){if(!this.orbiting){e.preventDefault();var t=this.getIntersection(e);if(null!=t)if(t.length>0){var i=t[0].object;this.showSelectChild(i);var r=this.viewer.props.guidpublishparameter;null!=r&&this.viewer.props.publish(r,t[0].object.ifcguid)}else this.selectedChild;else null!=this.selectedChild&&(this.scene.remove(this.selectedChild),this.selectedGuid=null)}}},{key:"showSelectChild",value:function(e){if(e=e.clone(),null==this.selectedChild||e!=this.selectedChild.children[0]){null==e.orgMatrix&&(e.orgMatrix=e.matrix),null==e.orgMaterial&&(e.orgMaterial=e.material),e.material=new h.db({color:16711680,specular:11184810,shininess:1e3,emissive:16711680}),e.material.opacity=0,e.renderOrder=11,null!=this.selectedChild&&(this.scene.remove(this.selectedChild),this.selectedGuid=null);var t=this.viewer.ifcdb.getNewRootGroup();this.selectedChild=t,t.add(e),this.selectedGuid=e.name,this.scene.add(t),this.setAnimeerAantal(1)}}},{key:"showTippy",value:function(e){try{if(null==e&&(e="no info"),null==document.tippy){var t=document.getElementById("tippydiv"+this.viewer.id);null!=t&&(document.tippy=Object(F.c)(t,{trigger:"manual",placement:"followCursor",plugins:[O.a],content:e,followCursor:!0}))}document.tippy.setContent(e);try{document.tippy.show()}catch(i){}}catch(i){}}},{key:"destroyTippy",value:function(){try{document.tippy.hide()}catch(e){}}},{key:"fitCameraToCenteredObject",value:function(e){var t=this.camera,i=this.orbitControls,r=new h.e;r.setFromObject(e);new h.dc;var s=new h.dc;r.getSize(s);var n=t.fov*(Math.PI/180),a=2*Math.atan(Math.tan(n/2)*t.aspect),l=s.z/2+Math.abs(s.x/2/Math.tan(a/2)),o=s.z/2+Math.abs(s.y/2/Math.tan(n/2)),c=Math.max(l,o);c*=1,t.position.set(0,0,c);var u=r.min.z,d=u<0?-u+c:c-u;t.far=3*d,t.updateProjectionMatrix(),void 0!==i&&(i.target=new h.dc(0,0,0),i.maxDistance=2*d)}}]),e}(),j=i(19),I=i(281),B=(i(282),i(34)),A=function(){function e(t){if(Object(r.a)(this,e),this.viewer=t,this.ifcdb=t.ifcdb,null!=this.viewer.props.data)try{var i=this.viewer.props.data.head.vars;for(var s in i)"gltf"==i[s]&&this.processSparql()}catch(n){console.log(n)}}return Object(s.a)(e,[{key:"setupIFCDB",value:function(){this.viewer.ifcdb.viewer=this.viewer,this.ifcdb.pickGroup=null,this.ifcdb.createNewPickGroup(),this.ifcdb.rootGroup=this.ifcdb.getNewRootGroup(),this.ifcdb.rootGroup.rotation.x=-Math.PI/2,this.viewer.viewer.scene.add(this.ifcdb.rootGroup),this.rootGroup=this.ifcdb.getNewRootGroup(),this.nodes=[],this.color_nodes={},null==this.colors&&(this.colors=[],this.colors.push(this.getRandomHexColor()),this.colors.push(this.getRandomHexColor()),this.colors.push(this.getRandomHexColor()),this.colors.push(this.getRandomHexColor()),this.colors.push(this.getRandomHexColor()))}},{key:"processSparql",value:function(){if(console.log("processing sparql results"),null!=this.viewer.props.data){this.setupIFCDB();var e=new y(this.viewer.ifcdb,null,null,null,!0);this.glb=e;var t=this;this.loadedN=0,this.processedN=0;try{var i=this.viewer.props.data.results.bindings;for(var r in this.resultsN=i.length,i){var s=i[r],n=s.gltf.value;try{s.color.value}catch(a){}e.loader.parse(n,"",(function(e){t.onLoad(e)}),(function(e){t.onError(e)}))}}catch(a){console.log(a)}}}},{key:"getRandomHexColor",value:function(){var e=Math.floor(16777215*Math.random()).toString(16);return"#"+"0".repeat(6-e.length)+e}},{key:"convertToHex",value:function(e){for(var t="",i=0;i<e.length;i++)t+=""+e.charCodeAt(i).toString(16);return t}},{key:"onError",value:function(e){console.log("error parsing gltf"),this.loadedN++,this.loadedN==this.resultsN&&this.onLoadReady()}},{key:"onLoad",value:function(e){var t=this.colors[Object(c.toInteger)(5*Math.random())+""];null!=e.color&&(t=this.convertToHex(e.color));var i=e.scene.children[0];this.nodes.push(i);var r=this.color_nodes[t];null==r&&(r=[],this.color_nodes[t]=r),r.push(i.geometry),this.loadedN++,this.loadedN==this.resultsN&&this.onLoadReady(),this.processedN++,this.processedN>999&&(console.log("processed 1000 ifc objects in total "+this.loadedN),this.processedN=0)}},{key:"getMat1",value:function(e){var t=new h.db({shininess:50,emissiveIntensity:.4,lightMapIntensity:.4,emissive:e});t.vertexColors=!1,t.fog=!1,t.side=h.s}},{key:"getMat",value:function(e,t){var i=new h.eb({color:e});return"grey"==t&&((i=new h.eb({color:"#c0c0c0"})).vertexColors=!1,i.fog=!0),"greytransparent"==t&&((i=new h.eb({color:"#c0c0c0"})).vertexColors=!1,i.fog=!0,i.transparent=!0,i.opacity=.4),"greyverytransparent"==t&&((i=new h.eb({color:"#c0c0c0"})).vertexColors=!1,i.fog=!0,i.transparent=!0,i.opacity=.1),"nice"==t&&((i=new h.db({shininess:50,emissiveIntensity:.2,lightMapIntensity:.4,emissive:e})).vertexColors=!1,i.fog=!0),"normal"==t&&(i.transparent=!0,i.opacity=.99),"transparent"==t&&(i.transparent=!0,i.opacity=.4),"vtransparent"==t&&(i.transparent=!0,i.opacity=.1),"toon"==t&&(i=new h.gb({shininess:50,emissiveIntensity:.2,lightMapIntensity:.4,emissive:e,color:e})),"toontransparent"==t&&((i=new h.gb({shininess:50,emissiveIntensity:.2,lightMapIntensity:.4,emissive:e,color:e})).transparent=!0,i.opacity=.4),i.depthWrite=!0,i.vertexColors=!0,i.side=h.s,i}},{key:"onLoadReady",value:function(){for(var e=this.ifcdb.rootGroup,t=e.children.length-1;t>=0;--t)e.remove(e.children[t]);for(var i in this.color_nodes){var r=this.color_nodes[i],s=new h.ab;s.geometry=Object(d.a)(r),s.geometry.applyMatrix4((new h.Z).makeScale(-1,1,1)),s.material=this.getMat(i,"greytransparent"),this.ifcdb.rootGroup.add(s)}console.log("onLoadReady")}}]),e}(),R=i(0),T=function(e){Object(n.a)(i,e);var t=Object(a.a)(i);function i(){var e;Object(r.a)(this,i);for(var s=arguments.length,n=new Array(s),a=0;a<s;a++)n[a]=arguments[a];return(e=t.call.apply(t,[this].concat(n))).ifcdb=new k,e.viewer=null,e.canvasDiv=o.a.createRef(),e.onResize=function(){console.log("resized")},e.resize=function(){console.log("resize event")},e}return Object(s.a)(i,[{key:"componentDidMount",value:function(){var e=this.canvasDiv.current,t=this;new ResizeObserver((function(e){try{t.viewer.resize()}catch(i){}})).observe(e),this.viewer=new N,this.viewer.initViewer(this),this.ready()}},{key:"ready",value:function(){this.processSparqlResults=!1,this.updateRender()}},{key:"getGLBFilesFromProps",value:function(e){var t=e["glb files prefix"];null==t&&(t="");var i=e["glb files"],r=[];if(null!=i)for(var s in i){var n=i[s],a=j.a.processStringForParameters({props:e},n);if(null!=a){var l=a.split(",");for(var o in l){var c=l[o];(c=c.replace('"',"").replace('"',"").replace("<","").replace(">","").replace('\\"',"").replace('\\"',"")).length>4&&r.push(t+c)}}}return r}},{key:"shouldComponentUpdate",value:function(e,t){try{var i=this.getGLBFilesFromProps(this.props),r=this.getGLBFilesFromProps(e);if(JSON.stringify(i)!=JSON.stringify(r))return!0}catch(l){}try{if(this.props.data!=e.data)return!0}catch(l){}try{var s=this.props.guidselector,n=this.props.pubsub[s],a=e.guidselector;if(e.pubsub[a]!=n)return!0}catch(l){}return!1}},{key:"loadTestIFC",value:function(){var e=[];for(var t in e.push("SITE_HOW.ifc"),e){var i=e[t];this.loadIFC("http://localhost:3000/temp/"+i)}}},{key:"loadIFC",value:function(e){var t=this;this.ifcLoader.load(e,(function(e){return t.scene.add(e)}))}},{key:"updateRender",value:function(e){if(null!=this.viewer)if(null!=this.viewer.renderer&&this.processSparqlResults)this.ifcdb.processSparqlResults(this);else if(null!=this.viewer.renderer){var t=this.getGLBFilesFromProps(this.props);if(this.isEmpty(t))return new A(this),void(this.ifcdb.isEmpty()||(this.viewer.controls.enabled=!1,this.ifcdb.setVisible(!1),this.ifcdb.emptyScene(),this.ifcdb.processedAll()));if(e||this.ifcdb.shouldLoadNewFiles(t))return this.viewer.controls.enabled=!1,this.props.setLoading(!0),void this.ifcdb.loadGLBFiles(this,t);if(this.ifcdb.ifcdbsparql.needsUpdate())return this.viewer.controls.enabled=!1,this.props.setLoading(!0),void this.ifcdb.processedAll(!0);null!=this.props.guidselector&&this.viewer.setSelectedGuid()}}},{key:"isEmpty",value:function(e){if(null==e)return!0;if(0==e.length)return!0;if(1==e.length){var t=e[0];if(t.includes("http://www.buildingbits.nl/reset"))return!0;if(t.length<3)return!0}return!1}},{key:"render",value:function(){var e=this;this.ifcdb.loadingInProgress?(console.log("input changed. we might have to check because loading is true"),this.ifcdb.inputChanged=!0):this.updateRender(),null==this.id&&(i.idN++,this.id="id"+i.idN);var t="tippydiv"+this.id,r="three-canvas"+this.id;this.id;return Object(R.jsxs)("div",{ref:this.canvasDiv,id:t,className:G.a.fullWidget,children:[Object(R.jsx)("div",{className:G.a.right,children:Object(R.jsx)("img",{src:I.a,alt:"gear",onClick:function(){return e.setState({dialogVisible:!0})}})}),Object(R.jsx)("canvas",{className:G.a.fullWidget,style:{position:"relative"},id:r})]})}}]),i}(l.Component);T.idN=0;t.default=Object(B.b)()(T)},912:function(e,t){function i(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}i.keys=function(){return[]},i.resolve=i,e.exports=i,i.id=912}}]);
//# sourceMappingURL=16.0aa288e2.chunk.js.map