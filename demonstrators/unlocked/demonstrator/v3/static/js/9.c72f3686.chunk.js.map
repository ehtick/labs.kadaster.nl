{"version":3,"sources":["components/widgets/DynamicFilter/filters/ListFilter.module.css","components/widgets/DynamicFilter/DynamicFilter.module.css","components/widgets/DynamicFilter/AddFilterDialog.module.css","components/widgets/DynamicFilter/filters/ListFilter.tsx","components/CustomRangeSlider.tsx","components/widgets/DynamicFilter/filters/RangeFilter.tsx","helpers/sparqlResultHelpers.ts","components/widgets/DynamicFilter/util/convertSparQLResultToFilterProperties.ts","components/widgets/DynamicFilter/model/FilterValues.ts","components/widgets/DynamicFilter/util/syncUrlFilterState.ts","hooks/use-dependent-state.ts","components/widgets/DynamicFilter/util/useFilterContext.ts","components/widgets/DynamicFilter/filters/SearchSelectFilter.tsx","components/widgets/DynamicFilter/filters/DateRangeFilter.tsx","components/widgets/DynamicFilter/AddFilterDialog.tsx","components/widgets/DynamicFilter/DynamicFilter.tsx","components/widgets/DynamicFilter/util/sparqlSnippetPublishedFilters.ts","hooks/use-force-update.ts","components/widgets/DynamicFilter/filters/RangeFilter.module.css"],"names":["module","exports","MAX_ITEMS_COLLAPSED","ListFilter","props","idRef","useRef","uniqueId","checkboxesFilterValues","filterValue","type","values","radiobuttonsFilterValue","value","slicedFilterOptions","filterProperty","options","slice","useState","every","some","opt","isExpanded","setExpanded","displayedFilterOptions","remainingOptions","length","shouldDisplayExpanderToggle","className","styles","name","current","checked","onChange","map","includes","e","enabled","newValues","filter","v","valueType","toggleCheckboxFilterOption","currentTarget","label","toggleRadioFilterOption","href","onClick","preventDefault","prevExpanded","CustomRangeSlider","localValue","setLocalValue","useEffect","sendUpdate","min","max","onInput","onSlide","onThumbDragEnd","onRangeDragEnd","RangeFilter","Infinity","SafeImmediateNumberInput","Math","isFinite","minmax","otherProps","sanitizeNumberToString","setLocalValueAndPublishIfValid","inputValue","inputValueAsNumber","valueAsNumber","isNaN","onKeyUp","number","toString","XML_SCHEMA_BOOLEAN","getValueAsUri","data","Error","getValueAsLiteralString","getValueAsLiteralOrUri","isTypeAnyOf","getValueAsLiteralBoolean","datatype","getValueAsLiteralNumberFuzzy","parseFloat","types","FilterPropertiesBuilder","filterPropertiesByUri","partialFilterProperty","propertyUri","this","filterProperties","getOrCreate","push","Object","asFilterValueTypeOrNull","readUrlFilterState","visibility","Set","urlParams","URLSearchParams","window","location","search","parameterName","propertyLabel","has","get","readSingleFilterValue","urlValues","getAll","readMultiFilterValues","rangeParameterNames","createRangeParameterNames","rangeValue","getUrlParamAsValidNumberOrNull","readRangeFilterValues","getUrlParamAsValidDateOrNull","readDateRangeFilterValues","JSON","stringify","defaultVisible","add","valueString","date","Date","getTime","getParameterName","MAX_PARAMETER_SUFFIX","MIN_PARAMETER_SUFFIX","useDependentState","stateCreator","deps","forceUpdate","useForceUpdate","initialState","useMemo","stateRef","prevDeps","dep","index","is","depsAreEqual","updateState","useCallback","action","nextState","useFilterContext","sparqlData","sparQLResult","filterPropertiesBuilder","results","bindings","binding","sparqlParameter","property","propertyURI","valueLabel","defaultExpanded","numberValue","valueURI","addMin","addMax","dateValueStr","dateValue","addMinDate","addMaxDate","addListValue","console","error","build","convertSparQLResultToFilterProperties","info","filterState","setFilterState","filtersTouched","markFiltersTouchedBefore","func","writeSingleFilterValue","delete","set","writeMultiFilterValues","append","writeRangeFilterValues","forEach","writeDateRangeFilterValues","toISOString","isVisible","history","replaceState","pathname","writeUrlFilterState","setFilterValue","uri","produce","draftFilterState","setFiltersVisibility","uris","visible","setFilterVisibility","reset","fp","properties","state","isStateModified","isFilterStateModified","hasAddableFilters","p","hasFilterValues","keys","hasAdditionalProperties","Array","from","SearchSelectFilter","filterValueOption","find","isClearable","isSearchable","placeholder","getOptionLabel","option","getOptionValue","menuPortalTarget","document","querySelector","DateRangeFilter","minPossibleValueIsoString","formatAsISODateOrEmpty","maxPossibleValueIsoString","SafeDateInput","stringValue","setStringValue","minIsoString","maxIsoString","inputValueAsDate","valueAsDate","year","String","getFullYear","padStart","month","getMonth","day","getDate","Dialog","Dialog_","Button","Button_","Input","Input_","Label","Label_","AddFilterDialog","setFilter","selectedUris","setSelectedUris","filtersFilteredAndSorted","availableProperties","toLowerCase","sort","a","b","localeCompare","addFiltersAndClose","onClose","autoFocus","onKeyDown","key","firstUri","addSingleFilterAndClose","multiple","selectedOptions","o","onDoubleClick","style","textAlign","color","minWidth","marginTop","marginLeft","DynamicFilter","filterContext","filtersPublishVariable","publishedFilters","publishOptions","filtersSparql","entries","propertyUriAsUri","variableName","replace","singleValue","multiValue","PublishUtils","getListAsSingleValue","filterLogicalOperation","join","sparqlSnippetPublishedFilters","publishWorkaround","urlPublishVariable","topic","setTimeout","publish","loading","FilterHolder","show","useDialog","openAddDialog","hiddenProperties","onSubmit","variant","size","startIcon","flexGrow","disabled","commonParams","filterComponent","FilterExpandableAndClearable","showClearButton","onClear","clearFilterProperty","isOpen","open","title","Icon","icon","children","useReducer"],"mappings":"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","file":"static/js/9.c72f3686.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"list-filter\":\"ListFilter_list-filter__1EKzq\",\"item\":\"ListFilter_item__1NPbG\",\"expander\":\"ListFilter_expander__1L7uw\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"dynamic-filter\":\"DynamicFilter_dynamic-filter__rHkcm\",\"dynamic-filter-expandable\":\"DynamicFilter_dynamic-filter-expandable__1kziO\",\"clear\":\"DynamicFilter_clear__2lyZ6\",\"dynamic-filter-body\":\"DynamicFilter_dynamic-filter-body__3Ndx4\",\"button-bar\":\"DynamicFilter_button-bar__2A0Al\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"inputs\":\"AddFilterDialog_inputs__1ZRDd\"};","import { useRef, useState } from \"react\"\nimport { FilterValue } from \"../model/FilterValues\"\nimport { FilterOption, MultiFilterProperty } from \"../model/FilterProperties\"\nimport styles from \"./ListFilter.module.css\"\n// @ts-ignore does not have typings\nimport uniqueId from \"lodash.uniqueid\"\n\nconst MAX_ITEMS_COLLAPSED = 4\n\nexport function ListFilter(props: {\n  type: \"checkboxes\" | \"radiobuttons\"\n  filterProperty: MultiFilterProperty\n  filterValue: FilterValue | null\n  onChange: (value: FilterValue | null) => void\n}) {\n  const idRef = useRef<string>(uniqueId())\n\n  const checkboxesFilterValues = props.filterValue?.type === \"multi\"\n    ? props.filterValue.values\n    : []\n  const radiobuttonsFilterValue = props.filterValue?.type === \"single\"\n    ? props.filterValue.value\n    : null\n\n  const slicedFilterOptions = props.filterProperty.options.slice(0, MAX_ITEMS_COLLAPSED)\n\n  const [ isExpanded, setExpanded ] = useState(areTheChosenOptionsOutsideSlicedOptions)\n\n  const displayedFilterOptions = isExpanded\n    ? props.filterProperty.options\n    : slicedFilterOptions\n\n  const remainingOptions = props.filterProperty.options.length - displayedFilterOptions.length\n  const shouldDisplayExpanderToggle = isExpanded || remainingOptions > 0\n\n  const toggleCheckboxFilterOption = (value: FilterOption, enabled: boolean) => {\n    const newValues = enabled\n      ? [ ...checkboxesFilterValues, value.value ]\n      : checkboxesFilterValues.filter(v => v !== value.value)\n    props.onChange(newValues.length ? {\n      type: \"multi\",\n      valueType: props.filterProperty.valueType,\n      values: newValues\n    } : null)\n  }\n\n  const clearRadioFilterOption = () => {\n    props.onChange(null)\n  }\n\n  const toggleRadioFilterOption = (value: FilterOption, enabled: boolean) => {\n    props.onChange(enabled ? {\n      type: \"single\",\n      valueType: props.filterProperty.valueType,\n      value: value.value\n    } : null)\n  }\n\n  return (\n    <div className={styles[\"list-filter\"]}>\n      {props.type === \"radiobuttons\" && (\n        <div className={styles[\"item\"]}>\n          <label>\n            <input name={`listfilter_${idRef.current}`}\n                   type=\"radio\" checked={radiobuttonsFilterValue == null}\n                   onChange={clearRadioFilterOption} />\n            All\n          </label>\n        </div>\n      )}\n\n      {displayedFilterOptions.map(value => {\n        if (props.type === \"checkboxes\") {\n          const checked = checkboxesFilterValues.includes(value.value)\n          return (\n            <div key={value.value} className={styles[\"item\"]}>\n              <label>\n                <input type=\"checkbox\" checked={checked} onChange={e => {\n                  toggleCheckboxFilterOption(value, e.currentTarget.checked)\n                }} />\n                {value.label}\n              </label>\n            </div>\n          )\n        } else {\n          const checked = radiobuttonsFilterValue === value.value\n          return (\n            <div key={value.value} className={styles[\"item\"]}>\n              <label>\n                <input name={`listfilter_${idRef.current}`} type=\"radio\" checked={checked} onChange={e => {\n                  toggleRadioFilterOption(value, e.currentTarget.checked)\n                }} />\n                {value.label}\n              </label>\n            </div>\n          )\n        }\n      })}\n\n      {shouldDisplayExpanderToggle && (\n        <a href=\"#\" className={styles[\"expander\"]} onClick={e => {\n          e.preventDefault()\n          setExpanded(prevExpanded => !prevExpanded)\n        }}>\n          {isExpanded\n            ? '⇑⇑ less'\n            : `⇓⇓ ${remainingOptions} more`}\n        </a>\n      )}\n    </div>\n  )\n\n  function areTheChosenOptionsOutsideSlicedOptions() {\n    return !checkboxesFilterValues.every(filterValue =>\n      slicedFilterOptions.some(opt => opt.value === filterValue)\n    )\n  }\n}\n","import React, { useEffect, useState } from \"react\"\n// @ts-ignore no typings available for this\nimport RangeSlider from \"react-range-slider-input\"\nimport \"react-range-slider-input/dist/style.css\"\n\n/**\n * Wrap react-range-slider-input RangeSlider so that:\n * a) we have typings\n * b) the range is only published when the user has finished dragging, while\n *    keeping the component controlled\n */\nexport function CustomRangeSlider(props: {\n  className?: string\n  min: number\n  max: number\n  value: [ number, number ]\n  onChange: (minmax: [ number, number ]) => void\n  onSlide?: (minmax: [ number, number ]) => void\n}) {\n  const [ localValue, setLocalValue ] = useState(props.value)\n\n  useEffect(() => {\n    setLocalValue(props.value)\n  }, [ props.value ])\n\n  const setLocalValueAndSendUpdateIfNeeded = (value: [ number, number ]) => {\n    setLocalValue(value)\n    props.onSlide?.(value)\n  }\n\n  const sendUpdate = () => {\n    props.onChange(localValue)\n  }\n\n  return (\n    <RangeSlider\n      className={props.className}\n      min={props.min}\n      max={props.max}\n      value={localValue}\n      onInput={setLocalValueAndSendUpdateIfNeeded}\n      onThumbDragEnd={sendUpdate}\n      onRangeDragEnd={sendUpdate} />\n  )\n}\n","import React, { useEffect, useState } from \"react\"\nimport { FilterValue } from \"../model/FilterValues\"\nimport { RangeFilterProperty } from \"../model/FilterProperties\"\nimport { CustomRangeSlider } from \"../../../CustomRangeSlider\"\nimport styles from \"./RangeFilter.module.css\"\n\nexport function RangeFilter(props: {\n  filterProperty: RangeFilterProperty\n  filterValue: FilterValue | null\n  onChange: (value: FilterValue) => void\n}) {\n\n  const filterValue = props.filterValue?.type === \"range\"\n    ? props.filterValue\n    : {\n      type: \"range\",\n      min: -Infinity,\n      max: +Infinity\n    }\n\n  const setMinMax = (minmax: [ number, number ]) => {\n    props.onChange({\n      type: \"range\",\n      min: minmax[0],\n      max: minmax[1]\n    })\n  }\n\n  const setMin = (value: number | null) => {\n    props.onChange({\n      type: \"range\",\n      min: value != null ? value : -Infinity,\n      max: filterValue.max\n    })\n  }\n\n  const setMax = (value: number | null) => {\n    props.onChange({\n      type: \"range\",\n      min: filterValue.min,\n      max: value != null ? value : +Infinity,\n    })\n  }\n\n  return (\n    <div className={styles[\"range-filter\"]}>\n      <div className={styles[\"range-filter-inputs\"]}>\n        <SafeImmediateNumberInput\n          value={filterValue.min}\n          min={props.filterProperty.min}\n          max={Math.min(filterValue.max, props.filterProperty.max)}\n          onChange={setMin} />\n        <div className={styles[\"separator\"]}>—</div>\n        <SafeImmediateNumberInput\n          value={filterValue.max}\n          min={Math.max(filterValue.min, props.filterProperty.min)}\n          max={props.filterProperty.max}\n          onChange={setMax} />\n      </div>\n      <div className={styles[\"range-filter-slider\"]}>\n        <CustomRangeSlider\n          className={styles[\"range-slider\"]}\n          min={props.filterProperty.min}\n          max={props.filterProperty.max}\n          value={[\n            isFinite(filterValue.min) ? filterValue.min : props.filterProperty.min,\n            isFinite(filterValue.max) ? filterValue.max : props.filterProperty.max,\n          ]}\n          onChange={setMinMax} />\n      </div>\n      <div className={styles[\"range-filter-legend\"]}>\n        <label>{props.filterProperty.min}</label>\n        <div className={styles[\"grow\"]} />\n        <label>{props.filterProperty.max}</label>\n      </div>\n    </div>\n  )\n}\n\n/**\n * Controlled input for numbers, with the modified behaviour that\n * the onChange handler will be triggered on both the \"keyup\" and \"change\" events,\n * but only if the number is not NaN, or if it is empty\n */\nexport function SafeImmediateNumberInput(props: {\n  value: number | null\n  onChange: (value: number | null) => void\n} & Omit<React.InputHTMLAttributes<HTMLInputElement>, \"type\" | \"value\" | \"onChange\" | \"onKeyUp\">) {\n  const { value, onChange, ...otherProps } = props\n\n  const [ localValue, setLocalValue ] = useState(sanitizeNumberToString(props.value))\n\n  useEffect(() => {\n    setLocalValue(sanitizeNumberToString(props.value))\n  }, [ props.value ])\n\n  const setLocalValueAndPublishIfValid = (e: React.SyntheticEvent<HTMLInputElement>) => {\n    const inputValue = e.currentTarget.value\n    const inputValueAsNumber = e.currentTarget.valueAsNumber\n\n    setLocalValue(inputValue)\n\n    if (inputValue === \"\") {\n      props.onChange(null)\n    } else if (!isNaN(inputValueAsNumber)) {\n      props.onChange(inputValueAsNumber)\n    }\n  }\n\n  return (\n      <input type=\"number\"\n             value={localValue}\n             onChange={setLocalValueAndPublishIfValid}\n             onKeyUp={setLocalValueAndPublishIfValid}\n             {...otherProps}\n      />\n  )\n}\n\nfunction sanitizeNumberToString(number: number | null) {\n  return (number != null && isFinite(number) && !isNaN(number))\n    ? number.toString()\n    : \"\"\n}\n","export type SparqlResults<Keys extends string, OptionalKeys extends string = never> = {\n  head: {\n    vars: (Keys & OptionalKeys)[]\n  },\n  results: {\n    bindings: Array<{\n      [key in Keys]: Data\n    }> & Array<{\n      [key in OptionalKeys]?: Data\n    }>\n  }\n}\n\nconst XML_SCHEMA_INTEGER = \"http://www.w3.org/2001/XMLSchema#integer\"\nconst XML_SCHEMA_FLOAT = \"http://www.w3.org/2001/XMLSchema#float\"\nconst XML_SCHEMA_DOUBLE = \"http://www.w3.org/2001/XMLSchema#double\"\nconst XML_SCHEMA_BOOLEAN = \"http://www.w3.org/2001/XMLSchema#boolean\"\n\ntype Data = Uri | LiteralString | LiteralInteger | LiteralFloat | LiteralDouble | LiteralBoolean\ntype LiteralBoolean = { type: \"literal\", value: string, datatype: typeof XML_SCHEMA_BOOLEAN }\ntype LiteralInteger = { type: \"literal\", value: string, datatype: typeof XML_SCHEMA_INTEGER }\ntype LiteralFloat = { type: \"literal\", value: string, datatype: typeof XML_SCHEMA_FLOAT }\ntype LiteralDouble = { type: \"literal\", value: string, datatype: typeof XML_SCHEMA_DOUBLE }\ntype LiteralString = { type: \"literal\", value: string }\ntype Uri = { type: \"uri\", value: \"string\" }\n\nexport function getValueAsUri(data: Data): string {\n  if (data.type !== \"uri\")\n    throw new Error(`Expected type uri, got ${data.type} for ${data.value}`)\n\n  return data.value\n}\n\nexport function getValueAsLiteralString(data: Data): string {\n  if (data.type !== \"literal\")\n    throw new Error(`Expected type literal, got ${data.type} for ${data.value}`)\n\n  return data.value\n}\n\nexport function getValueAsLiteralOrUri(data: Data): string {\n  if (!isTypeAnyOf(data.type, [\"literal\", \"uri\"]))\n    throw new Error(`Expected type literal or uri, got ${data.type} for ${data.value}`)\n\n  return data.value\n}\n\nexport function getValueAsLiteralBoolean(data: Data): boolean {\n  if (data.type !== \"literal\")\n    throw new Error(`Expected type literal, got ${data.type} for ${data.value}`)\n\n  if (!(\"datatype\" in data))\n    throw Error(`No datatype for ${data.value}, was expecting boolean`)\n\n  if (data.datatype !== XML_SCHEMA_BOOLEAN)\n    throw new Error(`Wrong datatype for ${data.value}, was expecting boolean`)\n\n  return data.value === \"true\"\n}\n\nexport function getValueAsLiteralNumber(data: Data): number {\n  if (data.type !== \"literal\")\n    throw new Error(`Expected type literal, got ${data.type} for ${data.value}`)\n\n  if (!(\"datatype\" in data))\n    throw Error(`No datatype for ${data.value}, was expecting float or integer`)\n\n  if (!isTypeAnyOf(data.datatype, [XML_SCHEMA_FLOAT, XML_SCHEMA_DOUBLE, XML_SCHEMA_INTEGER]))\n    throw new Error(`Expected double, float or integer datatype, got ${data.datatype} for ${data.value}`)\n\n  return parseFloat(data.value)\n}\n\n/**\n * Unlike {@see getValueAsLiteralNumber}, this also allows strings containing numbers\n */\nexport function getValueAsLiteralNumberFuzzy(data: Data): number {\n  if (data.type !== \"literal\")\n    throw new Error(`Expected type literal, got ${data.type} for ${data.value}`)\n\n  return parseFloat(data.value)\n}\n\nfunction isTypeAnyOf<T, U extends T>(type: T, types: U[]): type is U {\n  return types.includes(type as U);\n}\n","import {\n  getValueAsLiteralBoolean,\n  getValueAsLiteralNumberFuzzy,\n  getValueAsLiteralOrUri,\n  getValueAsLiteralString,\n  getValueAsUri,\n  SparqlResults\n} from \"../../../../helpers/sparqlResultHelpers\"\nimport {\n  FilterProperty, FilterType,\n  FilterOption,\n  MultiFilterProperty,\n  RangeFilterProperty, DateRangeFilterProperty\n} from \"../model/FilterProperties\"\n\nexport type DynamicFilterSparQLResults\n  = SparqlResults<\"sparqlParameter\"\n  | \"property\"\n  | \"propertyURI\"\n  | \"value\"\n  | \"valueURI\"\n  | \"type\"\n  , \"defaultExpanded\"\n  | \"defaultVisible\">\n\ntype PartialFilterProperty\n  = Pick<FilterProperty, \"sparqlParameter\"\n  | \"propertyUri\"\n  | \"propertyLabel\"\n  | \"defaultExpanded\"\n  | \"defaultVisible\">\n\nexport function convertSparQLResultToFilterProperties(sparQLResult: DynamicFilterSparQLResults) {\n  const filterPropertiesBuilder = new FilterPropertiesBuilder()\n\n  for (const binding of sparQLResult.results.bindings) {\n    const sparqlParameter = getValueAsLiteralString(binding.sparqlParameter)\n    const propertyLabel = getValueAsLiteralString(binding.property)\n    const propertyUri = getValueAsUri(binding.propertyURI)\n    const type = getValueAsLiteralString(binding.type)\n    const valueLabel = getValueAsLiteralString(binding.value)\n    const defaultExpanded = binding.defaultExpanded\n      ? getValueAsLiteralBoolean(binding.defaultExpanded)\n      : false\n    const defaultVisible = binding.defaultVisible\n      ? getValueAsLiteralBoolean(binding.defaultVisible)\n      : true\n\n    const partialFilterProperty: PartialFilterProperty = {\n      sparqlParameter, propertyUri, propertyLabel, defaultExpanded, defaultVisible\n    }\n\n    switch (type) {\n      case \"range\":\n        const numberValue = getValueAsLiteralNumberFuzzy(binding.valueURI)\n        if (valueLabel === \"min\") {\n          filterPropertiesBuilder.addMin(partialFilterProperty, numberValue)\n        } else if (valueLabel === \"max\") {\n          filterPropertiesBuilder.addMax(partialFilterProperty, numberValue)\n        } else {\n          throw new Error(`Filter ?value for 'range' should be 'min' or 'max', received ${valueLabel}`)\n        }\n        break\n      case \"daterange\":\n        const dateValueStr = getValueAsLiteralString(binding.valueURI)\n        const dateValue = new Date(dateValueStr)\n        if (!isDateValid(dateValue)) {\n          throw new Error(`Invalid date literal ${dateValueStr}, should be ISO format`)\n        }\n\n        if (valueLabel === \"min\") {\n          filterPropertiesBuilder.addMinDate(partialFilterProperty, dateValue)\n        } else if (valueLabel === \"max\") {\n          filterPropertiesBuilder.addMaxDate(partialFilterProperty, dateValue)\n        } else {\n          throw new Error(`Filter ?value for 'daterange' should be 'min' or 'max', received ${valueLabel}`)\n        }\n        break\n      case \"search\":\n      case \"radiobuttons\":\n      case \"checkboxes\":\n        filterPropertiesBuilder.addListValue(partialFilterProperty, binding.valueURI.type, type, {\n          label: valueLabel,\n          value: getValueAsLiteralOrUri(binding.valueURI)\n        })\n        break\n      default:\n        console.error(`Unrecognized filter type ${type}`)\n    }\n  }\n\n  return filterPropertiesBuilder.build()\n}\n\nclass FilterPropertiesBuilder {\n  filterPropertiesByUri: Record<string, FilterProperty> = {}\n\n  getOrCreate(partialFilterProperty: PartialFilterProperty, type: \"range\"): RangeFilterProperty\n  getOrCreate(partialFilterProperty: PartialFilterProperty, type: \"daterange\"): DateRangeFilterProperty\n  getOrCreate(partialFilterProperty: PartialFilterProperty, type: \"checkboxes\" | \"radiobuttons\" | \"search\", valueType: \"uri\" | \"literal\"): MultiFilterProperty\n  getOrCreate(partialFilterProperty: PartialFilterProperty, type: FilterType, valueType: \"uri\" | \"literal\" = \"literal\") {\n    const propertyUri = partialFilterProperty.propertyUri\n    if (propertyUri in this.filterPropertiesByUri) {\n      const filterProperties = this.filterPropertiesByUri[propertyUri]\n      if (filterProperties.valueType !== valueType) {\n        throw new Error(`value types for ${propertyUri} are not consistent, must be all uris or all literals.`)\n      }\n      if (filterProperties.type !== type) {\n        throw new Error(`filter types for ${propertyUri} are not consistent (found ${filterProperties.type} but expected ${type})`)\n      }\n      return filterProperties\n    }\n\n    const filterProperty: FilterProperty = (() => {\n      switch (type) {\n        case \"range\":\n          return {\n            ...partialFilterProperty,\n            type,\n            valueType: \"literal\",\n            min: -Infinity,\n            max: +Infinity\n          }\n        case \"daterange\":\n          return {\n            ...partialFilterProperty,\n            type,\n            valueType: \"literal\",\n            min: null,\n            max: null\n          }\n        case \"search\":\n        case \"radiobuttons\":\n        case \"checkboxes\":\n          return {\n            ...partialFilterProperty,\n            type,\n            valueType,\n            options: []\n          }\n        default:\n          throw new Error(`Unknown FilterType ${type}`)\n      }\n    })()\n    this.filterPropertiesByUri[propertyUri] = filterProperty\n    return filterProperty\n  }\n\n  addMin(partialFilterProperty: PartialFilterProperty, min: number) {\n    this.getOrCreate(partialFilterProperty, \"range\").min = min\n  }\n\n  addMax(partialFilterProperty: PartialFilterProperty, max: number) {\n    this.getOrCreate(partialFilterProperty, \"range\").max = max\n  }\n\n  addMinDate(partialFilterProperty: PartialFilterProperty, min: Date) {\n    this.getOrCreate(partialFilterProperty, \"daterange\").min = min\n  }\n\n  addMaxDate(partialFilterProperty: PartialFilterProperty, max: Date) {\n    this.getOrCreate(partialFilterProperty, \"daterange\").max = max\n  }\n\n  addListValue(\n    partialFilterProperty: PartialFilterProperty,\n    valueType: \"literal\" | \"uri\",\n    type: \"checkboxes\" | \"radiobuttons\" | \"search\",\n    value: FilterOption\n  ) {\n    this.getOrCreate(partialFilterProperty, type, valueType).options.push(value)\n  }\n\n  build(): FilterProperty[] {\n    return Object.values(this.filterPropertiesByUri)\n  }\n}\n\nfunction isDateValid(date: Date) {\n  return !isNaN(date.getTime())\n}\n","export type FilterValue = SingleFilterValue | MultiFilterValue | RangeFilterValue | DateRangeFilterValue\n\nexport type FilterValueType = \"single\" | \"multi\" | \"range\" | \"daterange\"\nexport interface BaseFilterValue {\n  type: FilterValueType\n}\n\nexport interface SingleFilterValue extends BaseFilterValue {\n  type: \"single\"\n  value: string\n  valueType: \"literal\" | \"uri\"\n}\n\nexport interface MultiFilterValue extends BaseFilterValue {\n  type: \"multi\"\n  values: string[]\n  valueType: \"literal\" | \"uri\"\n}\n\nexport interface RangeFilterValue extends BaseFilterValue {\n  type: \"range\"\n  min: number\n  max: number\n}\n\nexport interface DateRangeFilterValue extends BaseFilterValue {\n  type: \"daterange\"\n  min: Date | null\n  max: Date | null\n}\n\nexport function asFilterValueTypeOrNull<T extends FilterValue>(filterValue: FilterValue | null | undefined, type: T[\"type\"]): T | null {\n  if (!filterValue) return null\n  if (filterValue.type !== type) return null\n  if (!(filterValue as T)) return null\n  return filterValue as T\n}\n","import {\n  asFilterValueTypeOrNull,\n  DateRangeFilterValue,\n  FilterValue,\n  MultiFilterValue,\n  RangeFilterValue,\n  SingleFilterValue\n} from \"../model/FilterValues\"\nimport { FilterProperty } from \"../model/FilterProperties\"\nimport { FilterState } from \"../util/useFilterContext\"\n\nexport function writeUrlFilterState(filterProperties: FilterProperty[], filterState: FilterState) {\n  const urlParams = new URLSearchParams(window.location.search)\n\n  function writeSingleFilterValue(parameterName: string, filterValue: SingleFilterValue | null) {\n    urlParams.delete(parameterName)\n    if (!filterValue) return\n\n    urlParams.set(parameterName, filterValue.value)\n  }\n\n  function writeMultiFilterValues(parameterName: string, filterValue: MultiFilterValue | null) {\n    urlParams.delete(parameterName)\n    if (!filterValue) return\n\n    for (const value of filterValue.values) {\n      urlParams.append(parameterName, value)\n    }\n  }\n\n  function writeRangeFilterValues(parameterName: string, filterValue: RangeFilterValue | null) {\n    const rangeParameterNames = createRangeParameterNames(parameterName)\n    urlParams.delete(parameterName)\n    Object.values(rangeParameterNames).forEach(name => urlParams.delete(name))\n\n    if (!filterValue) return\n\n    if (isFinite(filterValue.min)) urlParams.set(rangeParameterNames.min, filterValue.min.toString())\n    if (isFinite(filterValue.max)) urlParams.set(rangeParameterNames.max, filterValue.max.toString())\n  }\n\n  function writeDateRangeFilterValues(parameterName: string, filterValue: DateRangeFilterValue | null) {\n    const rangeParameterNames = createRangeParameterNames(parameterName)\n    urlParams.delete(parameterName)\n    Object.values(rangeParameterNames).forEach(name => urlParams.delete(name))\n\n    if (!filterValue) return\n\n    if (filterValue.min) urlParams.set(rangeParameterNames.min, filterValue.min.toISOString())\n    if (filterValue.max) urlParams.set(rangeParameterNames.max, filterValue.max.toISOString())\n  }\n\n  for (const filterProperty of filterProperties) {\n    const parameterName = getParameterName(filterProperty)\n\n    const filterValue = filterState.values[filterProperty.propertyUri]\n\n    switch (filterProperty.type) {\n      case \"search\":\n      case \"radiobuttons\":\n        writeSingleFilterValue(parameterName, asFilterValueTypeOrNull(filterValue, \"single\"))\n        break\n      case \"checkboxes\":\n        writeMultiFilterValues(parameterName, asFilterValueTypeOrNull(filterValue, \"multi\"))\n        break\n      case \"range\":\n        writeRangeFilterValues(parameterName, asFilterValueTypeOrNull(filterValue, \"range\"))\n        break\n      case \"daterange\":\n        writeDateRangeFilterValues(parameterName, asFilterValueTypeOrNull(filterValue, \"daterange\"))\n        break\n      default:\n        throw new Error(`Unknown filter value type ${JSON.stringify(filterValue)}`)\n    }\n\n    if (!filterValue) {\n      const isVisible = filterState.visibility.has(filterProperty.propertyUri)\n      const shouldWriteVisibility = !filterProperty.defaultVisible && isVisible\n      if (shouldWriteVisibility) {\n        urlParams.set(parameterName, \"\")\n      }\n    }\n  }\n\n  window.history.replaceState({}, '', `${window.location.pathname}?${urlParams}`)\n}\n\nexport function readUrlFilterState(filterProperties: FilterProperty[]): FilterState {\n  const values: Record<string, FilterValue> = {}\n  const visibility: Set<string> = new Set()\n  const urlParams = new URLSearchParams(window.location.search)\n\n  function readSingleFilterValue(parameterName: string,  valueType: FilterProperty['valueType']): SingleFilterValue | null {\n    if (!urlParams.has(parameterName)) return null\n    const value = urlParams.get(parameterName)\n    if (!value) return null\n\n    return {\n      type: \"single\",\n      value,\n      valueType\n    }\n  }\n\n  function readMultiFilterValues(parameterName: string, valueType: FilterProperty['valueType']): MultiFilterValue | null {\n    if (!urlParams.has(parameterName)) return null\n\n    const urlValues = urlParams.getAll(parameterName)\n    if (!urlValues.length) return null\n\n    return {\n      type: \"multi\",\n      values: urlValues,\n      valueType\n    }\n  }\n\n  function readRangeFilterValues(parameterName: string): RangeFilterValue | null {\n    const rangeParameterNames = createRangeParameterNames(parameterName)\n\n    const rangeValue: RangeFilterValue = {\n      type: \"range\",\n      min: getUrlParamAsValidNumberOrNull(urlParams, rangeParameterNames.min) ?? -Infinity,\n      max: getUrlParamAsValidNumberOrNull(urlParams, rangeParameterNames.max) ?? +Infinity\n    }\n\n    if (!isFinite(rangeValue.min) && !isFinite(rangeValue.max)) {\n      return null\n    }\n\n    return rangeValue\n  }\n\n  function readDateRangeFilterValues(parameterName: string): DateRangeFilterValue | null {\n    const rangeParameterNames = createRangeParameterNames(parameterName)\n\n    const rangeValue: DateRangeFilterValue = {\n      type: \"daterange\",\n      min: getUrlParamAsValidDateOrNull(urlParams, rangeParameterNames.min),\n      max: getUrlParamAsValidDateOrNull(urlParams, rangeParameterNames.max)\n    }\n\n    if (!rangeValue.min && !rangeValue.max) {\n      return null\n    }\n\n    return rangeValue\n  }\n\n  for (const filterProperty of filterProperties) {\n    const parameterName = filterProperty.propertyLabel\n    const value = (() => {\n      switch (filterProperty.type) {\n        case \"search\":\n        case \"radiobuttons\":\n          return readSingleFilterValue(parameterName, filterProperty.valueType)\n        case \"checkboxes\":\n          return readMultiFilterValues(parameterName, filterProperty.valueType)\n        case \"range\":\n          return readRangeFilterValues(parameterName)\n        case \"daterange\":\n          return readDateRangeFilterValues(parameterName)\n        default:\n          throw new Error(`Unknown filter property type ${JSON.stringify(filterProperty)}`)\n      }\n    })()\n\n    if (value) {\n      values[filterProperty.propertyUri] = value\n    }\n\n    const isVisible = urlParams.has(parameterName) || value || filterProperty.defaultVisible\n    if (isVisible) {\n      visibility.add(filterProperty.propertyUri)\n    }\n  }\n\n  return { values, visibility }\n}\n\nfunction getUrlParamAsValidNumberOrNull(urlParams: URLSearchParams, name: string): number | null {\n  if (!urlParams.has(name)) return null\n\n  const valueString = urlParams.get(name)\n  if (valueString == null) return null\n\n  const number = parseFloat(valueString)\n  if (isNaN(number)) return null\n\n  return number\n}\n\nfunction getUrlParamAsValidDateOrNull(urlParams: URLSearchParams, name: string): Date | null {\n  if (!urlParams.has(name)) return null\n\n  const valueString = urlParams.get(name)\n  if (!valueString) return null\n\n  const date = new Date(valueString)\n  if (isNaN(date.getTime())) return null\n\n  return date\n}\n\n/**\n * The URL parameter name to use.\n * Rationale for using the label rather than URI: prettier/more human-readable\n *\n * @return the url parameter name to use\n */\nfunction getParameterName(filterProperty: FilterProperty) {\n  return filterProperty.propertyLabel\n}\n\nconst MAX_PARAMETER_SUFFIX = \".max\"\nconst MIN_PARAMETER_SUFFIX = \".min\"\n\ntype RangeParameterNames<T extends string> = {\n  min: `${T}${typeof MIN_PARAMETER_SUFFIX}`\n  max: `${T}${typeof MAX_PARAMETER_SUFFIX}`\n}\n\nfunction createRangeParameterNames<T extends string>(parameterName: T): RangeParameterNames<T> {\n  return {\n    min: `${parameterName}${MIN_PARAMETER_SUFFIX}`,\n    max: `${parameterName}${MAX_PARAMETER_SUFFIX}`\n  }\n}\n","import { DependencyList, Dispatch, SetStateAction, useCallback, useMemo, useRef } from \"react\"\nimport { useForceUpdate } from \"./use-force-update\"\n\nexport function useDependentState<S>(\n  stateCreator: (prevState?: S) => S,\n  deps: DependencyList,\n): [S, Dispatch<SetStateAction<S>>] {\n  const forceUpdate = useForceUpdate()\n\n  const initialState = useMemo(() => stateCreator(), [])\n  const stateRef = useRef<S>(initialState)\n\n  const prevDeps = useRef(deps)\n\n  if (!depsAreEqual(prevDeps.current, deps)) {\n    stateRef.current = stateCreator(stateRef.current)\n    prevDeps.current = deps\n  }\n\n  const updateState = useCallback(function (action: SetStateAction<S>) {\n    const nextState = isFunction(action) ? action(stateRef.current) : action\n    stateRef.current = nextState\n    forceUpdate()\n  }, [])\n\n  return [ stateRef.current, updateState ]\n}\n\nfunction depsAreEqual<D extends DependencyList>(prevDeps: D, deps: D): boolean {\n  return (\n    prevDeps.length === deps.length &&\n    deps.every((dep, index) => Object.is(dep, prevDeps[index]))\n  );\n}\n\nfunction isFunction<S>(setStateAction: SetStateAction<S>): setStateAction is (prevState: S) => S {\n  return typeof setStateAction === \"function\"\n}\n","import {\n  convertSparQLResultToFilterProperties,\n  DynamicFilterSparQLResults\n} from \"./convertSparQLResultToFilterProperties\"\nimport { useEffect, useMemo, useRef } from \"react\"\nimport { produce } from \"immer\"\nimport { FilterValue } from \"../model/FilterValues\"\nimport { readUrlFilterState, writeUrlFilterState } from \"./syncUrlFilterState\"\nimport { useDependentState } from \"../../../../hooks/use-dependent-state\"\nimport { FilterProperty } from \"../model/FilterProperties\"\n\nexport type FilterContext = {\n  properties: FilterProperty[]\n  state: FilterState\n  isStateModified: boolean\n  hasAddableFilters: boolean\n\n  setFilterValue: (uri: string, value: FilterValue | null) => void\n  setFilterVisibility: (uri: string, visible: boolean) => void\n  setFiltersVisibility: (uris: string[], visible: boolean) => void\n  reset: () => void\n}\n\nexport type FilterState = {\n  values: Record<string, FilterValue>\n  visibility: Set<string>\n}\n\nexport function useFilterContext(\n  sparqlData: DynamicFilterSparQLResults | null | undefined\n): FilterContext | null {\n  const filterProperties = useMemo(() => {\n    if (!sparqlData) return null\n    try {\n      return convertSparQLResultToFilterProperties(sparqlData)\n    } catch (e) {\n      console.error(\"Error parsing filter config from SparQL\", e)\n      console.info(\"The bindings received are: \", sparqlData?.results?.bindings)\n      return null\n    }\n  }, [ sparqlData ])\n\n  const [ filterState, setFilterState ] = useDependentState<FilterState>(() => {\n    if (!filterProperties) {\n      return {\n        values: {},\n        visibility: new Set()\n      }\n    }\n\n    return readUrlFilterState(filterProperties)\n  }, [ filterProperties ])\n\n  const filtersTouched = useRef(false)\n\n  useEffect(() => {\n    if (!filterProperties) return\n    if (!filtersTouched.current) return\n    writeUrlFilterState(filterProperties, filterState)\n  }, [ filterProperties, filterState, filtersTouched.current ])\n\n  function markFiltersTouchedBefore<F extends (...args: any) => any>(func: F) {\n    return (...args: Parameters<F>) => {\n      filtersTouched.current = true\n      return func(...args)\n    }\n  }\n\n  const setFilterValue = (uri: string, value: FilterValue | null) => {\n    setFilterState(filterState => produce(filterState, draftFilterState => {\n      if (value == null) {\n        delete draftFilterState.values[uri]\n      } else {\n        draftFilterState.values[uri] = value\n      }\n    }))\n  }\n\n  const setFiltersVisibility = (uris: string[], visible: boolean) => {\n    setFilterState(filterState => produce(filterState, draftFilterState => {\n      for (const uri of uris) {\n        visible\n          ? draftFilterState.visibility.add(uri)\n          : draftFilterState.visibility.delete(uri)\n      }\n    }))\n  }\n\n  const setFilterVisibility = (uri: string, visible: boolean) => {\n    setFiltersVisibility([ uri ], visible)\n  }\n\n  const reset = () => {\n    if (!filterProperties) {\n      console.error(\"Error: filterProperties is null\")\n      return\n    }\n\n    setFilterState(filterState => produce(filterState, draftFilterState => {\n      draftFilterState.values = {}\n      draftFilterState.visibility = new Set(\n        filterProperties\n          .filter(fp => fp.defaultVisible)\n          .map(fp => fp.propertyUri)\n      )\n    }))\n  }\n\n  return useMemo(() => {\n    if (!filterProperties) return null\n\n    return {\n      properties: filterProperties,\n      state: filterState,\n      isStateModified: isFilterStateModified(filterProperties, filterState),\n      hasAddableFilters: hasAddableFilters(filterProperties),\n      setFilterValue: markFiltersTouchedBefore(setFilterValue),\n      setFilterVisibility: markFiltersTouchedBefore(setFilterVisibility),\n      setFiltersVisibility: markFiltersTouchedBefore(setFiltersVisibility),\n      reset: markFiltersTouchedBefore(reset)\n    }\n  }, [ filterProperties, filterState ])\n\n  function hasAddableFilters(filterProperties: FilterProperty[]) {\n    return filterProperties.some(p => !p.defaultVisible)\n  }\n\n  function isFilterStateModified(filterProperties: FilterProperty[], filterState: FilterState) {\n    const hasFilterValues = Object.keys(filterState.values).length > 0\n    const hasAdditionalProperties = Array.from(filterState.visibility).some(uri => {\n      return filterProperties.some(property => {\n        return property.propertyUri === uri && !property.defaultVisible\n      })\n    })\n    return hasFilterValues || hasAdditionalProperties\n  }\n\n}\n","import { MultiFilterProperty } from \"../model/FilterProperties\"\nimport { FilterValue } from \"../model/FilterValues\"\nimport Select from \"react-select\"\n\nexport function SearchSelectFilter(props: {\n  filterProperty: MultiFilterProperty\n  filterValue: FilterValue | null\n  onChange: (value: FilterValue | null) => void\n}) {\n  const filterValue = props.filterValue?.type === \"single\"\n    ? props.filterValue.value\n    : null\n\n  const filterValueOption = filterValue\n    ? props.filterProperty.options.find(opt => opt.value === filterValue)\n    : null\n\n  return (\n    <div>\n      <Select\n        isClearable\n        isSearchable\n        placeholder=\"Search...\"\n        options={props.filterProperty.options}\n        getOptionLabel={option => option.label}\n        getOptionValue={option => option.value ?? \"\"}\n        value={filterValueOption}\n        menuPortalTarget={document.querySelector('body')}\n        onChange={(value) => {\n          props.onChange(value ? {\n            type: \"single\",\n            valueType: props.filterProperty.valueType,\n            value: value.value\n          } : null)\n        }}\n      />\n    </div>\n  )\n}\n","import React, { useEffect, useState } from \"react\"\nimport { FilterValue } from \"../model/FilterValues\"\nimport { DateRangeFilterProperty } from \"../model/FilterProperties\"\nimport styles from \"./RangeFilter.module.css\"\n\nexport function DateRangeFilter(props: {\n  filterProperty: DateRangeFilterProperty\n  filterValue: FilterValue | null\n  onChange: (value: FilterValue) => void\n}) {\n\n  const filterValue = props.filterValue?.type === \"daterange\"\n    ? props.filterValue\n    : {\n      type: \"daterange\",\n      min: null,\n      max: null\n    }\n\n  const setMin = (value: Date | null) => {\n    props.onChange({\n      type: \"daterange\",\n      min: value,\n      max: filterValue.max\n    })\n  }\n\n  const setMax = (value: Date | null) => {\n    props.onChange({\n      type: \"daterange\",\n      min: filterValue.min,\n      max: value\n    })\n  }\n\n  const minPossibleValueIsoString = formatAsISODateOrEmpty(props.filterProperty.min)\n  const maxPossibleValueIsoString = formatAsISODateOrEmpty(props.filterProperty.max)\n\n  return (\n    <div className={styles[\"range-filter\"]}>\n      <div className={styles[\"range-filter-inputs\"]}>\n        <SafeDateInput\n          value={filterValue.min}\n          min={props.filterProperty.min}\n          max={filterValue.max ? filterValue.max : props.filterProperty.max}\n          onChange={setMin} />\n        <div className={styles[\"separator\"]}>—</div>\n        <SafeDateInput\n          value={filterValue.max}\n          min={filterValue.min ? filterValue.min : props.filterProperty.min}\n          max={props.filterProperty.max}\n          onChange={setMax} />\n      </div>\n      <div className={styles[\"range-filter-legend\"]}>\n        <label>{minPossibleValueIsoString}</label>\n        <div className={styles[\"grow\"]} />\n        <label>{maxPossibleValueIsoString}</label>\n      </div>\n    </div>\n  )\n}\n\nfunction SafeDateInput(props: {\n  value: Date | null\n  min?: Date | null\n  max?: Date | null\n  onChange: (value: Date | null) => void\n}) {\n  const [ stringValue, setStringValue ] = useState(formatAsISODateOrEmpty(props.value))\n\n  useEffect(() => {\n    setStringValue(formatAsISODateOrEmpty(props.value))\n  }, [ props.value ])\n\n  const setLocalValueAndPublishIfValid = (e: React.SyntheticEvent<HTMLInputElement>) => {\n    const inputValue = e.currentTarget.value\n    const inputValueAsDate = e.currentTarget.valueAsDate\n\n    setStringValue(inputValue)\n\n    if (inputValueAsDate == null) {\n      props.onChange(null)\n    } else if (!isNaN(inputValueAsDate.getTime())) {\n      props.onChange(inputValueAsDate)\n    }\n  }\n\n  const minIsoString = formatAsISODateOrEmpty(props?.min)\n  const maxIsoString = formatAsISODateOrEmpty(props?.max)\n\n  return (\n    <input\n      type=\"date\"\n      value={stringValue}\n      min={minIsoString}\n      max={maxIsoString}\n      onChange={setLocalValueAndPublishIfValid}\n    />\n  )\n}\n\nfunction formatAsISODateOrEmpty(date: Date | null | undefined): string {\n  if (!date) return \"\"\n  const year = String(date.getFullYear()).padStart(4, '0')\n  const month = String(date.getMonth() + 1).padStart(2, '0')\n  const day = String(date.getDate()).padStart(2, '0')\n  return `${year}-${month}-${day}`\n}\n","import React, { useMemo, useState } from \"react\"\nimport Dialog_ from \"../../Dialog\"\nimport { Button as Button_, Input as Input_, Label as Label_ } from \"reactstrap\"\nimport { FilterProperty } from \"./model/FilterProperties\"\nimport styles from \"./AddFilterDialog.module.css\"\n\n// Workaround due to incorrect or missing typings\nconst Dialog = Dialog_ as any\nconst Button = Button_ as any\nconst Input = Input_ as any\nconst Label = Label_ as any\n\nexport function AddFilterDialog(props: {\n  availableProperties: FilterProperty[]\n  onClose: (uris: string[] | null) => void\n}) {\n  const [ filter, setFilter ] = useState(\"\")\n  const [ selectedUris, setSelectedUris ] = useState<string[]>([])\n\n  const filtersFilteredAndSorted = useMemo(() => {\n    return props.availableProperties\n      .filter(filterProperty => filterProperty.propertyLabel.toLowerCase().includes(filter.toLowerCase()))\n      .sort((a, b) => a.propertyLabel.localeCompare(b.propertyLabel))\n  }, [ props.availableProperties, filter ])\n\n  const addFiltersAndClose = () => {\n    props.onClose(selectedUris)\n  }\n\n  const addSingleFilterAndClose = () => {\n    if (filtersFilteredAndSorted.length !== 1) return\n    const firstUri = filtersFilteredAndSorted[0].propertyUri\n    props.onClose([ firstUri ])\n  }\n\n  return (\n    <Dialog>\n      <Label><strong>Add properties to filter</strong></Label>\n      <div className={styles[\"inputs\"]}>\n        <Input\n          autoFocus\n          className=\"dark-form-control\"\n          placeholder=\"Search for properties...\"\n          value={filter}\n          type=\"search\"\n          onChange={(e: React.SyntheticEvent<HTMLInputElement>) => setFilter(e.currentTarget.value)}\n          onKeyDown={(e: React.KeyboardEvent<HTMLInputElement>) => e.key === \"Enter\" && addSingleFilterAndClose()}\n        />\n        <select className=\"dark-form-control\"\n                multiple\n                value={selectedUris}\n                onChange={e => setSelectedUris(Array.from(e.currentTarget.selectedOptions).map(o => o.value))}>\n          {filtersFilteredAndSorted.map(filterProperty => (\n            <option key={filterProperty.propertyUri}\n                    value={filterProperty.propertyUri}\n                    onDoubleClick={addFiltersAndClose}>\n              {filterProperty.propertyLabel}\n            </option>\n          ))}\n        </select>\n      </div>\n      <div style={{ textAlign: 'center' }}>\n        <Button color=\"secondary\"\n                style={{ minWidth: '120px', marginTop: '12px' }}\n                onClick={() => props.onClose(null)}>Cancel</Button>\n\n        <Button color=\"primary\"\n                style={{ minWidth: '120px', marginTop: '12px', marginLeft: '40px' }}\n                onClick={addFiltersAndClose}>Add</Button>\n      </div>\n    </Dialog>\n  )\n}","import React, { ReactNode, useEffect, useState } from \"react\"\nimport { DynamicFilterSparQLResults } from \"./util/convertSparQLResultToFilterProperties\"\nimport { FilterValue } from \"./model/FilterValues\"\nimport { ListFilter } from \"./filters/ListFilter\"\nimport { RangeFilter } from \"./filters/RangeFilter\"\nimport { FilterProperty } from \"./model/FilterProperties\"\nimport { useFilterContext } from \"./util/useFilterContext\"\nimport { FilterContext } from \"./util/useFilterContext\"\nimport styles from \"./DynamicFilter.module.css\"\nimport { FilterPublishOptions, sparqlSnippetPublishedFilters } from \"./util/sparqlSnippetPublishedFilters\"\nimport { SearchSelectFilter } from \"./filters/SearchSelectFilter\"\nimport { DateRangeFilter } from \"./filters/DateRangeFilter\"\nimport { AddFilterDialog } from \"./AddFilterDialog\"\nimport { Icon } from \"../Icon\"\nimport { Button } from \"@mui/material\"\nimport AddIcon from \"@mui/icons-material/Add\"\nimport CloseIcon from \"@mui/icons-material/Close\"\nimport { useDialog } from \"../../../hooks/use-dialog\"\n\nexport function DynamicFilter(props: {\n  query: string\n  filtersPublishVariable: string\n  urlPublishVariable: string\n  loading: boolean\n  data?: DynamicFilterSparQLResults\n  publish: (topic: string, value: unknown) => void\n} & Partial<FilterPublishOptions>) {\n  const filterContext = useFilterContext(props.data)\n\n  useEffect(() => {\n    if (!filterContext?.properties) return\n\n    // Workaround, publishing multiple times without setTimeout\n    // seems to cause some Widgets not to update\n    function publishWorkaround(topic: string, value: unknown) {\n      setTimeout(() => props.publish(topic, value))\n    }\n\n    if (props.filtersPublishVariable) {\n      const publishedFilters = sparqlSnippetPublishedFilters(filterContext, {\n        filterLogicalOperation: props.filterLogicalOperation ?? \"AND\"\n      })\n      publishWorkaround(props.filtersPublishVariable, publishedFilters)\n    }\n\n    if (props.urlPublishVariable) {\n      publishWorkaround(props.urlPublishVariable, window.location.href)\n    }\n  }, [ filterContext ])\n\n  if (props.loading || !props?.data?.results?.bindings?.length) {\n    return <div style={{ minWidth: \"100px\" }} />\n  }\n\n  if (!filterContext) {\n    return <div>Error in filter config</div>\n  }\n\n  return (\n    <FilterHolder filterContext={filterContext} />\n  )\n}\n\n\nexport function FilterHolder(props: {\n  filterContext: FilterContext\n}) {\n  const show = useDialog()\n\n  const openAddDialog = async () => {\n    const hiddenProperties = props.filterContext.properties\n      .filter(filterProperty => !props.filterContext.state.visibility.has(filterProperty.propertyUri))\n\n    const uris = await show(AddFilterDialog, {\n      availableProperties: hiddenProperties\n    })\n    if (!uris) return\n    props.filterContext.setFiltersVisibility(uris, true)\n  }\n\n  const clearFilterProperty = (filterProperty: FilterProperty) => {\n    props.filterContext.setFilterValue(filterProperty.propertyUri, null)\n    props.filterContext.setFilterVisibility(filterProperty.propertyUri, false)\n  }\n\n  return (\n    <form className={styles[\"dynamic-filter\"]} onSubmit={preventDefault}>\n      <div className={styles[\"button-bar\"]}>\n        {props.filterContext.hasAddableFilters && (\n          <Button variant=\"contained\"\n                  color=\"grey\"\n                  size=\"small\"\n                  startIcon={<AddIcon />}\n                  onClick={() => openAddDialog()}>\n            Add...\n          </Button>\n        )}\n        <div style={{ flexGrow: 1 }} />\n        <Button type=\"reset\"\n                variant=\"contained\"\n                color=\"grey\"\n                size=\"small\"\n                startIcon={<CloseIcon />}\n                disabled={!props.filterContext.isStateModified}\n                onClick={() => props.filterContext.reset()}>\n          Clear filters\n        </Button>\n      </div>\n\n      {props.filterContext.properties.map(filterProperty => {\n        const isVisible = props.filterContext.state.visibility.has(filterProperty.propertyUri)\n        if (!isVisible) return null\n\n        const filterValue = props.filterContext.state.values[filterProperty.propertyUri]\n\n        const setCurrentFilterValue = (value: FilterValue | null) => {\n          props.filterContext.setFilterValue(filterProperty.propertyUri, value)\n        }\n\n        const commonParams = { filterValue, onChange: setCurrentFilterValue }\n\n        const filterComponent = (() => {\n          switch (filterProperty.type) {\n            case \"search\":\n              return <SearchSelectFilter filterProperty={filterProperty} {...commonParams} />\n            case \"radiobuttons\":\n              return <ListFilter type=\"radiobuttons\" filterProperty={filterProperty} {...commonParams} />\n            case \"checkboxes\":\n              return <ListFilter type=\"checkboxes\" filterProperty={filterProperty} {...commonParams} />\n            case \"range\":\n              return <RangeFilter filterProperty={filterProperty} {...commonParams} />\n            case \"daterange\":\n              return <DateRangeFilter filterProperty={filterProperty} {...commonParams} />\n            default:\n              throw new Error(`Unknown filterProperty type ${JSON.stringify(filterProperty)}`)\n          }\n        })()\n\n        return (\n          <FilterExpandableAndClearable key={filterProperty.propertyUri}\n                                        defaultExpanded={!!filterValue || filterProperty.defaultExpanded}\n                                        label={filterProperty.propertyLabel}\n                                        showClearButton={!filterProperty.defaultVisible}\n                                        onClear={() => clearFilterProperty(filterProperty)}>\n            {filterComponent}\n          </FilterExpandableAndClearable>\n        )\n      })}\n    </form>\n  )\n}\n\nfunction FilterExpandableAndClearable(props: {\n  label: string\n  defaultExpanded: boolean\n  showClearButton: boolean\n  onClear: () => void\n  children: ReactNode\n}) {\n  // Prevent defaultExpanded prop change from true to false triggering a close\n  const [ isOpen, ] = useState(props.defaultExpanded)\n  return (\n    <details className={styles[\"dynamic-filter-expandable\"]} open={isOpen}>\n      <summary>\n        {props.label}\n        {props.showClearButton && (\n          <button type=\"button\"\n                  title=\"Remove filter\"\n                  className={styles[\"clear\"]}\n                  onClick={() => props.onClear()}>\n            <Icon icon=\"times\" />\n          </button>\n        )}\n      </summary>\n      <div className={styles[\"dynamic-filter-body\"]}>\n        {props.children}\n      </div>\n    </details>\n  )\n}\n\nfunction preventDefault(e: React.BaseSyntheticEvent) {\n  e.preventDefault()\n}\n\nexport default DynamicFilter\n","import { FilterContext } from \"./useFilterContext\"\nimport PublishUtils from \"../../../../helpers/PublishUtils\"\n\nexport type FilterPublishOptions = {\n  filterLogicalOperation: \"AND\" | \"OR\"\n}\n\nexport function sparqlSnippetPublishedFilters(filterContext: FilterContext, publishOptions: FilterPublishOptions) {\n  const filtersSparql = Object.entries(filterContext.state.values).map(([ propertyUri, filterValue ], index) => {\n    const filterProperty = filterContext.properties.find(p => p.propertyUri === propertyUri)\n    if (!filterProperty) {\n      throw new Error(`No filter property for ${propertyUri}. This should never happen.`)\n    }\n\n    const propertyUriAsUri = `<${filterProperty.propertyUri}>`\n\n    // It is useful for debugging to use descriptive variables instead of var_0, var_1, etc.\n    const variableName = `filtervar${index}_${formatIdentifier(filterProperty.propertyLabel)}`\n\n    switch (filterValue.type) {\n      case \"single\":\n        const singleValue = filterValue.valueType === \"uri\"\n          ? `<${filterValue.value}>`\n          : `\"${filterValue.value.replace('\"', '\\\"')}\"`\n        return `\n          {\n              ?${filterProperty.sparqlParameter} ${propertyUriAsUri} ${singleValue} .\n          }\n        `\n      case \"multi\":\n        const multiValue = filterValue.valueType === \"uri\"\n          ? PublishUtils.getListAsSingleValue(\"valueuri\", filterValue.values)\n          : PublishUtils.getListAsSingleValue(\"valuestring\", filterValue.values)\n        return `\n          {\n              VALUES (?${variableName}) { ${multiValue} }\n              ?${filterProperty.sparqlParameter} ${propertyUriAsUri} ?${variableName} .\n          }        \n        `\n      case \"range\":\n        return `\n          {\n            ?${filterProperty.sparqlParameter} ${propertyUriAsUri} ?${variableName} .\n              ${isFinite(filterValue.min) ? `FILTER ( xsd:integer(?${variableName}) >= ${filterValue.min} )` : ''}\n              ${isFinite(filterValue.max) ? `FILTER ( xsd:integer(?${variableName}) <= ${filterValue.max} )` : ''}\n          }\n        `\n      case \"daterange\":\n        return `\n          {\n              ?${filterProperty.sparqlParameter} ${propertyUriAsUri} ?${variableName} .\n                ${filterValue.min != null ? `FILTER ( ?${variableName} >= \"${filterValue.min.toISOString()}\"^^xsd:dateTime )` : ''}\n                ${filterValue.max != null ? `FILTER ( ?${variableName} <= \"${filterValue.max.toISOString()}\"^^xsd:dateTime )` : ''}\n          }\n        `\n    }\n  })\n\n  if (filtersSparql.length === 0) {\n    // Workaround, since publishing an empty string will not work.\n    return \" \"\n  }\n\n  if (publishOptions.filterLogicalOperation === \"AND\") {\n    return filtersSparql.join('')\n  } else {\n    return filtersSparql.join('UNION')\n  }\n}\n\n\nfunction formatIdentifier(str: string) {\n  return str\n    .replace(/\\s/g, '_') // Replace spaces by underscores\n    .replace(/[^\\w^_]/g, '') // Remove all special characters\n    .replace(/^\\d+/, '') // Remove leading numbers (if any)\n}\n","import { useReducer } from \"react\"\n\n/**\n * Hook that forces a re-render, similar to `forceUpdate` in class components.\n */\nexport function useForceUpdate(): () => void {\n  // Create a new empty object each update, so that the new state always\n  // has different referential equality than the previous state\n  const [, forceUpdate] = useReducer(() => ({}), {})\n  return forceUpdate\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"range-filter\":\"RangeFilter_range-filter__1GL8a\",\"range-filter-inputs\":\"RangeFilter_range-filter-inputs__1G6ih\",\"separator\":\"RangeFilter_separator__E-2Zm\",\"range-filter-slider\":\"RangeFilter_range-filter-slider__XpIic\",\"range-filter-legend\":\"RangeFilter_range-filter-legend__39U4g\",\"grow\":\"RangeFilter_grow__5GjX4\",\"range-slider\":\"RangeFilter_range-slider__nQQAu\"};"],"sourceRoot":""}