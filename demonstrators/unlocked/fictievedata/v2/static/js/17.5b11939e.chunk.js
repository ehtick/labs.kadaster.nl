(this["webpackJsonpviewer-builder-client"]=this["webpackJsonpviewer-builder-client"]||[]).push([[17],{1149:function(e,t){function i(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}i.keys=function(){return[]},i.resolve=i,e.exports=i,i.id=1149},1151:function(e,t,i){e.exports={fullWidget:"BBThreeJSViewer_fullWidget__16tbM",right:"BBThreeJSViewer_right__35Xyd",drawer:"BBThreeJSViewer_drawer__2Omkl"}},1155:function(e,t){function i(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}i.keys=function(){return[]},i.resolve=i,e.exports=i,i.id=1155},1299:function(e,t,i){"use strict";i.r(t);var r=i(5),s=i(6),n=i(7),l=i(8),a=i(0),o=i.n(a),c=i(703),h=i(922),u=i(923),d=(i(213),i(607)),f=i(724),v=i(1221),p=i(1150),g=i(925),b=function(){function e(t,i,s,n){Object(r.a)(this,e),this.ifcdb=null,this.name=null,this.gltf=null,this.visible=!0,this.allBFGs={},this.allNodes=[],this.allFirstChild={},this.allFirstMaterial={},this.loading=null,this.defaultChilds=null,this.simpleMode=!1;var l=new d.eb,a="https://unpkg.com/three@0.".concat(d.Lb,".x"),o=new p.a(l).setDecoderPath("".concat(a,"/examples/jsm/libs/draco/gltf/")),h=new v.a(l).setTranscoderPath("".concat(a,"/examples/jsm/libs/basis/"));d.k.enabled=!0,this.ifcdb=t,1==n&&(this.simpleMode=!0);var u=new c.a;u.setCrossOrigin("anonymous"),u.setMeshoptDecoder(g.a),u.setDRACOLoader(o),u.setKTX2Loader(h.detectSupport(this.ifcdb.viewer.viewer.renderer)),u.setWithCredentials(!0),u.manager.file=i,u.setResourcePath(i),this.name=i;var f=this;this.loading=!0;try{console.log("loading "+i),u.setCrossOrigin("*"),u.loadAsync(i).then((function(e){console.log("loaded "+i,e),f.gltf=e,f.simpleMode||(f.needsTranslation?(console.log("glb file needs translation so not processed"),f.processGLTF(e,f.getCenter())):f.processGLTF(e)),f.loading=!1,null!=s&&s.call(f)}),(function(e){}),(function(e){console.log("error",e),window.alert("error loading file"),f.loading=!1,null!=s&&s.call(f)})).catch((function(e){console.log(e),alert("could not load 3d file")}))}catch(b){window.alert("error loading model "),f.loading=!1,null!=s&&s.call(f)}}return Object(s.a)(e,[{key:"getCenter",value:function(){return console.log(this,this.gltf),(new d.g).setFromObject(this.gltf.scene).getCenter(new d.yc)}},{key:"needsTranslation",value:function(){var e=this.getCenter();return Math.abs(e.x)>1e3||Math.abs(e.y)>1e3||Math.abs(e.z)>1e3||(console.log("no need for extra translations"),!1)}},{key:"addDefaultToScene",value:function(){console.log("add ",this.name," to the scene"),this.ifcdb.rootGroup.add(this.gltf.scene)}},{key:"getDefaultScene",value:function(){return this.gltf.scene}},{key:"getChild",value:function(e){for(var t in this.allNodes){var i=this.allNodes[t];if(i.name==e)return i}return null}},{key:"processGLTF",value:function(e,t){for(var i in this.allBFGs={},this.allNodes=[],this.allFirstChild={},this.allFirstMaterial={},this.loading=null,this.defaultChilds=null,this.resetMatrix(e.scene),null!=t&&(console.log("translating the scene ",this.name),this.ncenter=t),e.scene.children){var r=e.scene.children[i];this.processGLTFElement(r,t)}console.log("ready processing gltf")}},{key:"resetMatrix",value:function(e){e.matrix=new d.jb,e.matrixWorld=new d.jb,null!=e.parent&&this.resetMatrix(e.parent)}},{key:"processGLTFElement",value:function(e,t){if(e.isMesh&&e.isObject3D&&null!=e.geometry&&0==e.children.length&&!e.geometry.isBufferGeometry)console.log("dit heeft een andere geometry ",e.geometry);else{var i="default",r={r:1,b:1,g:1};try{i=(r=e.material.color).r+"_"+r.g+"_"+r.b}catch(h){}var s=this.allBFGs[i];if(null==s&&(s=[],this.allBFGs[i]=s,this.allFirstChild[i]=r,this.allFirstMaterial[i]=e.material),e.updateMatrix(!0),e.updateMatrixWorld(!0),null!=e.children){for(var n in e.children){var l=e.children[n];this.processGLTFElement(l,t)}if(null==e.geometry)return}var a=e.geometry;a=a.clone();var o=e.matrixWorld.clone();if(e.geometry=a,null!=t){var c=new d.jb;c.makeTranslation(-t.x,-t.y,-t.z),o=c.multiply(o)}a=a.applyMatrix4(o),s.push(a),a.guid=e.name,this.allNodes.push(e),this.aantal++,this.subAantal++,this.subAantal>1e3&&(this.subAantal=0)}}},{key:"visualize",value:function(e){if(this.visible=e,null==this.defaultChilds){var t={};for(var i in this.allBFGs){var r=this.allFirstChild[i],s=this.allFirstMaterial[i],n=this.ifcdb.getDefaultColor(r,s);t[i]=n}this.defaultChilds=this.ifcdb.processColoring(this.allBFGs,t)}for(var l in console.log(this.name+" visualise "+e),this.defaultChilds)this.ifcdb.rootGroup.add(this.defaultChilds[l])}}]),e}(),w=function(){function e(t,i,s){Object(r.a)(this,e),this.ifcdb=null,this.name=null,this.visible=!0,this.root=null,this.allBFGs={},this.allFirstChild={},this.allFirstMaterial={},this.ifcdb=t;var n=new u.a;this.name=i;this.loading=!0;var l=this;n.ifcManager.setWasmPath("../../../bb/wasm/").then((function(){e.wasmLoaded=!0,l.loadReallyIFC(n,i,s)}))}return Object(s.a)(e,[{key:"loadReallyIFC",value:function(e,t,i){e.setWithCredentials(!0);var r=this;e.load(t,(function(e){console.log(e);e.mesh.material,e.mesh.groups;r.allBFGs.default=e,r.allFirstChild.default=e.material.color,r.allFirstMaterial.default=e.material,r.loading=!1,null!=i&&i.call(r)}))}}]),e}();w.wasmLoaded=!1;var y=w,m=function(){function e(t){Object(r.a)(this,e),this.ifcdb=null,this.guid_label={},this.colorMat={},this.latestData=null,this.guid_color=null,this.ifcdb=t}return Object(s.a)(e,[{key:"useSparqlColors",value:function(){try{if(null!=this.ifcdb.viewer.props.data){if(this.ifcdb.viewer.props.data.results.bindings.length>0)return!0;this.latestData=null}}catch(e){}return!1}},{key:"amoutOfSparqlResults",value:function(){try{if(null!=this.ifcdb.viewer.props.data)return this.ifcdb.viewer.props.data.results.bindings.length}catch(e){}return 0}},{key:"getLabel",value:function(e){return this.guid_label[e]}},{key:"processSparqlResults",value:function(){var e={};this.guid_color=e,this.guid_label={};try{var t=this.ifcdb.viewer.props.data.results;for(var i in t.bindings){var r=t.bindings[i],s=r.guid.value,n=r.color.value;e[s]=n;try{var l=r.label.value;this.guid_label[s]=l}catch(a){}}}catch(a){}return e}},{key:"getColor",value:function(e){try{if(e.startsWith("#")&&7==e.length)return e}catch(t){}try{return this.stringToColour(e)}catch(t){}return"#ff0000"}},{key:"stringToColour",value:function(e){for(var t=0,i=0;i<e.length;i++)t=e.charCodeAt(i)+((t<<5)-t);for(var r="#",s=0;s<3;s++){r+=("00"+(t>>8*s&255).toString(16)).substr(-2)}return r}},{key:"componentToHex",value:function(e){var t=e.toString(16);return 1==t.length?"0"+t:t}},{key:"rgbToHex",value:function(e,t,i){return"#"+this.componentToHex(e)+this.componentToHex(t)+this.componentToHex(i)}},{key:"needsUpdate",value:function(){try{if(this.latestData==this.ifcdb.viewer.props.data)return!1}catch(e){}return!0}},{key:"setSparqlColors_double",value:function(e){console.log("double coloring strategy");try{for(var t in this.ifcdb.ifcfiles){var i=this.ifcdb.ifcfiles[t];if(i.visible)for(var r in i.visualize(!0),i.allNodes){var s=i.allNodes[r];if(null!=s.geometry){var n=e[s.name];if(null!=n){var l=this.getColor(n),a=new d.qb({color:l});a.vertexColors=!1;var o=s.geometry.clone(),c=new d.kb;c.geometry=o,c.material=a,this.ifcdb.rootGroup.add(c)}}}}this.ifcdb.viewer.viewer.zoomAt(this.ifcdb.rootGroup)}catch(h){console.log(h),this.ifcdb.defaultColor()}}},{key:"setSparqlColors_ReOrganise",value:function(e){console.log("reorganise coloring strategy");try{var t={};this.colorMat=t,this.hash={};var i=this.hash;for(var r in i.default=[],t.default=this.ifcdb.getDefaultColor("#aaaaaa"),this.ifcdb.ifcfiles){var s=this.ifcdb.ifcfiles[r];if(s.visible)for(var n in s.allNodes){var l=s.allNodes[n];if(null!=l.geometry){var a=e[l.name];null==a&&(a="default");var o=i[a];if(null==o){o=[],i[a]=o;var c=this.getColor(a),h=new d.qb({color:c});h.vertexColors=!1,t[a]=h}o.push(l.geometry)}}}this.ifcdb.processColoring(i,t)}catch(u){console.log(u),this.ifcdb.defaultColor()}}},{key:"setSparqlColors",value:function(){if(!this.ifcdb.loadingInProgress){try{this.latestData=this.ifcdb.viewer.props.data}catch(t){}var e=this.processSparqlResults();this.amoutOfSparqlResults()<100?this.setSparqlColors_double(e):this.setSparqlColors_ReOrganise(e)}}}]),e}(),C=function(){function e(){Object(r.a)(this,e),this.onlyOnce=!0,this.pickGroup=null,this.rootGroup=null,this.ifcfiles=[],this.inputChanged=!1,this.loadingInProgress=!1,this.ifcdbsparql=null,this.latestBindings=null,this.selectOnlySparqlResults=!1,this.tx=0,this.ty=0,this.tz=0,this.ifcdbsparql=new m(this)}return Object(s.a)(e,[{key:"processedAll",value:function(e){if(this.inputChanged)return this.loadingInProgress=!1,this.inputChanged=!1,void this.viewer.updateRender(!0);if(this.emptyScene(),this.ifcdbsparql.useSparqlColors()?(this.loadingInProgress=!1,this.ifcdbsparql.setSparqlColors()):this.defaultColor(),null!=this.pickGroup&&e?console.log("reusing pickgroup"):(this.pickGroup=null,this.createNewPickGroup()),this.onlyOnce)this.viewer.viewer.scene.children.length;this.viewer.viewer.controls.update(),this.viewer.viewer.setSelectedGuid(),this.viewer.viewer.setAnimeerAantal(20),this.viewer.props.setLoading(!1),this.loadingInProgress=!1,window.top.scene=this.viewer.viewer.scene,this.needsTranslation(),this.translateIntoView()}},{key:"performTranslation",value:function(e){if(1!=this.onlyOnceTranslationDebug){this.onlyOnceTranslationDebug=!0;var t=(new d.g).setFromObject(this.viewer.viewer.scene).getCenter(new d.yc);for(var i in console.log("needs translation so we should do this ",t),this.ifcfiles){var r=this.ifcfiles[i];r.visible&&r.processGLTF(r.gltf,t)}this.processedAll(e)}}},{key:"needsTranslation",value:function(){var e=(new d.g).setFromObject(this.rootGroup),t=e.getCenter(new d.yc);e.getSize(new d.yc);return Math.abs(t.x)>1e3||Math.abs(t.y)>1e3||Math.abs(t.z)>1e3||(console.log("no need for extra translations"),!1)}},{key:"translateIntoView",value:function(){this.viewer.viewer.zoomAt(this.rootGroup),console.log("translate into view")}},{key:"getDefaultColor",value:function(e,t){var i=this.viewer.props["visualisation hint"];null==i&&(i="normal");var r=new d.qb({color:e});return"grey"==i&&((r=new d.qb({color:"#c0c0c0"})).vertexColors=!1,r.fog=!0),"greytransparent"==i&&((r=new d.qb({color:"#c0c0c0"})).vertexColors=!1,r.fog=!0,r.transparent=!0,r.opacity=.4),"greyverytransparent"==i&&((r=new d.qb({color:"#c0c0c0"})).vertexColors=!1,r.fog=!0,r.transparent=!0,r.opacity=.1),"nice"==i&&((r=new d.pb({shininess:50,emissiveIntensity:.2,lightMapIntensity:.4,emissive:e})).vertexColors=!1,r.fog=!0),"normal"==i&&(r.transparent=!0,r.opacity=.99),"transparent"==i&&(r.transparent=!0,r.opacity=.4),"vtransparent"==i&&(r.transparent=!0,r.opacity=.1),"toon"==i&&(r=new d.sb({shininess:50,emissiveIntensity:.2,lightMapIntensity:.4,emissive:e,color:e})),"toontransparent"==i&&((r=new d.sb({shininess:50,emissiveIntensity:.2,lightMapIntensity:.4,emissive:e,color:e})).transparent=!0,r.opacity=.4),r.depthWrite=!0,r}},{key:"defaultColor",value:function(){for(var e in this.ifcfiles){var t=this.ifcfiles[e];if(t.visible){var i={};if(t.simpleMode)t.addDefaultToScene();else{for(var r in t.allBFGs){var s=t.allFirstChild[r],n=t.allFirstMaterial[r],l=this.getDefaultColor(s,n);i[r]=l}this.processColoring(t.allBFGs,i)}}}}},{key:"processColoring",value:function(e,t){this.colorMat=t;var i=[];for(var r in e){var s=e[r],n=new d.kb;if(n,null!=s&&0!=s.length){n.geometry=f.a(s);var l=t[r];n.material=l,n.matrixAutoUpdate=!1,n.castShadow=!1,n.receiveShadow=!1,this.rootGroup.add(n),i.push(n)}}return i}},{key:"getNewRootGroup",value:function(e){var t=new d.G;return t.matrixAutoUpdate=!0,t.castShadow=!0,t.receiveShadow=!0,t}},{key:"getPickGroup",value:function(){return null!=this.pickGroup?this.pickGroup.children:[]}},{key:"createNewPickGroup",value:function(){for(var e in this.pickGroup=this.getNewRootGroup(),this.ifcfiles){var t=this.ifcfiles[e];if(t.visible)if(t.simpleMode)this.pickGroup.add(t.getDefaultScene().clone(!0));else for(var i in t.allNodes)try{var r=new d.kb,s=t.allNodes[i];if(r.geometry=s.geometry,null==r.geometry)continue;r.ifcguid=s.name;var n=null;if(this.selectOnlySparqlResults){try{n=this.ifcdbsparql.guid_color[r.ifcguid]}catch(l){}null!=n&&(this.pickGroup.add(r),r.updateMatrix(),r.updateWorldMatrix(!0,!0))}else this.pickGroup.add(r),r.updateMatrix(),r.updateWorldMatrix(!0,!0)}catch(l){}}return this.pickGroup.children}},{key:"shouldLoadNewFiles",value:function(e){for(var t in e){var i=e[t],r=this.getIFCFile(i);if(null==r)return!0;if(0==r.visible)return!0}for(var t in this.ifcfiles){var s=this.ifcfiles[t];if(s.visible&&0==e.includes(s.name))return!0}return!1}},{key:"getChild",value:function(e){for(var t in this.ifcfiles){var i=this.ifcfiles[t];if(i.visible){var r=i.getChild(e);if(null!=r)return r}}}},{key:"setVisible",value:function(e){for(var t in this.ifcfiles){this.ifcfiles[t].visible=e}}},{key:"isEmpty",value:function(){for(var e in this.ifcfiles){if(this.ifcfiles[e].visible)return!1}return!0}},{key:"emptyScene",value:function(){null!=this.viewer.viewer.scene&&(this.viewer.viewer.createNewScene(this.viewer.viewer.scene),this.viewer.viewer.controls.enabled=!0,this.viewer.viewer.orbiting=!0,this.rootGroup=this.getNewRootGroup(!1),this.viewer.viewer.scene.add(this.rootGroup))}},{key:"loadGLBFiles",value:function(e,t){if(this.viewer=e,this.loadingInProgress)return console.log("not loading glb files because already loading "),!1;this.loadingInProgress=!0,this.asyncLoadGLBFiles(e,t.slice())}},{key:"getIFCFile",value:function(e){for(var t in this.ifcfiles)if(this.ifcfiles[t].name==e)return this.ifcfiles[t];return null}},{key:"asyncLoadGLBFiles",value:function(e,t){this.loadedfiles=t;var i=this;this.reset(),this.setVisible(!1);var r=!1;for(var s in t){var n=t[s];if(null==(a=this.getIFCFile(n)))if(r=!0,n.toLowerCase().endsWith(".glb")){var l=this.viewer.props.simpleMode,a=new b(this,n,(function(){i.readyLoading()}),l);this.ifcfiles.push(a)}else if(n.toLowerCase().endsWith(".ifc")){a=new y(this,n,(function(){i.readyLoading()}));this.ifcfiles.push(a)}else console.log("cannot load file "),i.readyLoading();else a.visible=!0}0==r&&this.processedAll()}},{key:"readyLoading",value:function(){for(var e in this.ifcfiles)if(this.ifcfiles[e].loading)return;this.processedAll()}},{key:"reset",value:function(){}},{key:"processSparqlResults",value:function(e){if(null!=e.props.data){this.viewer=e;var t=e.props.data.results.bindings;this.processBindings(t)}}},{key:"processBindings",value:function(e){if(e!=this.latestBindings){var t=this.viewer,i=new d.eb,r=new c.a(i),s=this;null!=t.scene&&t.createNewScene(t.scene),this.latestBindings=e,this.reset(),this.tobeprocessedBindings=e.length,this.aantalBindings=0,r=new c.a;for(var n in e){0;try{var l=e[n],a=l.gltf.value;a=JSON.parse(a);var o=l.uri.value;a.userData={uri:o},a.name=o,r.parse(a,"",(function(e){null!=e.scene&&null!=e.scene.children?(s.aantalBindings++,s.processGLTFElement(e.scene.children[0],!0)):this.aantalBindings++}),(function(e){console.log(e)}))}catch(h){console.log(h),this.aantalBindings++}}console.log("klaar met bindingen")}}}]),e}(),k=i(1151),F=i.n(k),x=i(704),G=i(1156),M=(i(1152),i(1153),i(1154),i(1210)),O=i(960),S=function(){function e(){var t=this;Object(r.a)(this,e),this.viewer=null,this.scene=null,this.renderer=null,this.raycaster=null,this.camera=null,this.pointer=new d.xc,this.selectedChild=null,this.hooverChild=null,this.orbiting=!1,this.threeCanvas=null,this.animeerAantal=10,this.zoomAt=function(e,i){console.log("zoom at"),null==i&&(i=1);var r=t.camera,s=(new d.g).setFromObject(e),n=s.getCenter(new d.yc),l=s.getSize(new d.yc);O.a.to(r.position,{duration:1,x:n.x,y:n.y+3,z:n.z+l.z+i,onUpdate:function(){r.lookAt(e.position)}});var a=t.controls;t.setAnimeerAantal(1e3),O.a.to(t.controls.target,{duration:1,x:n.x,y:n.y,z:n.z,onComplete:function(){a.enabled=!0,t.setAnimeerAantal(10)}})}}return Object(s.a)(e,[{key:"initViewerNT",value:function(e){this.viewer=e;var t="three-canvas"+this.viewer.id,i=document.getElementById(t);this.threeCanvas=i;var r=new M.a;r.scene=new M.g(r),r.renderer=new M.f(r,i),this.renderer=r.renderer;var s=new M.c(r);r.camera=s,this.camera=s,r.raycaster=new M.e(r),r.init();var n=r.scene.get();this.scene=n;new M.b(r);var l=new d.u;l.position.set(5,10,3),l.intensity=.5,n.add(l);var a=new d.b;a.intensity=.5,n.add(a);var o=new M.d(r);r.tools.add(o),this.grid=o.get(),this.raycaster=new d.Zb}},{key:"initViewer",value:function(e){var t=this;this.viewer=e;var i="three-canvas"+this.viewer.id,r=document.getElementById(i);this.threeCanvas=r;var s=r.getBoundingClientRect(),n={width:s.right-s.left,height:s.bottom-s.top},l=new d.bc,a=n.width/n.height,o=new d.Cb(75,a);o.position.z=15,o.position.y=13,o.position.x=8,o.near=1,o.far=1e3,this.camera=o;var c=new d.Fb(16777215,1250);c.position.set(0,-10,0),o.add(c),l.background=new d.o(15658734);var u=new d.Cc({canvas:r,alpha:!0,powerPreference:"high-performance",antialias:!0,logarithmicDepthBuffer:!0,sortObjects:!0,colorManagement:!0});u.setPixelRatio(window.devicePixelRatio),this.renderer=u,this.raycaster=new d.Zb,u.setSize(n.width,n.height),this.renderer=u;var f=new d.F(50,30);this.grid=f;var v=new d.d;v.material.depthTest=!1,v.renderOrder=1,l.add(v),l.add(f);var p=new h.a(o,r);p.enableDamping=!0,p.target.set(-2,0,0),this.controls=p,this.animeerAantal=50;var g=this;!function e(){g.animeerAantal>0&&(p.update(),u.render(l,o),g.animeerAantal--),g.animeerAantal>100&&(g.animeerAantal=100),requestAnimationFrame(e)}(),u.render(l,o),p.addEventListener("change",(function(){t.animeerAantal=50})),p.addEventListener("start",(function(){t.orbiting=!0})),p.addEventListener("end",(function(){t.orbiting=!1})),r.addEventListener("hide",(function(e){console.log(e)})),r.addEventListener("mousemove",(function(e){t.orbiting||t.mousemove(e)}),!1),r.addEventListener("click",(function(e){t.mouseclick(e)}),!1),r.addEventListener("dblclick",(function(e){t.mouseDoubleClick(e)}),!1),this.scene=l,this.camera=o,o.updateProjectionMatrix()}},{key:"resize",value:function(){try{var e="three-canvas"+this.viewer.id,t=document.getElementById(e).getBoundingClientRect(),i={width:t.right-t.left+200,height:t.bottom-t.top+200},r=this.camera;r.aspect=i.width/i.height,r.updateProjectionMatrix(),this.renderer.setSize(i.width,i.height),this.animeerAantal=50}catch(s){}}},{key:"createNewScene",value:function(e){null==e&&(e=this.scene),e.clear();var t=8947848,i=new d.H(16777147,526368,1);e.add(i);var r;new d.b(t,.01);(r=new d.jc(4478276,.7)).castShadow=!0,r.position.set(250,250,250),r.target.position.set(0,0,0),e.add(r),(r=new d.jc(t,.5)).castShadow=!0,r.position.set(0,-250,-250),r.target.position.set(0,0,0),e.add(r),e.add(r.target);new d.F(80,80);var s=new d.d;s.material.depthTest=!1,s.renderOrder=1,this.setAnimeerAantal(1),this.resize()}},{key:"getIntersection",value:function(e){if(this.orbiting)return null;if(null==this.raycaster)return null;e.preventDefault();var t=this.renderer.getContext().canvas.getBoundingClientRect();this.pointer.x=(e.clientX-t.left)/(t.right-t.left)*2-1,this.pointer.y=-(e.clientY-t.top)/(t.bottom-t.top)*2+1;var i=this.viewer.ifcdb.getPickGroup();if(this.raycaster.setFromCamera(this.pointer,this.camera),null!=i){try{return this.raycaster.intersectObjects(i,!0)}catch(r){console.log(r)}return null}}},{key:"mousemove",value:function(e){try{var t=this.getIntersection(e);if(null==t)return;if(t.length>0){var i=t[0].object;if(i=i.clone(),null!=this.hooverChild&&i==this.hooverChild.children[0])return;if(null!=this.selectedChild&&i==this.selectedChild.children[0])return;null==i.orgMatrix&&(i.orgMatrix=i.matrix),null==i.orgMaterial&&(i.orgMaterial=i.material),i.material=new d.pb({color:255,specular:11184810,shininess:1e3,emissive:255}),i.material.opacity=.5,i.renderOrder=10,null!=this.hooverChild&&this.scene.remove(this.hooverChild);var r=this.viewer.ifcdb.getNewRootGroup();this.hooverChild=r,r.add(i),this.scene.add(r);var s=null;try{s=this.viewer.ifcdb.ifcdbsparql.getLabel(i.geometry.guid)}catch(n){}null!=s?this.showTippy(s):this.showTippy("IFC GUID:"+i.geometry.guid)}else null!=this.hooverChild&&(this.scene.remove(this.hooverChild),this.destroyTippy());this.setAnimeerAantal(1)}catch(n){console.log(n)}}},{key:"setAnimeerAantal",value:function(e){this.animeerAantal+=e}},{key:"setSelectedGuid",value:function(){var e=this.viewer.props.pubsub[this.viewer.props.guidselector];if(null!=e&&e!=this.selectedGuid){var t=this.viewer.ifcdb.getChild(e);if(null!=t){var i=new d.kb;i.geometry=t.geometry,i.name=t.name;var r=this.viewer.props.guidpublishparameter;null!=r?(this.viewer.props.publish(r,t.name),this.showSelectChild(i)):console.log("could not find child")}}}},{key:"mouseDoubleClick",value:function(e){null!=this.selectedChild&&this.zoomAt(this.selectedChild,4)}},{key:"mouseclick",value:function(e){if(!this.orbiting){e.preventDefault();var t=this.getIntersection(e);if(null!=t)if(t.length>0){var i=t[0].object;this.showSelectChild(i);var r=this.viewer.props.guidpublishparameter;null!=r&&this.viewer.props.publish(r,t[0].object.ifcguid)}else this.selectedChild;else null!=this.selectedChild&&(this.scene.remove(this.selectedChild),this.selectedGuid=null)}}},{key:"showSelectChild",value:function(e){if(e=e.clone(),null==this.selectedChild||e!=this.selectedChild.children[0]){null==e.orgMatrix&&(e.orgMatrix=e.matrix),null==e.orgMaterial&&(e.orgMaterial=e.material),e.material=new d.pb({color:16711680,specular:11184810,shininess:1e3,emissive:16711680}),e.material.opacity=0,e.renderOrder=11,null!=this.selectedChild&&(this.scene.remove(this.selectedChild),this.selectedGuid=null);var t=this.viewer.ifcdb.getNewRootGroup();this.selectedChild=t,t.add(e),this.selectedGuid=e.name,this.scene.add(t),this.setAnimeerAantal(1)}}},{key:"showTippy",value:function(e){try{if(null==e&&(e="no info"),null==document.tippy){var t=document.getElementById("tippydiv"+this.viewer.id);null!=t&&(document.tippy=Object(x.c)(t,{trigger:"manual",placement:"followCursor",plugins:[G.a],content:e,followCursor:!0}))}document.tippy.setContent(e);try{document.tippy.show()}catch(i){}}catch(i){}}},{key:"destroyTippy",value:function(){try{document.tippy.hide()}catch(e){}}},{key:"fitCameraToCenteredObject",value:function(e){var t=this.camera,i=this.orbitControls,r=new d.g;r.setFromObject(e);new d.yc;var s=new d.yc;r.getSize(s);var n=t.fov*(Math.PI/180),l=2*Math.atan(Math.tan(n/2)*t.aspect),a=s.z/2+Math.abs(s.x/2/Math.tan(l/2)),o=s.z/2+Math.abs(s.y/2/Math.tan(n/2)),c=Math.max(a,o);c*=1,t.position.set(0,0,c);var h=r.min.z,u=h<0?-h+c:c-h;t.far=3*u,t.updateProjectionMatrix(),void 0!==i&&(i.target=new d.yc(0,0,0),i.maxDistance=2*u)}}]),e}(),j=i(21),L=i(272),A=(i(273),i(36)),B=i(1),T=function(e){Object(n.a)(i,e);var t=Object(l.a)(i);function i(){var e;Object(r.a)(this,i);for(var s=arguments.length,n=new Array(s),l=0;l<s;l++)n[l]=arguments[l];return(e=t.call.apply(t,[this].concat(n))).ifcdb=new C,e.viewer=null,e.canvasDiv=o.a.createRef(),e.onResize=function(){console.log("resized")},e.resize=function(){console.log("resize event")},e}return Object(s.a)(i,[{key:"componentDidMount",value:function(){var e=this.canvasDiv.current,t=this;new ResizeObserver((function(e){try{t.viewer.resize()}catch(i){}})).observe(e),this.viewer=new S,this.viewer.initViewer(this),this.ready()}},{key:"ready",value:function(){this.processSparqlResults=!1,this.updateRender()}},{key:"getGLBFilesFromProps",value:function(e){var t=e["glb files prefix"];null==t&&(t="");var i=e["glb files"],r=[];if(null!=i)for(var s in i){var n=i[s],l=j.a.processStringForParameters({props:e},n);if(null!=l){var a=l.split(",");for(var o in a){var c=a[o];(c=c.replace('"',"").replace('"',"").replace("<","").replace(">","").replace('\\"',"").replace('\\"',"")).length>4&&r.push(t+c)}}}return r}},{key:"shouldComponentUpdate",value:function(e,t){try{var i=this.getGLBFilesFromProps(this.props),r=this.getGLBFilesFromProps(e);if(JSON.stringify(i)!=JSON.stringify(r))return!0}catch(a){}try{if(this.props.data!=e.data)return!0}catch(a){}try{var s=this.props.guidselector,n=this.props.pubsub[s],l=e.guidselector;if(e.pubsub[l]!=n)return!0}catch(a){}return!1}},{key:"loadTestIFC",value:function(){var e=[];for(var t in e.push("SITE_HOW.ifc"),e){var i=e[t];this.loadIFC("http://localhost:3000/temp/"+i)}}},{key:"loadIFC",value:function(e){var t=this;this.ifcLoader.load(e,(function(e){return t.scene.add(e)}))}},{key:"updateRender",value:function(e){if(null!=this.viewer)if(null!=this.viewer.renderer&&this.processSparqlResults)this.ifcdb.processSparqlResults(this);else if(null!=this.viewer.renderer){var t=this.getGLBFilesFromProps(this.props);if(this.isEmpty(t))return void(this.ifcdb.isEmpty()||(this.viewer.controls.enabled=!1,this.ifcdb.setVisible(!1),this.ifcdb.emptyScene(),this.ifcdb.processedAll()));if(e||this.ifcdb.shouldLoadNewFiles(t))return this.viewer.controls.enabled=!1,this.props.setLoading(!0),void this.ifcdb.loadGLBFiles(this,t);if(this.ifcdb.ifcdbsparql.needsUpdate())return this.viewer.controls.enabled=!1,this.props.setLoading(!0),void this.ifcdb.processedAll(!0);null!=this.props.guidselector&&this.viewer.setSelectedGuid()}}},{key:"isEmpty",value:function(e){if(null==e)return!0;if(0==e.length)return!0;if(1==e.length){var t=e[0];if(t.includes("http://www.buildingbits.nl/reset"))return!0;if(t.length<3)return!0}return!1}},{key:"render",value:function(){var e=this;this.ifcdb.loadingInProgress?(console.log("input changed. we might have to check because loading is true"),this.ifcdb.inputChanged=!0):this.updateRender(),null==this.id&&(i.idN++,this.id="id"+i.idN);var t="tippydiv"+this.id,r="three-canvas"+this.id;this.id;return Object(B.jsxs)("div",{ref:this.canvasDiv,id:t,className:F.a.fullWidget,children:[Object(B.jsx)("div",{className:F.a.right,children:Object(B.jsx)("img",{src:L.a,alt:"gear",onClick:function(){return e.setState({dialogVisible:!0})}})}),Object(B.jsx)("canvas",{className:F.a.fullWidget,style:{position:"relative"},id:r})]})}}]),i}(a.Component);T.idN=0;t.default=Object(A.b)()(T)}}]);
//# sourceMappingURL=17.5b11939e.chunk.js.map