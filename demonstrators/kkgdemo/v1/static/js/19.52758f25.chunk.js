(this["webpackJsonpviewer-builder-client"]=this["webpackJsonpviewer-builder-client"]||[]).push([[19],{1089:function(e,t){function i(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}i.keys=function(){return[]},i.resolve=i,e.exports=i,i.id=1089},1331:function(e,t,i){e.exports={fullWidget:"BBThreeJSViewer_fullWidget__16tbM",right:"BBThreeJSViewer_right__35Xyd",drawer:"BBThreeJSViewer_drawer__2Omkl"}},1335:function(e,t){function i(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}i.keys=function(){return[]},i.resolve=i,e.exports=i,i.id=1335},1531:function(e,t,i){"use strict";i.r(t);var r=i(4),s=i(5),n=i(11),a=i(12),o=i(0),l=i.n(o),c=i(185),h=i(798),u=i(890),d=i(920),v=i(1133),f=i(1087),p=i(45),g=i(979),w=function(){function e(t,i,s,n,a){Object(r.a)(this,e),this.ifcdb=null,this.name=null,this.gltf=null,this.visible=!0,this.allBFGs={},this.allNodes=[],this.allFirstChild={},this.allFirstMaterial={},this.loading=null,this.defaultChilds=null,this.simpleMode=!1;var o=new h.Y,l="https://unpkg.com/three@0.".concat(h.Cb,".x"),c=new f.a(o).setDecoderPath("".concat(l,"/examples/jsm/libs/draco/gltf/")),d=new v.a(o).setTranscoderPath("".concat(l,"/examples/jsm/libs/basis/"));h.i.enabled=!0,this.ifcdb=t,1==n&&(this.simpleMode=!0);var w=new u.a;if(this.loader=w,w.setCrossOrigin("anonymous"),w.setMeshoptDecoder(g.a),w.setDRACOLoader(c),w.setKTX2Loader(d.detectSupport(this.ifcdb.viewer.viewer.renderer)),1!=a){w.setWithCredentials(!0),w.manager.file=i,w.setResourcePath(i),this.name=i;var m=this;this.loading=!0;try{i=Object(p.c)(i,t.viewer.props),w.setCrossOrigin("*"),w.loadAsync(i).then((function(e){m.gltf=e,m.simpleMode||(m.needsTranslation?m.processGLTF(e,m.getCenter()):m.processGLTF(e)),m.loading=!1,null!=s&&s.call(m)}),(function(e){console.log(e),m.loading=!1,null!=s&&s.call(m)}),(function(e){console.log("error",e),window.alert("error loading file"),m.loading=!1,null!=s&&s.call(m)})).catch((function(e){console.log(e),alert("could not load 3d file")}))}catch(y){window.alert("error loading model "),m.loading=!1,null!=s&&s.call(m)}}}return Object(s.a)(e,[{key:"getCenter",value:function(){return(new h.f).setFromObject(this.gltf.scene).getCenter(new h.lc)}},{key:"needsTranslation",value:function(){var e=this.getCenter();return Math.abs(e.x)>1e3||Math.abs(e.y)>1e3||Math.abs(e.z)>1e3||(console.log("no need for extra translations"),!1)}},{key:"addDefaultToScene",value:function(){this.ifcdb.rootGroup.add(this.gltf.scene)}},{key:"getDefaultScene",value:function(){return this.gltf.scene}},{key:"getChild",value:function(e){for(var t in this.allNodes){var i=this.allNodes[t];if(i.name==e)return i}return null}},{key:"processGLTF",value:function(e,t){for(var i in this.allBFGs={},this.allNodes=[],this.allFirstChild={},this.allFirstMaterial={},this.loading=null,this.defaultChilds=null,this.resetMatrix(e.scene),null!=t&&(console.log("translating the scene ",this.name),this.ncenter=t),e.scene.children){var r=e.scene.children[i];this.processGLTFElement(r,t)}}},{key:"resetMatrix",value:function(e){e.matrix=new h.cb,e.matrixWorld=new h.cb,null!=e.parent&&this.resetMatrix(e.parent)}},{key:"processGLTFElement",value:function(e,t){if(e.isMesh&&e.isObject3D&&null!=e.geometry&&0==e.children.length&&!e.geometry.isBufferGeometry)console.log("dit heeft een andere geometry ",e.geometry);else{var i="default",r={r:1,b:1,g:1};try{i=(r=e.material.color).r+"_"+r.g+"_"+r.b}catch(u){}var s=this.allBFGs[i];if(null==s&&(s=[],this.allBFGs[i]=s,this.allFirstChild[i]=r,this.allFirstMaterial[i]=e.material),e.updateMatrix(!0),e.updateMatrixWorld(!0),null!=e.children){for(var n in e.children){var a=e.children[n];this.processGLTFElement(a,t)}if(null==e.geometry)return}var o=e.geometry;o=o.clone();var l=e.matrixWorld.clone();if(e.geometry=o,null!=t){var c=new h.cb;c.makeTranslation(-t.x,-t.y,-t.z),l=c.multiply(l)}o=o.applyMatrix4(l),s.push(o),o.guid=e.name,this.allNodes.push(e),this.aantal++,this.subAantal++,this.subAantal>1e3&&(this.subAantal=0)}}},{key:"visualize",value:function(e){if(this.visible=e,null==this.defaultChilds){var t={};for(var i in this.allBFGs){var r=this.allFirstChild[i],s=this.allFirstMaterial[i],n=this.ifcdb.getDefaultColor(r,s);t[i]=n}this.defaultChilds=this.ifcdb.processColoring(this.allBFGs,t)}for(var a in this.defaultChilds)this.ifcdb.rootGroup.add(this.defaultChilds[a])}}]),e}(),m=i(1330),y=function(){function e(t,i,s){Object(r.a)(this,e),this.ifcdb=null,this.name=null,this.visible=!0,this.root=null,this.allBFGs={},this.allFirstChild={},this.allFirstMaterial={},this.ifcdb=t;var n=new m.a;this.name=i;this.loading=!0;var a=this;n.ifcManager.setWasmPath("../../../bb/wasm/").then((function(){e.wasmLoaded=!0,a.loadReallyIFC(n,i,s)}))}return Object(s.a)(e,[{key:"loadReallyIFC",value:function(e,t,i){e.setWithCredentials(!0);var r=this;e.load(t,(function(e){e.mesh.material,e.mesh.groups;r.allBFGs.default=e,r.allFirstChild.default=e.material.color,r.allFirstMaterial.default=e.material,r.loading=!1,null!=i&&i.call(r)}))}}]),e}();y.wasmLoaded=!1;var b=y,C=function(){function e(t){Object(r.a)(this,e),this.ifcdb=null,this.guid_label={},this.colorMat={},this.latestData=null,this.guid_color=null,this.ifcdb=t}return Object(s.a)(e,[{key:"useSparqlColors",value:function(){try{if(null!=this.ifcdb.viewer.props.data){if(this.ifcdb.viewer.props.data.results.bindings.length>0)return!0;this.latestData=null}}catch(e){}return!1}},{key:"amoutOfSparqlResults",value:function(){try{if(null!=this.ifcdb.viewer.props.data)return this.ifcdb.viewer.props.data.results.bindings.length}catch(e){}return 0}},{key:"getLabel",value:function(e){return this.guid_label[e]}},{key:"processSparqlResults",value:function(){var e={};this.guid_color=e,this.guid_label={},this.guid_hidden={};try{var t=this.ifcdb.viewer.props.data.results;for(var i in t.bindings){var r=t.bindings[i],s=r.guid.value,n=r.color.value;e[s]=n;try{var a=r.label.value;this.guid_label[s]=a}catch(l){}try{var o=r.hidden.value;this.guid_hidden[s]=o}catch(l){}}}catch(l){}return e}},{key:"getColor",value:function(e){try{if(e.startsWith("#")&&7==e.length)return e}catch(t){}try{return this.stringToColour(e)}catch(t){}return"#ff0000"}},{key:"stringToColour",value:function(e){for(var t=0,i=0;i<e.length;i++)t=e.charCodeAt(i)+((t<<5)-t);for(var r="#",s=0;s<3;s++){r+=("00"+(t>>8*s&255).toString(16)).substr(-2)}return r}},{key:"componentToHex",value:function(e){var t=e.toString(16);return 1==t.length?"0"+t:t}},{key:"rgbToHex",value:function(e,t,i){return"#"+this.componentToHex(e)+this.componentToHex(t)+this.componentToHex(i)}},{key:"needsUpdate",value:function(){try{if(this.latestData==this.ifcdb.viewer.props.data)return!1}catch(e){}return!0}},{key:"setSparqlColors_double",value:function(e){var t=this.ifcdb.viewer.props.visualiseOnlySparqlResults;if(null==t&&(t=!1),t)return this.setSparqlColors_ReOrganise(e),void this.ifcdb.createNewPickGroup();console.log("double coloring strategy ");try{for(var i in this.ifcdb.ifcfiles){var r=this.ifcdb.ifcfiles[i];if(r.visible)for(var s in r.visualize(!0),r.allNodes){var n=r.allNodes[s];if(null!=n.geometry){var a=n.name;a=n.name;try{if("true"==this.guid_hidden[a])continue}catch(v){}var o=e[a];if("default"==o&&(console.log(t),"true"==t||t)){delete e.ifcguid;continue}if(null!=o){var l=this.getColor(o),c=new h.ib({color:l});c.vertexColors=!1;var u=n.geometry.clone(),d=new h.db;d.geometry=u,d.material=c,this.ifcdb.rootGroup.add(d)}}}}this.ifcdb.viewer.viewer.zoomAt(this.ifcdb.rootGroup)}catch(v){console.log(v),this.ifcdb.defaultColor()}}},{key:"setSparqlColors_ReOrganise",value:function(e){console.log("reorganise coloring strategy");try{var t=this.ifcdb.viewer.props.visualiseOnlySparqlResults;null==t&&(t=!1);var i={};this.colorMat=i,this.hash={};var r=this.hash;for(var s in r.default=[],i.default=this.ifcdb.getDefaultColor("#aaaaaa"),this.ifcdb.ifcfiles){var n=this.ifcdb.ifcfiles[s];if(n.visible)for(var a in n.allNodes){var o=n.allNodes[a];if(null!=o.geometry){var l=o.name;try{if("true"==this.guid_hidden[l])continue}catch(f){}var c=e[l];if(null==c&&(c="default",t))continue;var u=r[c];if(null==u){u=[],r[c]=u;var d=this.getColor(c),v=new h.ib({color:d});v.vertexColors=!1,i[c]=v}u.push(o.geometry)}}}this.ifcdb.processColoring(r,i)}catch(f){console.log(f),this.ifcdb.defaultColor()}}},{key:"setSparqlColors",value:function(){if(!this.ifcdb.loadingInProgress&&this.ifcdb.viewer.props.data!=this.latestData){try{this.latestData=this.ifcdb.viewer.props.data}catch(i){}var e=this.processSparqlResults(),t=this.amoutOfSparqlResults();console.log("amount of sparql results "+t),t<100?this.setSparqlColors_double(e):this.setSparqlColors_ReOrganise(e)}}}]),e}(),k=function(){function e(){Object(r.a)(this,e),this.onlyOnce=!0,this.pickGroup=null,this.rootGroup=null,this.ifcfiles=[],this.inputChanged=!1,this.loadingInProgress=!1,this.ifcdbsparql=null,this.latestBindings=null,this.selectOnlySparqlResults=!1,this.tx=0,this.ty=0,this.tz=0,this.ifcdbsparql=new C(this),this.vertexShader="\n    varying vec3 vNormal;\n    varying vec3 vViewPosition;\n    \n    void main() {\n        vNormal = normalize(normalMatrix * normal);\n        vec4 viewPosition = modelViewMatrix * vec4(position, 1.0);\n        vViewPosition = -viewPosition.xyz;\n        gl_Position = projectionMatrix * viewPosition;\n    }\n    ",this.fragmentShader="\n    varying vec3 vNormal;\n    varying vec3 vViewPosition;\n    uniform vec3 userColor; // User-defined color uniform\n    \n    void main() {\n        // Calculate angle between normal and view direction\n        float cosAngle = dot(normalize(vNormal), normalize(vViewPosition));\n       // cosAngle=1.0 - cosAngle;\n        // Map cosine angle to a dark grey color near the edges\n        vec3 color = mix(userColor, vec3(0.8), cosAngle);\n    \n        gl_FragColor = vec4(color, 1);\n    }\n    ",this.fragmentShaderINV="\n    varying vec3 vNormal;\n    varying vec3 vViewPosition;\n    uniform vec3 userColor; // User-defined color uniform\n    \n    void main() {\n        // Calculate angle between normal and view direction\n        float cosAngle = dot(normalize(vNormal), normalize(vViewPosition));\n        cosAngle=1.0 - cosAngle;\n        // Map cosine angle to a dark grey color near the edges\n        vec3 color = mix(userColor, vec3(0.8), cosAngle);\n    \n        gl_FragColor = vec4(color, 1);\n    }\n    "}return Object(s.a)(e,[{key:"processedAll",value:function(e){if(this.inputChanged)return this.loadingInProgress=!1,this.inputChanged=!1,void this.viewer.updateRender(!0);if(this.selectOnlySparqlResults=this.viewer.props.selectOnlySparqlResults,null==this.selectOnlySparqlResults&&(this.selectOnlySparqlResults=!1),this.emptyScene(),this.ifcdbsparql.useSparqlColors()?(this.loadingInProgress=!1,this.ifcdbsparql.setSparqlColors()):this.defaultColor(),null!=this.pickGroup&&e?console.log("reusing pickgroup"):(this.pickGroup=null,this.createNewPickGroup()),this.onlyOnce)this.viewer.viewer.scene.children.length;this.viewer.viewer.controls.update(),this.viewer.viewer.setSelectedGuid(),this.viewer.viewer.setAnimeerAantal(20),this.viewer.props.setLoading(!1),this.loadingInProgress=!1,window.top.scene=this.viewer.viewer.scene,this.needsTranslation(),this.translateIntoView()}},{key:"performTranslation",value:function(e){if(1!=this.onlyOnceTranslationDebug){this.onlyOnceTranslationDebug=!0;var t=(new h.f).setFromObject(this.viewer.viewer.scene).getCenter(new h.lc);for(var i in this.ifcfiles){var r=this.ifcfiles[i];r.visible&&r.processGLTF(r.gltf,t)}this.processedAll(e)}}},{key:"needsTranslation",value:function(){var e=(new h.f).setFromObject(this.rootGroup),t=e.getCenter(new h.lc);e.getSize(new h.lc);return Math.abs(t.x)>1e3||Math.abs(t.y)>1e3||Math.abs(t.z)>1e3||(console.log("no need for extra translations"),!1)}},{key:"translateIntoView",value:function(){this.viewer.viewer.zoomAt(this.rootGroup)}},{key:"getDefaultColor",value:function(e,t){var i=this.viewer.props["visualisation hint"];null==i&&(i="normal");var r=new h.ib({color:e});if("grey"==i&&((r=new h.ib({color:"#c0c0c0"})).vertexColors=!1,r.fog=!0),"greytransparent"==i&&((r=new h.ib({color:"#c0c0c0"})).vertexColors=!1,r.fog=!0,r.transparent=!0,r.opacity=.4),"greyverytransparent"==i&&((r=new h.ib({color:"#c0c0c0"})).vertexColors=!1,r.fog=!0,r.transparent=!0,r.opacity=.1),"nice"==i&&(r=new h.hb({shininess:.5,emissiveIntensity:.2,lightMapIntensity:.4,emissive:e,color:e,side:h.u})),"nicerGrey"==i)r=new h.Wb({vertexShader:this.vertexShader,fragmentShader:this.fragmentShader,uniforms:{userColor:{value:new h.l(11184810)}}});if("nicer"==i)r=new h.Wb({vertexShader:this.vertexShader,fragmentShader:this.fragmentShaderINV,uniforms:{userColor:{value:e}}});return"normal"==i&&(r.transparent=!0,r.opacity=.99),"transparent"==i&&(r.transparent=!0,r.opacity=.4),"vtransparent"==i&&(r.transparent=!0,r.opacity=.1),"toon"==i&&(r=new h.kb({shininess:50,emissiveIntensity:.2,lightMapIntensity:.4,emissive:e,color:e})),"toontransparent"==i&&((r=new h.kb({shininess:50,emissiveIntensity:.2,lightMapIntensity:.4,emissive:e,color:e})).transparent=!0,r.opacity=.4),r.depthWrite=!0,r}},{key:"defaultColor",value:function(){for(var e in this.ifcfiles){var t=this.ifcfiles[e];if(t.visible){var i={};if(t.simpleMode)t.addDefaultToScene();else{for(var r in t.allBFGs){var s=t.allFirstChild[r],n=t.allFirstMaterial[r],a=this.getDefaultColor(s,n);i[r]=a}this.processColoring(t.allBFGs,i)}}}}},{key:"processColoring",value:function(e,t){this.colorMat=t;var i=[];this.viewer.viewer.outlinePass.selectedObjects=[];for(var r in e){var s=e[r],n=new h.db;if(n,null!=s&&0!=s.length){n.geometry=Object(d.a)(s);var a=t[r];n.material=a,n.matrixAutoUpdate=!0,n.castShadow=!0,n.receiveShadow=!0;var o=s.map((function(e){return new h.v(e)}));this.rootGroup.add(o),i.push(o),this.rootGroup.add(n),i.push(n)}}return i}},{key:"getNewRootGroup",value:function(e){var t=new h.C;return t.matrixAutoUpdate=!0,t.castShadow=!0,t.receiveShadow=!0,t}},{key:"getPickGroup",value:function(){return null!=this.pickGroup?this.pickGroup.children:[]}},{key:"createNewPickGroup",value:function(){for(var e in this.pickGroup=this.getNewRootGroup(),this.ifcfiles){var t=this.ifcfiles[e];if(t.visible)if(t.simpleMode)this.pickGroup.add(t.getDefaultScene().clone(!0));else for(var i in t.allNodes)try{var r=t.allNodes[i],s=new h.db;if(s.geometry=r.geometry,null==s.geometry)continue;s.ifcguid=r.name;var n=null;if(this.selectOnlySparqlResults){try{n=this.ifcdbsparql.guid_color[s.ifcguid]}catch(a){}null!=n&&(this.pickGroup.add(s),s.updateMatrix(),s.updateWorldMatrix(!0,!0))}else this.pickGroup.add(s),s.updateMatrix(),s.updateWorldMatrix(!0,!0)}catch(a){}}return this.pickGroup.children}},{key:"shouldLoadNewFiles",value:function(e){for(var t in e){var i=e[t],r=this.getIFCFile(i);if(null==r)return!0;if(0==r.visible)return!0}for(var t in this.ifcfiles){var s=this.ifcfiles[t];if(s.visible&&0==e.includes(s.name))return!0}return!1}},{key:"getChild",value:function(e){for(var t in this.ifcfiles){var i=this.ifcfiles[t];if(i.visible){var r=i.getChild(e);if(null!=r)return r}}}},{key:"setVisible",value:function(e){for(var t in this.ifcfiles){this.ifcfiles[t].visible=e}}},{key:"isEmpty",value:function(){for(var e in this.ifcfiles){if(this.ifcfiles[e].visible)return!1}return!0}},{key:"emptyScene",value:function(){null!=this.viewer.viewer.scene&&(this.viewer.viewer.createNewScene(this.viewer.viewer.scene),this.viewer.viewer.controls.enabled=!0,this.viewer.viewer.orbiting=!0,this.rootGroup=this.getNewRootGroup(!1),this.viewer.viewer.scene.add(this.rootGroup))}},{key:"loadGLBFiles",value:function(e,t){if(this.viewer=e,this.loadingInProgress)return console.log("not loading glb files because already loading "),!1;this.loadingInProgress=!0,this.asyncLoadGLBFiles(e,t.slice())}},{key:"getIFCFile",value:function(e){for(var t in this.ifcfiles)if(this.ifcfiles[t].name==e)return this.ifcfiles[t];return null}},{key:"asyncLoadGLBFiles",value:function(e,t){this.loadedfiles=t;var i=this;this.reset(),this.setVisible(!1);var r=!1;for(var s in t){var n=t[s];if(null==(o=this.getIFCFile(n)))if(r=!0,n.toLowerCase().endsWith(".glb")){var a=this.viewer.props.simpleMode,o=new w(this,n,(function(){i.readyLoading()}),a);this.ifcfiles.push(o)}else if(n.toLowerCase().endsWith(".ifc")){o=new b(this,n,(function(){i.readyLoading()}));this.ifcfiles.push(o)}else console.log("cannot load file "),i.readyLoading();else o.visible=!0}0==r&&this.processedAll()}},{key:"readyLoading",value:function(){for(var e in this.ifcfiles)if(this.ifcfiles[e].loading)return;this.processedAll()}},{key:"reset",value:function(){}},{key:"processSparqlResults",value:function(e){if(null!=e.props.data){this.viewer=e;var t=e.props.data.results.bindings;this.processBindings(t)}}},{key:"processBindings",value:function(e){if(e!=this.latestBindings){var t=this.viewer,i=new h.Y,r=new u.a(i),s=this;null!=t.scene&&t.createNewScene(t.scene),this.latestBindings=e,this.reset(),this.tobeprocessedBindings=e.length,this.aantalBindings=0,r=new u.a;for(var n in e){0;try{var a=e[n],o=a.gltf.value;o=JSON.parse(o);var l=a.uri.value;o.userData={uri:l},o.name=l,r.parse(o,"",(function(e){null!=e.scene&&null!=e.scene.children?(s.aantalBindings++,s.processGLTFElement(e.scene.children[0],!0)):this.aantalBindings++}),(function(e){console.log(e)}))}catch(c){console.log(c),this.aantalBindings++}}console.log("klaar met bindingen")}}}]),e}(),x=i(1331),S=i.n(x),M=i(1092),G=i(1436),F=i(1336),O=i(1337),N=i(1090),R=i(1338),A=i(870),L=i(1339),j=(i(1332),i(1333),i(1334),i(1423)),I=i(1430),B=function(){function e(){var t=this;Object(r.a)(this,e),this.viewer=null,this.scene=null,this.renderer=null,this.raycaster=null,this.camera=null,this.pointer=new h.kc,this.selectedChild=null,this.selectedChilds=[],this.hooverChild=null,this.orbiting=!1,this.threeCanvas=null,this.animeerAantal=10,this.useComposer=!1,this.zoomAt=function(e,i){null==i&&(i=1);var r=t.camera,s=(new h.f).setFromObject(e),n=s.getCenter(new h.lc),a=s.getSize(new h.lc);I.a.to(r.position,{duration:1,x:n.x,y:n.y+3,z:n.z+a.z+i,onUpdate:function(){r.lookAt(e.position)}});var o=t.controls;t.setAnimeerAantal(1e3),I.a.to(t.controls.target,{duration:1,x:n.x,y:n.y,z:n.z,onComplete:function(){o.enabled=!0,t.setAnimeerAantal(10)}})}}return Object(s.a)(e,[{key:"initViewerNT",value:function(e){this.viewer=e;var t="three-canvas"+this.viewer.id,i=document.getElementById(t);this.threeCanvas=i;var r=new j.a;r.scene=new j.g(r),r.renderer=new j.f(r,i),this.renderer=r.renderer;var s=new j.c(r);r.camera=s,this.camera=s,r.raycaster=new j.e(r),r.init();var n=r.scene.get();this.scene=n;new j.b(r);var a=new h.s;a.position.set(5,10,3),a.intensity=.5,n.add(a);var o=new h.b;o.intensity=.5,n.add(o);var l=new j.d(r);r.tools.add(l),this.grid=l.get(),this.raycaster=new h.Rb}},{key:"initViewer",value:function(e){var t=this;this.viewer=e;var i="three-canvas"+this.viewer.id,r=document.getElementById(i);this.threeCanvas=r;var s=r.getBoundingClientRect(),n={width:s.right-s.left,height:s.bottom-s.top},a=new h.Vb,o=n.width/n.height,l=new h.ub(75,o);l.position.z=15,l.position.y=13,l.position.x=8,l.near=1,l.far=1e3,this.camera=l,new h.wb(16777215,1e3).position.set(0,0,0),a.background=new h.l(15658734),a.background=new h.l(11393254);var c=new h.oc({canvas:r,alpha:!0,powerPreference:"high-performance",antialias:!0,logarithmicDepthBuffer:!1,sortObjects:!0,colorManagement:!0});c.setPixelRatio(window.devicePixelRatio),this.renderer=c,this.raycaster=new h.Rb,c.setSize(n.width,n.height),this.renderer=c;var u=new h.B(50,30);this.grid=u;var d=new h.d;d.material.depthTest=!1,d.renderOrder=1,a.add(d),a.add(u);var v=new G.a(c);v.setSize(n.width,n.height),this.composer=v;var f=new F.a(a,l);v.addPass(f);var p=new O.a(new h.kc(n.width,n.height),a,l);this.outlinePass=p,v.addPass(p);var g=new N.a(R.a);g.uniforms.resolution.value.set(1/window.innerWidth,1/window.innerHeight),v.addPass(g);var w=new M.a(l,r);w.enableDamping=!0,w.target.set(-2,0,0),this.controls=w,this.animeerAantal=50;var m=this;!function e(){m.animeerAantal>0&&(w.update(),c.render(a,l),t.useComposer&&v.render(a,l),m.animeerAantal--),m.animeerAantal>100&&(m.animeerAantal=100),requestAnimationFrame(e)}(),c.render(a,l),w.addEventListener("change",(function(){t.animeerAantal=50})),w.addEventListener("start",(function(){t.orbiting=!0})),w.addEventListener("end",(function(){t.orbiting=!1})),r.addEventListener("hide",(function(e){console.log(e)})),r.addEventListener("mousemove",(function(e){t.orbiting||t.mousemove(e)}),!1),r.addEventListener("click",(function(e){t.mouseclick(e)}),!1),r.addEventListener("dblclick",(function(e){t.mouseDoubleClick(e)}),!1),this.scene=a,this.camera=l,l.updateProjectionMatrix()}},{key:"resize",value:function(){try{var e="three-canvas"+this.viewer.id,t=document.getElementById(e).getBoundingClientRect(),i={width:t.right-t.left+200,height:t.bottom-t.top+200},r=this.camera;r.aspect=i.width/i.height,r.updateProjectionMatrix(),this.renderer.setSize(i.width,i.height),this.composer.setSize(i.width,i.height),this.animeerAantal=50}catch(s){}}},{key:"createNewScene",value:function(e){null==e&&(e=this.scene),e.clear();var t=16777215,i=new h.E(16777147,526344,.1);e.add(i);var r,s=new h.b(t,.01);e.add(s),(r=new h.bc(t)).castShadow=!0,r.position.set(2500,2500,2500),r.target.position.set(0,0,0),e.add(r.target),(r=new h.bc(t,.3)).castShadow=!0,r.position.set(0,2500,2500),r.target.position.set(0,0,50),(r=new h.bc(t,.2)).castShadow=!0,r.position.set(0,2500,5200),r.target.position.set(50,0,0),(r=new h.s(16777215,.2)).position.set(520,550,550).normalize(),(r=new h.s(11184810,.1)).position.set(250,-50,-50).normalize(),(r=new h.s(16777215,.1)).position.set(250,150,-250).normalize(),(r=new h.s(11184810,.1)).position.set(-250,250,250).normalize();new h.B(50,30);var n=new h.d;n.material.depthTest=!1,n.renderOrder=1,this.setAnimeerAantal(1),this.resize()}},{key:"getIntersection",value:function(e){if(this.orbiting)return null;if(null==this.raycaster)return null;e.preventDefault();var t=this.renderer.getContext().canvas.getBoundingClientRect();this.pointer.x=(e.clientX-t.left)/(t.right-t.left)*2-1,this.pointer.y=-(e.clientY-t.top)/(t.bottom-t.top)*2+1;var i=this.viewer.ifcdb.getPickGroup();if(this.raycaster.setFromCamera(this.pointer,this.camera),null!=i){try{return this.raycaster.intersectObjects(i,!0)}catch(r){console.log(r)}return null}}},{key:"mousemove",value:function(e){try{var t=this.getIntersection(e);if(null==t)return;if(t.length>0){var i=t[0].object;if(i=i.clone(),null!=this.hooverChild&&i==this.hooverChild.children[0])return;if(null!=this.selectedChild&&i==this.selectedChild.children[0])return;null==i.orgMatrix&&(i.orgMatrix=i.matrix),null==i.orgMaterial&&(i.orgMaterial=i.material),i.material=new h.hb({color:255,specular:11184810,shininess:1e3,emissive:255}),i.material.opacity=.5,i.renderOrder=10,null!=this.hooverChild&&this.scene.remove(this.hooverChild);var r=this.viewer.ifcdb.getNewRootGroup();this.hooverChild=r,r.add(i),this.scene.add(r);var s=null;try{s=this.viewer.ifcdb.ifcdbsparql.getLabel(i.geometry.guid)}catch(n){}null!=s?this.showTippy(s):this.showTippy("IFC GUID:"+i.geometry.guid)}else null!=this.hooverChild&&(this.scene.remove(this.hooverChild),this.destroyTippy());this.setAnimeerAantal(1)}catch(n){console.log(n)}}},{key:"setAnimeerAantal",value:function(e){this.animeerAantal+=e}},{key:"setSelectedGuid",value:function(){var e=this.viewer.props.pubsub[this.viewer.props.guidselector];if(null!=e&&e!=this.selectedGuid){var t=this.viewer.ifcdb.getChild(e);if(null!=t){var i=new h.db;i.geometry=t.geometry,i.name=t.name;var r=this.viewer.props.guidpublishparameter;null!=r?(this.viewer.props.publish(r,t.name),this.showSelectChild(i)):console.log("could not find child")}}}},{key:"mouseDoubleClick",value:function(e){null!=this.selectedChild&&this.zoomAt(this.selectedChild,4)}},{key:"mouseclick",value:function(e){if(!this.orbiting){e.preventDefault();var t=this.getIntersection(e);if(null!=t)if(t.length>0){var i=t[0].object;this.showSelectChild(i);var r=this.viewer.props.guidpublishparameter;null!=r&&this.viewer.props.publish(r,t[0].object.ifcguid)}else this.selectedChild;else null!=this.selectedChild&&(this.scene.remove(this.selectedChild),this.selectedGuid=null)}}},{key:"showSelectChild",value:function(e){if(e=e.clone(),null==this.selectedChild||e!=this.selectedChild.children[0]){null==e.orgMatrix&&(e.orgMatrix=e.matrix),null==e.orgMaterial&&(e.orgMaterial=e.material),e.material=new h.hb({color:16711680,specular:11184810,shininess:1e3,emissive:16711680}),e.material.opacity=0,e.renderOrder=11,null!=this.selectedChild&&(this.scene.remove(this.selectedChild),this.selectedGuid=null);var t=this.viewer.ifcdb.getNewRootGroup();this.selectedChild=t,t.add(e),this.selectedGuid=e.name,this.scene.add(t),this.setAnimeerAantal(1)}}},{key:"showTippy",value:function(e){try{if(null==e&&(e="no info"),null==document.tippy){var t=document.getElementById("tippydiv"+this.viewer.id);null!=t&&(document.tippy=Object(A.c)(t,{trigger:"manual",placement:"followCursor",plugins:[L.a],content:e,followCursor:!0}))}document.tippy.setContent(e);try{document.tippy.show()}catch(i){}}catch(i){}}},{key:"destroyTippy",value:function(){try{document.tippy.hide()}catch(e){}}},{key:"fitCameraToCenteredObject",value:function(e){var t=this.camera,i=this.orbitControls,r=new h.f;r.setFromObject(e);new h.lc;var s=new h.lc;r.getSize(s);var n=t.fov*(Math.PI/180),a=2*Math.atan(Math.tan(n/2)*t.aspect),o=s.z/2+Math.abs(s.x/2/Math.tan(a/2)),l=s.z/2+Math.abs(s.y/2/Math.tan(n/2)),c=Math.max(o,l);c*=1,t.position.set(0,0,c);var u=r.min.z,d=u<0?-u+c:c-u;t.far=3*d,t.updateProjectionMatrix(),void 0!==i&&(i.target=new h.lc(0,0,0),i.maxDistance=2*d)}}]),e}(),P=i(24),T=i(398),z=(i(399),i(47)),_=function(){function e(t){if(Object(r.a)(this,e),this.viewer=t,this.ifcdb=t.ifcdb,null!=this.viewer.props.data)try{var i=this.viewer.props.data.head.vars;for(var s in i)"gltf"==i[s]&&this.processSparql()}catch(n){console.log(n)}}return Object(s.a)(e,[{key:"setupIFCDB",value:function(){this.viewer.ifcdb.viewer=this.viewer,this.ifcdb.pickGroup=null,this.ifcdb.createNewPickGroup(),this.ifcdb.rootGroup=this.ifcdb.getNewRootGroup(),this.ifcdb.rootGroup.rotation.x=-Math.PI/2,this.viewer.viewer.scene.add(this.ifcdb.rootGroup),this.rootGroup=this.ifcdb.getNewRootGroup(),this.nodes=[],this.color_nodes={},null==this.colors&&(this.colors=[],this.colors.push(this.getRandomHexColor()),this.colors.push(this.getRandomHexColor()),this.colors.push(this.getRandomHexColor()),this.colors.push(this.getRandomHexColor()),this.colors.push(this.getRandomHexColor()))}},{key:"processSparql",value:function(){if(console.log("processing sparql results"),null!=this.viewer.props.data){this.setupIFCDB();var e=new w(this.viewer.ifcdb,null,null,null,!0);this.glb=e;var t=this;this.loadedN=0,this.processedN=0;try{var i=this.viewer.props.data.results.bindings;for(var r in this.resultsN=i.length,i){var s=i[r],n=s.gltf.value;try{s.color.value}catch(a){}e.loader.parse(n,"",(function(e){t.onLoad(e)}),(function(e){t.onError(e)}))}}catch(a){console.log(a)}}}},{key:"getRandomHexColor",value:function(){var e=Math.floor(16777215*Math.random()).toString(16);return"#"+"0".repeat(6-e.length)+e}},{key:"convertToHex",value:function(e){for(var t="",i=0;i<e.length;i++)t+=""+e.charCodeAt(i).toString(16);return t}},{key:"onError",value:function(e){console.log("error parsing gltf"),this.loadedN++,this.loadedN==this.resultsN&&this.onLoadReady()}},{key:"onLoad",value:function(e){var t=this.colors[Object(c.toInteger)(5*Math.random())+""];null!=e.color&&(t=this.convertToHex(e.color));var i=e.scene.children[0];this.nodes.push(i);var r=this.color_nodes[t];null==r&&(r=[],this.color_nodes[t]=r),r.push(i.geometry),this.loadedN++,this.loadedN==this.resultsN&&this.onLoadReady(),this.processedN++,this.processedN>999&&(console.log("processed 1000 ifc objects in total "+this.loadedN),this.processedN=0)}},{key:"getMat1",value:function(e){var t=new h.hb({shininess:50,emissiveIntensity:.4,lightMapIntensity:.4,emissive:e});t.vertexColors=!1,t.fog=!1,t.side=h.u}},{key:"getMat",value:function(e,t){var i=new h.ib({color:e});return"grey"==t&&((i=new h.ib({color:"#c0c0c0"})).vertexColors=!1,i.fog=!0),"greytransparent"==t&&((i=new h.ib({color:"#c0c0c0"})).vertexColors=!1,i.fog=!0,i.transparent=!0,i.opacity=.4),"greyverytransparent"==t&&((i=new h.ib({color:"#c0c0c0"})).vertexColors=!1,i.fog=!0,i.transparent=!0,i.opacity=.1),"nice"==t&&((i=new h.hb({shininess:50,emissiveIntensity:.2,lightMapIntensity:.4,emissive:e})).vertexColors=!1,i.fog=!0),"normal"==t&&(i.transparent=!0,i.opacity=.99),"transparent"==t&&(i.transparent=!0,i.opacity=.4),"vtransparent"==t&&(i.transparent=!0,i.opacity=.1),"toon"==t&&(i=new h.kb({shininess:50,emissiveIntensity:.2,lightMapIntensity:.4,emissive:e,color:e})),"toontransparent"==t&&((i=new h.kb({shininess:50,emissiveIntensity:.2,lightMapIntensity:.4,emissive:e,color:e})).transparent=!0,i.opacity=.4),i.depthWrite=!0,i.vertexColors=!0,i.side=h.u,i}},{key:"onLoadReady",value:function(){for(var e=this.ifcdb.rootGroup,t=e.children.length-1;t>=0;--t)e.remove(e.children[t]);for(var i in this.color_nodes){var r=this.color_nodes[i],s=new h.db;s.geometry=Object(d.a)(r),s.geometry.applyMatrix4((new h.cb).makeScale(-1,1,1)),s.material=this.getMat(i,"greytransparent"),this.ifcdb.rootGroup.add(s)}console.log("onLoadReady")}}]),e}(),D=i(1),q=function(e){Object(n.a)(i,e);var t=Object(a.a)(i);function i(){var e;Object(r.a)(this,i);for(var s=arguments.length,n=new Array(s),a=0;a<s;a++)n[a]=arguments[a];return(e=t.call.apply(t,[this].concat(n))).ifcdb=new k,e.viewer=null,e.canvasDiv=l.a.createRef(),e.onResize=function(){console.log("resized")},e.resize=function(){console.log("resize event")},e}return Object(s.a)(i,[{key:"componentDidMount",value:function(){var e=this.canvasDiv.current,t=this;new ResizeObserver((function(e){try{t.viewer.resize()}catch(i){}})).observe(e),this.viewer=new B,this.viewer.initViewer(this),this.ready()}},{key:"ready",value:function(){this.processSparqlResults=!1,this.updateRender()}},{key:"getGLBFilesFromProps",value:function(e){var t=e["glb files prefix"];null==t&&(t="");var i=e["glb files"],r=[];if(null!=i)for(var s in i){var n=i[s],a=P.a.processStringForParameters({props:e},n);if(null!=a){var o=a.split(",");for(var l in o){var c=o[l];(c=c.replace('"',"").replace('"',"").replace("<","").replace(">","").replace('\\"',"").replace('\\"',"")).length>4&&r.push(t+c)}}}return r}},{key:"shouldComponentUpdate",value:function(e,t){try{var i=this.getGLBFilesFromProps(this.props),r=this.getGLBFilesFromProps(e);if(JSON.stringify(i)!=JSON.stringify(r))return!0}catch(o){}try{if(this.props.data!=e.data)return!0}catch(o){}try{var s=this.props.guidselector,n=this.props.pubsub[s],a=e.guidselector;if(e.pubsub[a]!=n)return!0}catch(o){}return!1}},{key:"loadTestIFC",value:function(){var e=[];for(var t in e.push("SITE_HOW.ifc"),e){var i=e[t];this.loadIFC("http://localhost:3000/temp/"+i)}}},{key:"loadIFC",value:function(e){var t=this;this.ifcLoader.load(e,(function(e){return t.scene.add(e)}))}},{key:"updateRender",value:function(e){if(null!=this.viewer)if(null!=this.viewer.renderer&&this.processSparqlResults)this.ifcdb.processSparqlResults(this);else if(null!=this.viewer.renderer){var t=this.getGLBFilesFromProps(this.props);if(this.isEmpty(t))return new _(this),void(this.ifcdb.isEmpty()||(this.viewer.controls.enabled=!1,this.ifcdb.setVisible(!1),this.ifcdb.emptyScene(),this.ifcdb.processedAll()));if(e||this.ifcdb.shouldLoadNewFiles(t))return this.viewer.controls.enabled=!1,this.props.setLoading(!0),void this.ifcdb.loadGLBFiles(this,t);if(this.ifcdb.ifcdbsparql.needsUpdate())return this.viewer.controls.enabled=!1,this.props.setLoading(!0),void this.ifcdb.processedAll(!0);null!=this.props.guidselector&&this.viewer.setSelectedGuid()}}},{key:"isEmpty",value:function(e){if(null==e)return!0;if(0==e.length)return!0;if(1==e.length){var t=e[0];if(t.includes("http://www.buildingbits.nl/reset"))return!0;if(t.length<3)return!0}return!1}},{key:"render",value:function(){var e=this;this.ifcdb.loadingInProgress?(console.log("input changed. we might have to check because loading is true"),this.ifcdb.inputChanged=!0):this.updateRender(),null==this.id&&(i.idN++,this.id="id"+i.idN);var t="tippydiv"+this.id,r="three-canvas"+this.id;this.id;return Object(D.jsxs)("div",{ref:this.canvasDiv,id:t,className:S.a.fullWidget,children:[Object(D.jsx)("div",{className:S.a.right,children:Object(D.jsx)("img",{src:T.a,alt:"gear",onClick:function(){return e.setState({dialogVisible:!0})}})}),Object(D.jsx)("canvas",{className:S.a.fullWidget,style:{position:"relative"},id:r})]})}}]),i}(o.Component);q.idN=0;t.default=Object(z.b)()(q)}}]);
//# sourceMappingURL=19.52758f25.chunk.js.map